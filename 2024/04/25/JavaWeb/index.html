<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>JavaWeb | L1n</title><meta name="author" content="翎晗"><meta name="copyright" content="翎晗"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="Maven简介Maven是一款管理和构建java项目的工具 Maven的作用？ 方便依赖管理 方便快捷的管理项目依赖的资源(jar包)，避免版本冲突问题  统一项目结构 提供标准，统一的项目结构  项目构建 标准跨平台（Linux、Windows、MacOS）的自动化项目结构方式   Maven坐标什么是坐标？  Maven中的坐标是&#x3D;&#x3D;资源的唯一标识&#x3D;&#x3D;">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaWeb">
<meta property="og:url" content="http://example.com/2024/04/25/JavaWeb/index.html">
<meta property="og:site_name" content="L1n">
<meta property="og:description" content="Maven简介Maven是一款管理和构建java项目的工具 Maven的作用？ 方便依赖管理 方便快捷的管理项目依赖的资源(jar包)，避免版本冲突问题  统一项目结构 提供标准，统一的项目结构  项目构建 标准跨平台（Linux、Windows、MacOS）的自动化项目结构方式   Maven坐标什么是坐标？  Maven中的坐标是&#x3D;&#x3D;资源的唯一标识&#x3D;&#x3D;">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/JW_C.jpg">
<meta property="article:published_time" content="2024-04-25T05:08:02.000Z">
<meta property="article:modified_time" content="2024-06-30T09:05:24.169Z">
<meta property="article:author" content="翎晗">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/JW_C.jpg"><link rel="shortcut icon" href="/img/lh.png"><link rel="canonical" href="http://example.com/2024/04/25/JavaWeb/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.12.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":false,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'JavaWeb',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-06-30 17:05:24'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/background.css"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/loading.gif" data-original="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/JW_T.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="L1n"><span class="site-name">L1n</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comments-o"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">JavaWeb</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-04-25T05:08:02.000Z" title="发表于 2024-04-25 13:08:02">2024-04-25</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-06-30T09:05:24.169Z" title="更新于 2024-06-30 17:05:24">2024-06-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java%E5%BC%80%E5%8F%91%E6%A1%86%E6%9E%B6/">Java开发框架</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">30.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>109分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="JavaWeb"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p><strong>Maven是一款管理和构建java项目的工具</strong></p>
<h4 id="Maven的作用？"><a href="#Maven的作用？" class="headerlink" title="Maven的作用？"></a>Maven的作用？</h4><ul>
<li><p>方便依赖管理</p>
<p>方便快捷的管理项目依赖的资源(jar包)，避免版本冲突问题</p>
</li>
<li><p>统一项目结构</p>
<p>提供标准，统一的项目结构</p>
</li>
<li><p>项目构建</p>
<p>标准跨平台（Linux、Windows、MacOS）的自动化项目结构方式</p>
</li>
</ul>
<h4 id="Maven坐标"><a href="#Maven坐标" class="headerlink" title="Maven坐标"></a>Maven坐标</h4><p>什么是坐标？</p>
<ul>
<li>Maven中的坐标是&#x3D;&#x3D;资源的唯一标识&#x3D;&#x3D; , 通过该坐标可以唯一定位资源位置</li>
<li>使用坐标来定义项目或引入项目中需要的依赖</li>
</ul>
<p>Maven坐标主要组成</p>
<ul>
<li>groupId：定义当前Maven项目隶属组织名称（通常是域名反写，例如：com.itheima）</li>
<li>artifactId：定义当前Maven项目名称（通常是模块名称，例如 order-service、goods-service）</li>
<li>version：定义当前项目版本号</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20240121152233994-1715613343037-1.png" alt="image-20240121152233994"></p>
<p><strong>注意：</strong></p>
<ul>
<li>上面所说的资源可以是插件、依赖、当前项目。</li>
<li>我们的项目如果被其他的项目依赖时，也是需要坐标来引入的。</li>
</ul>
<h2 id="依赖管理"><a href="#依赖管理" class="headerlink" title="依赖管理"></a>依赖管理</h2><h3 id="依赖配置"><a href="#依赖配置" class="headerlink" title="依赖配置"></a>依赖配置</h3><p>依赖：指当前项目运行所需要的jar包。一个项目中可以引入多个依赖</p>
<p>例如：在当前工程中，我们需要用到logback来记录日志，此时就可以在maven工程的pom.xml文件中，引入logback的依赖。具体步骤如下：</p>
<ol>
<li><p>在pom.xml中编写<dependencies>标签</dependencies></p>
</li>
<li><p>在<dependencies>标签中使用<dependency>引入坐标</dependency></dependencies></p>
</li>
<li><p>定义坐标的 groupId、artifactId、version</p>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 第1个依赖 : logback --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 第2个依赖 : junit --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意事项：</p>
<ol>
<li>如果引入的依赖，在本地仓库中不存在，将会连接远程仓库 &#x2F; 中央仓库，然后下载依赖（这个过程会比较耗时，耐心等待）</li>
<li>如果不知道依赖的坐标信息，可以到mvn的中央仓库（<a target="_blank" rel="noopener" href="https://mvnrepository.com/%EF%BC%89%E4%B8%AD%E6%90%9C%E7%B4%A2">https://mvnrepository.com/）中搜索</a></li>
</ol>
</blockquote>
<h3 id="依赖传递"><a href="#依赖传递" class="headerlink" title="依赖传递"></a>依赖传递</h3><h4 id="依赖具有传递性"><a href="#依赖具有传递性" class="headerlink" title="依赖具有传递性"></a>依赖具有传递性</h4><p>依赖传递可以分为：</p>
<ol>
<li><p>直接依赖：在当前项目中通过依赖配置建立的依赖关系</p>
</li>
<li><p>间接依赖：被依赖的资源如果依赖其他资源，当前项目间接依赖其他资源</p>
</li>
</ol>
<p><img src="/img/loading.gif" data-original="/.com//image-20240121153936896-1715613343037-2.png" alt="image-20240121153936896"></p>
<p>比如以上图中：</p>
<ul>
<li>projectA依赖了projectB。对于projectA 来说，projectB 就是直接依赖。</li>
<li>而projectB依赖了projectC及其他jar包。 那么此时，在projectA中也会将projectC的依赖传递下来。对于projectA 来说，projectC就是间接依赖。</li>
</ul>
<h4 id="排除依赖"><a href="#排除依赖" class="headerlink" title="排除依赖"></a>排除依赖</h4><p>问题：之前我们讲了依赖具有传递性。那么A依赖B，B依赖C，如果A不想将C依赖进来，是否可以做到？ </p>
<p>答案：在maven项目中，我们可以通过排除依赖来实现。</p>
<p>什么是排除依赖？</p>
<ul>
<li>排除依赖：指主动断开依赖的资源。（被排除的资源无需指定版本）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.itheima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-projectB<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">    <span class="comment">&lt;!--排除依赖, 主动断开依赖的资源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="依赖范围"><a href="#依赖范围" class="headerlink" title="依赖范围"></a>依赖范围</h3><p>在项目中导入依赖的jar包后，默认情况下，可以在任何地方使用。</p>
<p>如果希望限制依赖的使用范围，可以通过<scope>标签设置其作用范围。</scope></p>
<p>作用范围：</p>
<ol>
<li><p>主程序范围有效（main文件夹范围内）</p>
</li>
<li><p>测试程序范围有效（test文件夹范围内）</p>
</li>
<li><p>是否参与打包运行（package指令范围内）</p>
</li>
</ol>
<table>
<thead>
<tr>
<th><strong>scope</strong>值</th>
<th><strong>主程序</strong></th>
<th><strong>测试程序</strong></th>
<th><strong>打包（运行）</strong></th>
<th><strong>范例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>compile（默认）</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>log4j</td>
</tr>
<tr>
<td>test</td>
<td>-</td>
<td>Y</td>
<td>-</td>
<td>junit</td>
</tr>
<tr>
<td>provided</td>
<td>Y</td>
<td>Y</td>
<td>-</td>
<td>servlet-api</td>
</tr>
<tr>
<td>runtime</td>
<td>-</td>
<td>Y</td>
<td>Y</td>
<td>jdbc驱动</td>
</tr>
</tbody></table>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p>Maven的生命周期就是为了对所有的构建过程进行抽象和统一。 描述了一次项目构建，经历哪些阶段。</p>
<p>Maven对项目构建的生命周期划分为3套（相互独立）：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20220616124015567.png"></p>
<ul>
<li><p>clean：清理工作。</p>
</li>
<li><p>default：核心工作。如：编译、测试、打包、安装、部署等。</p>
</li>
<li><p>site：生成报告、发布站点等。</p>
</li>
</ul>
<p>三套生命周期又包含哪些具体的阶段呢, 我们来看下面这幅图:</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20220616124348972.png" alt="image-20220616124348972"> </p>
<p>我们看到这三套生命周期，里面有很多很多的阶段，这么多生命周期阶段，其实我们常用的并不多，主要关注以下几个：</p>
<p>• clean：移除上一次构建生成的文件</p>
<p>• compile：编译项目源代码</p>
<p>• test：使用合适的单元测试框架运行测试(junit)</p>
<p>• package：将编译后的文件打包，如：jar、war等</p>
<p>• install：安装项目到本地仓库</p>
<p>Maven的生命周期是抽象的，这意味着生命周期本身不做任何实际工作。<strong>在Maven的设计中，实际任务（如源代码编译）都交由插件来完成。</strong></p>
<p>生命周期的顺序是：clean –&gt; validate –&gt; compile –&gt; test –&gt; package –&gt; verify –&gt; install –&gt; site –&gt; deploy </p>
<p>我们需要关注的就是：clean –&gt;  compile –&gt; test –&gt; package  –&gt; install </p>
<blockquote>
<p>说明：在同一套生命周期中，我们在执行后面的生命周期时，前面的生命周期都会执行。</p>
</blockquote>
<blockquote>
<p> 思考：当运行package生命周期时，clean、compile生命周期会不会运行？</p>
<p> ​		clean不会运行，compile会运行。  因为compile与package属于同一套生命周期，而clean与package不属于同一套生命周期。</p>
</blockquote>
<h4 id="执行"><a href="#执行" class="headerlink" title="执行"></a>执行</h4><p>在日常开发中，当我们要执行指定的生命周期时，有两种执行方式：</p>
<ol>
<li>在idea工具右侧的maven工具栏中，选择对应的生命周期，双击执行</li>
<li>在DOS命令行中，通过maven命令执行</li>
</ol>
<h1 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h1><ul>
<li>概念：Hyper Text Transfer Protocol ,超文本传输协议  规定了浏览器和服务器之间数据传输的规则</li>
<li>特点：<ol>
<li>基于TCP，面向连接，安全</li>
<li>基于请求-响应模型的：一次请求对应一次相应</li>
<li>HTTP协议是无状态的协议：对于事务处理没有记忆能力，每次请求-相应都是独立的。<ul>
<li>缺点：多次请求之间不能共享数据</li>
<li>优点：速度快</li>
</ul>
</li>
</ol>
</li>
</ul>
<h2 id="HTTP-请求数据格式"><a href="#HTTP-请求数据格式" class="headerlink" title="HTTP-请求数据格式"></a>HTTP-请求数据格式</h2><p><img src="/img/loading.gif" data-original="/.com//image-20240125150954854.png"></p>
<p>请求方式-GET：请求参数在请求行中，没有请求体，如：&#x2F;brand&#x2F;findAll?name&#x3D;OPPO&amp;status&#x3D;1。GET请求大小是有限制的</p>
<p>请求方式-POST：请求参数在请求体中，POST请求大小是没有限制的</p>
<h2 id="请求响应介绍-HTTP响应格式"><a href="#请求响应介绍-HTTP响应格式" class="headerlink" title="请求响应介绍-HTTP响应格式"></a>请求响应介绍-HTTP响应格式</h2><p><img src="/img/loading.gif" data-original="/.com//image-20240125152927891.png" alt="image-20240125152927891"></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240125152946173-1715613343038-7.png" alt="image-20240125152946173"></p>
<h2 id="状态码大类"><a href="#状态码大类" class="headerlink" title="状态码大类"></a>状态码大类</h2><table>
<thead>
<tr>
<th>状态码分类</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>1xx</td>
<td><strong>响应中</strong>——临时状态码，表示请求已经接受，告诉客户端应该继续请求或者如果它已经完成则忽略它</td>
</tr>
<tr>
<td>2xx</td>
<td><strong>成功</strong>——表示请求已经被成功接收，处理已完成</td>
</tr>
<tr>
<td>3xx</td>
<td><strong>重定向</strong>——重定向到其它地方：它让客户端再发起一个请求以完成整个处理。</td>
</tr>
<tr>
<td>4xx</td>
<td><strong>客户端错误</strong>——处理发生错误，责任在客户端，如：客户端的请求一个不存在的资源，客户端未被授权，禁止访问等</td>
</tr>
<tr>
<td>5xx</td>
<td><strong>服务器端错误</strong>——处理发生错误，责任在服务端，如：服务端抛出异常，路由出错，HTTP版本不支持等</td>
</tr>
</tbody></table>
<h2 id="常见的响应状态码"><a href="#常见的响应状态码" class="headerlink" title="常见的响应状态码"></a>常见的响应状态码</h2><table>
<thead>
<tr>
<th>状态码</th>
<th>英文描述</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>&#x3D;&#x3D;200&#x3D;&#x3D;</td>
<td><strong><code>OK</code></strong></td>
<td>客户端请求成功，即<strong>处理成功</strong>，这是我们最想看到的状态码</td>
</tr>
<tr>
<td>302</td>
<td><strong><code>Found</code></strong></td>
<td>指示所请求的资源已移动到由<code>Location</code>响应头给定的 URL，浏览器会自动重新访问到这个页面</td>
</tr>
<tr>
<td>304</td>
<td><strong><code>Not Modified</code></strong></td>
<td>告诉客户端，你请求的资源至上次取得后，服务端并未更改，你直接用你本地缓存吧。隐式重定向</td>
</tr>
<tr>
<td>400</td>
<td><strong><code>Bad Request</code></strong></td>
<td>客户端请求有<strong>语法错误</strong>，不能被服务器所理解</td>
</tr>
<tr>
<td>403</td>
<td><strong><code>Forbidden</code></strong></td>
<td>服务器收到请求，但是<strong>拒绝提供服务</strong>，比如：没有权限访问相关资源</td>
</tr>
<tr>
<td>&#x3D;&#x3D;404&#x3D;&#x3D;</td>
<td><strong><code>Not Found</code></strong></td>
<td><strong>请求资源不存在</strong>，一般是URL输入有误，或者网站资源被删除了</td>
</tr>
<tr>
<td>405</td>
<td><strong><code>Method Not Allowed</code></strong></td>
<td>请求方式有误，比如应该用GET请求方式的资源，用了POST</td>
</tr>
<tr>
<td>428</td>
<td><strong><code>Precondition Required</code></strong></td>
<td><strong>服务器要求有条件的请求</strong>，告诉客户端要想访问该资源，必须携带特定的请求头</td>
</tr>
<tr>
<td>429</td>
<td><strong><code>Too Many Requests</code></strong></td>
<td>指示用户在给定时间内发送了<strong>太多请求</strong>（“限速”），配合 Retry-After(多长时间后可以请求)响应头一起使用</td>
</tr>
<tr>
<td>431</td>
<td><strong><code> Request Header Fields Too Large</code></strong></td>
<td><strong>请求头太大</strong>，服务器不愿意处理请求，因为它的头部字段太大。请求可以在减少请求头域的大小后重新提交。</td>
</tr>
<tr>
<td>&#x3D;&#x3D;500&#x3D;&#x3D;</td>
<td><strong><code>Internal Server Error</code></strong></td>
<td><strong>服务器发生不可预期的错误</strong>。服务器出异常了，赶紧看日志去吧</td>
</tr>
<tr>
<td>503</td>
<td><strong><code>Service Unavailable</code></strong></td>
<td><strong>服务器尚未准备好处理请求</strong>，服务器刚刚启动，还未初始化好</td>
</tr>
</tbody></table>
<p>状态码大全：<a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/chapter/13553">https://cloud.tencent.com/developer/chapter/13553</a> </p>
<h1 id="Web服务器"><a href="#Web服务器" class="headerlink" title="Web服务器"></a>Web服务器</h1><ul>
<li>对HTTP协议操作进行封装，简化web程序开发</li>
<li>部署web项目，对外提供网上信息浏览服务</li>
</ul>
<h1 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h1><ul>
<li>一个轻量级的web服务器，支持servlet、jsp等少了javaEE规范。</li>
<li>也被称为web容器，servlet容器</li>
</ul>
<h3 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h3><ul>
<li>安装</li>
<li>卸载</li>
<li>启动：bin&#x2F;startup.bat</li>
<li>停止：bin&#x2F;shutdown.bat</li>
<li>部署：把文件夹移动到webapps文件夹下</li>
</ul>
<h1 id="Springboot内嵌Tomcat"><a href="#Springboot内嵌Tomcat" class="headerlink" title="Springboot内嵌Tomcat"></a>Springboot内嵌Tomcat</h1><h3 id="1-起步依赖"><a href="#1-起步依赖" class="headerlink" title="1.起步依赖"></a>1.起步依赖</h3><ul>
<li>spring-boot-starter-web</li>
<li>spring-boot-starter-test</li>
</ul>
<h3 id="2-内嵌Tomcat服务器"><a href="#2-内嵌Tomcat服务器" class="headerlink" title="2.内嵌Tomcat服务器"></a>2.内嵌Tomcat服务器</h3><ul>
<li>基于Springboot开发的web应用程序，内置了tomcat服务器，当启动类运行时，会自动启动内嵌的tomcat服务器**</li>
</ul>
<h1 id="请求响应"><a href="#请求响应" class="headerlink" title="请求响应"></a>请求响应</h1><h2 id="请求响应-1"><a href="#请求响应-1" class="headerlink" title="请求响应"></a>请求响应</h2><p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-02_14-50-38.jpg"></p>
<ul>
<li>请求（HttpServletRequest）：获取请求数据</li>
<li>相应（HttpServletResponse）：设置响应数据</li>
<li>BS架构：Browser&#x2F;Server，浏览器&#x2F;服务端架构模式，服务端只需要浏览器，应用程序的逻辑和数据都存储在服务器（维护方便  体验一般）</li>
<li>CS架构：Client&#x2F;Server，客户端&#x2F;服务端架构模式。（开发、维护麻烦  体验不错）</li>
</ul>
<h2 id="Postman"><a href="#Postman" class="headerlink" title="Postman"></a>Postman</h2><p>postman是一款功能强大的网页调试与发送网页HTTP请求的Chrome插件</p>
<p>作用：常用于进行接口测试</p>
<h2 id="请求"><a href="#请求" class="headerlink" title="请求"></a>请求</h2><h4 id="简单参数"><a href="#简单参数" class="headerlink" title="简单参数"></a>简单参数</h4><h5 id="1-原始方式获取请求参数"><a href="#1-原始方式获取请求参数" class="headerlink" title="1.原始方式获取请求参数"></a><strong>1.原始方式获取请求参数</strong></h5><p>在原始的web程序，获取请求参数，需要通过HttpServletRequest对象手动获取。</p>
<ul>
<li>Controller方法形参中声明HttpServletRequest对象</li>
<li>调用对象的getParameter(参数名)</li>
<li><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-03_15-50-08-1715613343038-9.jpg"></li>
</ul>
<h5 id="2-SpringBoot中接收简单参数"><a href="#2-SpringBoot中接收简单参数" class="headerlink" title="2.SpringBoot中接收简单参数"></a><strong>2.SpringBoot中接收简单参数</strong></h5><ul>
<li>请求参数名与方法形参变量名相同</li>
<li>会自动进行类型转换</li>
<li><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-03_15-53-03-1715613343038-10.jpg"></li>
</ul>
<h5 id="3-RequestParam注解"><a href="#3-RequestParam注解" class="headerlink" title="3.@RequestParam注解"></a>3.@RequestParam注解</h5><ul>
<li>方法形参名称与请求参数名称不匹配，通过该注解完成映射</li>
<li>该注解的required属性默认是true，代表请求参数必须传递，如果设置为false则代表可以不传递  会显示为null</li>
<li><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-03_15-58-26-1715613343038-11.jpg"></li>
</ul>
<h4 id="实体参数"><a href="#实体参数" class="headerlink" title="实体参数"></a>实体参数</h4><p><strong>实体对象参数：请求参数名与形参对象属性名相同，定义PoJo接收即可</strong></p>
<h5 id="1-简单实体参数"><a href="#1-简单实体参数" class="headerlink" title="1.简单实体参数"></a>1.简单实体参数</h5><ul>
<li>创建一个User的javabeen类 里面封装name、age</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-03_16-17-41-1715613343038-12.jpg"></p>
<h5 id="2-复杂实体参数"><a href="#2-复杂实体参数" class="headerlink" title="2.复杂实体参数"></a>2.复杂实体参数</h5><ul>
<li>创建一个User的javabeen类 里面封装name、age、adress</li>
<li>adress为Adress类 里面封装province、city</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-03_16-26-20-1715613343038-13.jpg"></p>
<p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-03_16-26-34-1715613343038-14.jpg"></p>
<p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-03_16-26-49-1715613343038-15.jpg"></p>
<p>postman参数为：</p>
<p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-03_16-27-03-1715613343038-16.jpg"></p>
<h4 id="数组集合参数"><a href="#数组集合参数" class="headerlink" title="数组集合参数"></a>数组集合参数</h4><h5 id="1-数组参数"><a href="#1-数组参数" class="headerlink" title="1.数组参数"></a>1.数组参数</h5><p><strong>数组参数：请求参数名与形参数组名称相同且请求参数为多个，定义数组类型形参即可接收参数</strong></p>
<ul>
<li><p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_15-22-59-1715613343038-17.jpg"></p>
</li>
<li><p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_15-23-23-1715613343038-18.jpg"></p>
</li>
</ul>
<p>确保参数名与方法中的形参名一致</p>
<h5 id="2-集合参数"><a href="#2-集合参数" class="headerlink" title="2.集合参数"></a>2.集合参数</h5><p><strong>集合参数：请求参数名与形参集合名称相同且请求参数为多个，<code>@RequestParam</code>绑定参数关系</strong></p>
<ul>
<li><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_15-26-43-1715613343038-19.jpg"></li>
<li><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_15-26-57-1715613343038-20.jpg"></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">数组参数：请求参数名与形参数组名称相同，可以直接使用数组封装</span><br><span class="line">集合参数：请求参数名与形参中结合变量名相同，通过@RequestParam绑定参数关系</span><br></pre></td></tr></table></figure>

<h4 id="日期参数"><a href="#日期参数" class="headerlink" title="日期参数"></a>日期参数</h4><p><strong>日期参数：使用<code>@DataTimeFormat</code>注解 完成日期参数格式转换</strong></p>
<ul>
<li><p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_15-38-53-1715613343038-21.jpg"></p>
</li>
<li><p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_15-38-46-1715613343038-22.jpg"></p>
</li>
</ul>
<h4 id="Json格式参数"><a href="#Json格式参数" class="headerlink" title="Json格式参数"></a>Json格式参数</h4><p><strong>json格式参数：json数据键名与形参对象属性名相同，定义POJO类型形参即可接收参数，需要使用<code>@RequestBody</code>表示绑定</strong></p>
<ul>
<li><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_15-49-46-1715613343038-23.jpg"></li>
<li><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_15-50-06-1715613343038-24.jpg"></li>
</ul>
<h4 id="路径参数"><a href="#路径参数" class="headerlink" title="路径参数"></a>路径参数</h4><p><strong>路径参数：通过请求URL直接传递参数，使用{…}来标识该路径参数，需要使用<code>@PathVariable</code>获取参数路径</strong></p>
<ul>
<li><p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_16-05-59-1715613343038-25.jpg"></p>
</li>
<li><p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_16-06-19-1715613343038-26.jpg"></p>
</li>
</ul>
<p>多路径：</p>
<ul>
<li><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_16-07-04-1715613343038-27.jpg"></li>
<li><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_16-07-19-1715613343038-28.jpg"></li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_16-08-28-1715613343038-29.jpg"></p>
<h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h2><h4 id="ResponseBody"><a href="#ResponseBody" class="headerlink" title="@ResponseBody"></a><strong>@ResponseBody</strong></h4><p>类型：方法注解、类注解</p>
<p>位置：Controller类上&#x2F;方法上</p>
<p>作用：将方法返回值直接响应，若返回值类型是 实体对象&#x2F;集合 ，转JSON格式响应</p>
<p>说明：@RestController&#x3D;@Controller + @ResponseBody</p>
<h4 id="统一响应结果"><a href="#统一响应结果" class="headerlink" title="统一响应结果"></a><strong>统一响应结果</strong></h4><p>Result(code、msg、data)</p>
<p>如：</p>
<ul>
<li><p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_16-41-24-1715613343038-30.jpg"></p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/hello">http://localhost:8080/hello</a></p>
</li>
<li><p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_16-41-29-1715613343038-31.jpg"></p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/getAddr">http://localhost:8080/getAddr</a></p>
</li>
<li><p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_16-41-40-1715613343038-32.jpg"></p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/listAddr">http://localhost:8080/listAddr</a></p>
<h4 id="案例：获取员工数据，并统一响应结果，在页面渲染"><a href="#案例：获取员工数据，并统一响应结果，在页面渲染" class="headerlink" title="案例：获取员工数据，并统一响应结果，在页面渲染"></a>案例：获取员工数据，并统一响应结果，在页面渲染</h4><p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_17-16-30.jpg"></p>
<p><img src="/img/loading.gif" data-original="/.com//Snipaste_2024-02-04_17-15-56.jpg"></p>
<h2 id="分层解耦"><a href="#分层解耦" class="headerlink" title="分层解耦"></a>分层解耦</h2><h3 id="三层架构"><a href="#三层架构" class="headerlink" title="三层架构"></a>三层架构</h3><h4 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h4><p>在我们进行程序设计以及程序开发时，尽可能让每一个接口、类、方法的职责更单一些（单一职责原则）。</p>
<blockquote>
<p>单一职责原则：一个类或一个方法，就只做一件事情，只管一块功能。</p>
<p>这样就可以让类、接口、方法的复杂度更低，可读性更强，扩展性更好，也更利用后期的维护。</p>
</blockquote>
<p>我们之前开发的程序呢，并不满足单一职责原则。下面我们来分析下之前的程序：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204191650390.png" alt="image-20221204191650390"> </p>
<p>那其实我们上述案例的处理逻辑呢，从组成上看可以分为三个部分：</p>
<ul>
<li>数据访问：负责业务数据的维护操作，包括增、删、改、查等操作。</li>
<li>逻辑处理：负责业务逻辑处理的代码。</li>
<li>请求处理、响应数据：负责，接收页面的请求，给页面响应数据。</li>
</ul>
<p>按照上述的三个组成部分，在我们项目开发中呢，可以将代码分为三层：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204193837678-1715613343038-36.png" alt="image-20221204193837678"></p>
<ul>
<li>Controller：控制层。接收前端发送的请求，对请求进行处理，并响应数据。</li>
<li>Service：业务逻辑层。处理具体的业务逻辑。</li>
<li>Dao：数据访问层(Data Access Object)，也称为持久层。负责数据访问操作，包括数据的增、删、改、查。</li>
</ul>
<p>基于三层架构的程序执行流程：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204194207812-1715613343038-37.png" alt="image-20221204194207812"></p>
<ul>
<li>前端发起的请求，由Controller层接收（Controller响应数据给前端）</li>
<li>Controller层调用Service层来进行逻辑处理（Service层处理完后，把处理结果返回给Controller层）</li>
<li>Serivce层调用Dao层（逻辑处理过程中需要用到的一些数据要从Dao层获取）</li>
<li>Dao层操作文件中的数据（Dao拿到的数据会返回给Service层）</li>
</ul>
<blockquote>
<p>思考：按照三层架构的思想，如何要对业务逻辑(Service层)进行变更，会影响到Controller层和Dao层吗？ </p>
<p>答案：不会影响。 （程序的扩展性、维护性变得更好了）</p>
</blockquote>
<h4 id="代码拆分"><a href="#代码拆分" class="headerlink" title="代码拆分"></a>代码拆分</h4><p>我们使用三层架构思想，来改造下之前的程序：</p>
<ul>
<li>控制层包名：xxxx.controller</li>
<li>业务逻辑层包名：xxxx.service</li>
<li>数据访问层包名：xxxx.dao</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204195812200-1715613343038-38.png" alt="image-20221204195812200"></p>
<p><strong>控制层：</strong>接收前端发送的请求，对请求进行处理，并响应数据</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpController</span> &#123;</span><br><span class="line">    <span class="comment">//业务层对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">EmpService</span> <span class="variable">empService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpServiceA</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/listEmp&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">list</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1. 调用service层, 获取数据</span></span><br><span class="line">        List&lt;Emp&gt; empList = empService.listEmp();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 响应数据</span></span><br><span class="line">        <span class="keyword">return</span> Result.success(empList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>业务逻辑层：</strong>处理具体的业务逻辑</p>
<ul>
<li>业务接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//业务逻辑接口（制定业务标准）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpService</span> &#123;</span><br><span class="line">    <span class="comment">//获取员工列表</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">listEmp</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>业务实现类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//业务逻辑实现类（按照业务标准实现）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpServiceA</span> <span class="keyword">implements</span> <span class="title class_">EmpService</span> &#123;</span><br><span class="line">    <span class="comment">//dao层对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">EmpDao</span> <span class="variable">empDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmpDaoA</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">listEmp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1. 调用dao, 获取数据</span></span><br><span class="line">        List&lt;Emp&gt; empList = empDao.listEmp();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 对数据进行转换处理 - gender, job</span></span><br><span class="line">        empList.stream().forEach(emp -&gt; &#123;</span><br><span class="line">            <span class="comment">//处理 gender 1: 男, 2: 女</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">gender</span> <span class="operator">=</span> emp.getGender();</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;1&quot;</span>.equals(gender))&#123;</span><br><span class="line">                emp.setGender(<span class="string">&quot;男&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;2&quot;</span>.equals(gender))&#123;</span><br><span class="line">                emp.setGender(<span class="string">&quot;女&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//处理job - 1: 讲师, 2: 班主任 , 3: 就业指导</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> emp.getJob();</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;1&quot;</span>.equals(job))&#123;</span><br><span class="line">                emp.setJob(<span class="string">&quot;讲师&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;2&quot;</span>.equals(job))&#123;</span><br><span class="line">                emp.setJob(<span class="string">&quot;班主任&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;3&quot;</span>.equals(job))&#123;</span><br><span class="line">                emp.setJob(<span class="string">&quot;就业指导&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> empList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>数据访问层：</strong>负责数据的访问操作，包含数据的增、删、改、查</p>
<ul>
<li>数据访问接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//数据访问层接口（制定标准）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpDao</span> &#123;</span><br><span class="line">    <span class="comment">//获取员工列表数据</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">listEmp</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>数据访问实现类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//数据访问实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpDaoA</span> <span class="keyword">implements</span> <span class="title class_">EmpDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">listEmp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1. 加载并解析emp.xml</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">file</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getClassLoader().getResource(<span class="string">&quot;emp.xml&quot;</span>).getFile();</span><br><span class="line">        System.out.println(file);</span><br><span class="line">        List&lt;Emp&gt; empList = XmlParserUtils.parse(file, Emp.class);</span><br><span class="line">        <span class="keyword">return</span> empList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" data-original="/.com//image-20221204201342490.png" alt="image-20221204201342490"></p>
<p>三层架构的好处：</p>
<ol>
<li>复用性强</li>
<li>便于维护</li>
<li>利用扩展</li>
</ol>
<h3 id="分层解耦-1"><a href="#分层解耦-1" class="headerlink" title="分层解耦"></a>分层解耦</h3><p>刚才我们学习过程序分层思想了，接下来呢，我们来学习下程序的解耦思想。</p>
<p>解耦：解除耦合。</p>
<h4 id="耦合问题"><a href="#耦合问题" class="headerlink" title="耦合问题"></a>耦合问题</h4><p>首先需要了解软件开发涉及到的两个概念：内聚和耦合。</p>
<ul>
<li><p>内聚：软件中各个功能模块内部的功能联系。</p>
</li>
<li><p>耦合：衡量软件中各个层&#x2F;模块之间的依赖、关联的程度。</p>
</li>
</ul>
<p><strong>软件设计原则：高内聚低耦合。</strong></p>
<blockquote>
<p>高内聚指的是：一个模块中各个元素之间的联系的紧密程度，如果各个元素(语句、程序段)之间的联系程度越高，则内聚性越高，即 “高内聚”。</p>
<p>低耦合指的是：软件中各个层、模块之间的依赖关联程序越低越好。</p>
</blockquote>
<p>程序中高内聚的体现：</p>
<ul>
<li>EmpServiceA类中只编写了和员工相关的逻辑处理代码</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204202531571-1715613343038-40.png" alt="image-20221204202531571"> </p>
<p>程序中耦合代码的体现：</p>
<ul>
<li>把业务类变为EmpServiceB时，需要修改controller层中的代码</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204203904900.png" alt="image-20221204203904900"></p>
<p>高内聚、低耦合的目的是使程序模块的可重用性、移植性大大增强。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20220828215549593-1715613343038-42.png"></p>
<h4 id="解耦思路"><a href="#解耦思路" class="headerlink" title="解耦思路"></a>解耦思路</h4><p>之前我们在编写代码时，需要什么对象，就直接new一个就可以了。 这种做法呢，层与层之间代码就耦合了，当service层的实现变了之后， 我们还需要修改controller层的代码。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204204916033.png" alt="image-20221204204916033"></p>
<p> 那应该怎么解耦呢？</p>
<ul>
<li>首先不能在EmpController中使用new对象。代码如下：</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204205328069-1715613343038-44.png" alt="image-20221204205328069"></p>
<ul>
<li>此时，就存在另一个问题了，不能new，就意味着没有业务层对象（程序运行就报错），怎么办呢？<ul>
<li>我们的解决思路是：<ul>
<li>提供一个容器，容器中存储一些对象(例：EmpService对象)</li>
<li>controller程序从容器中获取EmpService类型的对象</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>我们想要实现上述解耦操作，就涉及到Spring中的两个核心概念：</p>
<ul>
<li><p><strong>控制反转：</strong> Inversion Of Control，简称IOC。对象的创建控制权由程序自身转移到外部（容器），这种思想称为控制反转。</p>
<blockquote>
<p>对象的创建权由程序员主动创建转移到容器(由容器创建、管理对象)。这个容器称为：IOC容器或Spring容器</p>
</blockquote>
</li>
<li><p><strong>依赖注入：</strong> Dependency Injection，简称DI。容器为应用程序提供运行时，所依赖的资源，称之为依赖注入。</p>
<blockquote>
<p>程序运行时需要某个资源，此时容器就为其提供这个资源。</p>
<p>例：EmpController程序运行时需要EmpService对象，Spring容器就为其提供并注入EmpService对象</p>
</blockquote>
</li>
</ul>
<p>IOC容器中创建、管理的对象，称之为：bean对象</p>
<h3 id="IOC-DI"><a href="#IOC-DI" class="headerlink" title="IOC&amp;DI"></a>IOC&amp;DI</h3><p>上面我们引出了Spring中IOC和DI的基本概念，下面我们就来具体学习下IOC和DI的代码实现。</p>
<h4 id="IOC-DI入门"><a href="#IOC-DI入门" class="headerlink" title="IOC&amp;DI入门"></a>IOC&amp;DI入门</h4><p>任务：完成Controller层、Service层、Dao层的代码解耦</p>
<ul>
<li>思路：<ol>
<li>删除Controller层、Service层中new对象的代码</li>
<li>Service层及Dao层的实现类，交给IOC容器管理</li>
<li>为Controller及Service注入运行时依赖的对象<ul>
<li>Controller程序中注入依赖的Service层对象</li>
<li>Service程序中注入依赖的Dao层对象</li>
</ul>
</li>
</ol>
</li>
</ul>
<p>第1步：删除Controller层、Service层中new对象的代码</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204212807207-1715613343038-45.png" alt="image-20221204212807207"></p>
<p>第2步：Service层及Dao层的实现类，交给IOC容器管理</p>
<ul>
<li>使用Spring提供的注解：@Component ，就可以实现类交给IOC容器管理</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204213328034-1715613343038-46.png" alt="image-20221204213328034"></p>
<p>第3步：为Controller及Service注入运行时依赖的对象</p>
<ul>
<li>使用Spring提供的注解：@Autowired ，就可以实现程序运行时IOC容器自动注入需要的依赖对象</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204213859112-1715613343038-47.png" alt="image-20221204213859112"></p>
<p>完整的三层代码：</p>
<ul>
<li><strong>Controller层：</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//运行时,从IOC容器中获取该类型对象,赋值给该变量</span></span><br><span class="line">    <span class="keyword">private</span> EmpService empService ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/listEmp&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">list</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1. 调用service, 获取数据</span></span><br><span class="line">        List&lt;Emp&gt; empList = empService.listEmp();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 响应数据</span></span><br><span class="line">        <span class="keyword">return</span> Result.success(empList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Service层：</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//将当前对象交给IOC容器管理,成为IOC容器的bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpServiceA</span> <span class="keyword">implements</span> <span class="title class_">EmpService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//运行时,从IOC容器中获取该类型对象,赋值给该变量</span></span><br><span class="line">    <span class="keyword">private</span> EmpDao empDao ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">listEmp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1. 调用dao, 获取数据</span></span><br><span class="line">        List&lt;Emp&gt; empList = empDao.listEmp();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 对数据进行转换处理 - gender, job</span></span><br><span class="line">        empList.stream().forEach(emp -&gt; &#123;</span><br><span class="line">            <span class="comment">//处理 gender 1: 男, 2: 女</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">gender</span> <span class="operator">=</span> emp.getGender();</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;1&quot;</span>.equals(gender))&#123;</span><br><span class="line">                emp.setGender(<span class="string">&quot;男&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;2&quot;</span>.equals(gender))&#123;</span><br><span class="line">                emp.setGender(<span class="string">&quot;女&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//处理job - 1: 讲师, 2: 班主任 , 3: 就业指导</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> emp.getJob();</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;1&quot;</span>.equals(job))&#123;</span><br><span class="line">                emp.setJob(<span class="string">&quot;讲师&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;2&quot;</span>.equals(job))&#123;</span><br><span class="line">                emp.setJob(<span class="string">&quot;班主任&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;3&quot;</span>.equals(job))&#123;</span><br><span class="line">                emp.setJob(<span class="string">&quot;就业指导&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> empList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Dao层：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span> <span class="comment">//将当前对象交给IOC容器管理,成为IOC容器的bean</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpDaoA</span> <span class="keyword">implements</span> <span class="title class_">EmpDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">listEmp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1. 加载并解析emp.xml</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">file</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getClassLoader().getResource(<span class="string">&quot;emp.xml&quot;</span>).getFile();</span><br><span class="line">        System.out.println(file);</span><br><span class="line">        List&lt;Emp&gt; empList = XmlParserUtils.parse(file, Emp.class);</span><br><span class="line">        <span class="keyword">return</span> empList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>运行测试：</p>
<ul>
<li>启动SpringBoot引导类，打开浏览器，输入：<a target="_blank" rel="noopener" href="http://localhost:8080/emp.html">http://localhost:8080/emp.html</a></li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204185455556-1715613343038-48.png" alt="image-20221204185455556"></p>
<h4 id="IOC详解"><a href="#IOC详解" class="headerlink" title="IOC详解"></a>IOC详解</h4><p>通过IOC和DI的入门程序呢，我们已经基本了解了IOC和DI的基础操作。接下来呢，我们学习下IOC控制反转和DI依赖注入的细节。</p>
<h5 id="bean的声明"><a href="#bean的声明" class="headerlink" title="bean的声明"></a>bean的声明</h5><p>前面我们提到IOC控制反转，就是将对象的控制权交给Spring的IOC容器，由IOC容器创建及管理对象。IOC容器创建的对象称为bean对象。</p>
<p>在之前的入门案例中，要把某个对象交给IOC容器管理，需要在类上添加一个注解：@Component </p>
<p>而Spring框架为了更好的标识web应用程序开发当中，bean对象到底归属于哪一层，又提供了@Component的衍生注解：</p>
<ul>
<li>@Controller    （标注在控制层类上）</li>
<li>@Service          （标注在业务层类上）</li>
<li>@Repository    （标注在数据访问层类上）</li>
</ul>
<p>修改入门案例代码：</p>
<ul>
<li><strong>Controller层：</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span>  <span class="comment">//@RestController = @Controller + @ResponseBody</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//运行时,从IOC容器中获取该类型对象,赋值给该变量</span></span><br><span class="line">    <span class="keyword">private</span> EmpService empService ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/listEmp&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">list</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//1. 调用service, 获取数据</span></span><br><span class="line">        List&lt;Emp&gt; empList = empService.listEmp();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 响应数据</span></span><br><span class="line">        <span class="keyword">return</span> Result.success(empList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Service层：</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpServiceA</span> <span class="keyword">implements</span> <span class="title class_">EmpService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//运行时,从IOC容器中获取该类型对象,赋值给该变量</span></span><br><span class="line">    <span class="keyword">private</span> EmpDao empDao ;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">listEmp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1. 调用dao, 获取数据</span></span><br><span class="line">        List&lt;Emp&gt; empList = empDao.listEmp();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 对数据进行转换处理 - gender, job</span></span><br><span class="line">        empList.stream().forEach(emp -&gt; &#123;</span><br><span class="line">            <span class="comment">//处理 gender 1: 男, 2: 女</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">gender</span> <span class="operator">=</span> emp.getGender();</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;1&quot;</span>.equals(gender))&#123;</span><br><span class="line">                emp.setGender(<span class="string">&quot;男&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;2&quot;</span>.equals(gender))&#123;</span><br><span class="line">                emp.setGender(<span class="string">&quot;女&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//处理job - 1: 讲师, 2: 班主任 , 3: 就业指导</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">job</span> <span class="operator">=</span> emp.getJob();</span><br><span class="line">            <span class="keyword">if</span>(<span class="string">&quot;1&quot;</span>.equals(job))&#123;</span><br><span class="line">                emp.setJob(<span class="string">&quot;讲师&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;2&quot;</span>.equals(job))&#123;</span><br><span class="line">                emp.setJob(<span class="string">&quot;班主任&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;3&quot;</span>.equals(job))&#123;</span><br><span class="line">                emp.setJob(<span class="string">&quot;就业指导&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> empList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Dao层：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmpDaoA</span> <span class="keyword">implements</span> <span class="title class_">EmpDao</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">listEmp</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//1. 加载并解析emp.xml</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">file</span> <span class="operator">=</span> <span class="built_in">this</span>.getClass().getClassLoader().getResource(<span class="string">&quot;emp.xml&quot;</span>).getFile();</span><br><span class="line">        System.out.println(file);</span><br><span class="line">        List&lt;Emp&gt; empList = XmlParserUtils.parse(file, Emp.class);</span><br><span class="line">        <span class="keyword">return</span> empList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>要把某个对象交给IOC容器管理，需要在对应的类上加上如下注解之一：</p>
<table>
<thead>
<tr>
<th align="left">注解</th>
<th>说明</th>
<th>位置</th>
</tr>
</thead>
<tbody><tr>
<td align="left">@Controller</td>
<td>@Component的衍生注解</td>
<td>标注在控制器类上</td>
</tr>
<tr>
<td align="left">@Service</td>
<td>@Component的衍生注解</td>
<td>标注在业务类上</td>
</tr>
<tr>
<td align="left">@Repository</td>
<td>@Component的衍生注解</td>
<td>标注在数据访问类上（由于与mybatis整合，用的少）</td>
</tr>
<tr>
<td align="left">@Component</td>
<td>声明bean的基础注解</td>
<td>不属于以上三类时，用此注解</td>
</tr>
</tbody></table>
<blockquote>
<p>查看源码：<img src="/img/loading.gif" data-original="/.com//image-20221204221320230-1715613343038-49.png" alt="image-20221204221320230"></p>
</blockquote>
<p>在IOC容器中，每一个Bean都有一个属于自己的名字，可以通过注解的value属性指定bean的名字。如果没有指定，默认为类名首字母小写。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204222650873-1715613343038-50.png" alt="image-20221204222650873"></p>
<blockquote>
<p>注意事项: </p>
<ul>
<li>声明bean的时候，可以通过value属性指定bean的名字，如果没有指定，默认为类名首字母小写。</li>
<li>使用以上四个注解都可以声明bean，但是在springboot集成web开发中，声明控制器bean只能用@Controller。</li>
</ul>
</blockquote>
<h5 id="组件扫描"><a href="#组件扫描" class="headerlink" title="组件扫描"></a>组件扫描</h5><p>问题：使用前面学习的四个注解声明的bean，一定会生效吗？</p>
<p>答案：不一定。（原因：bean想要生效，还需要被组件扫描）</p>
<p> 下面我们通过修改项目工程的目录结构，来测试bean对象是否生效：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204223602694-1715613343038-51.png" alt="image-20221204223602694"></p>
<p>运行程序后，报错：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204223815554-1715613343038-52.png" alt="image-20221204223815554"></p>
<p>为什么没有找到bean对象呢？</p>
<ul>
<li>使用四大注解声明的bean，要想生效，还需要被组件扫描注解@ComponentScan扫描</li>
</ul>
<blockquote>
<p>@ComponentScan注解虽然没有显式配置，但是实际上已经包含在了引导类声明注解 @SpringBootApplication 中，&#x3D;&#x3D;<strong>默认扫描的范围是SpringBoot启动类所在包及其子包</strong>&#x3D;&#x3D;。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204224643683-1715613343038-53.png" alt="image-20221204224643683"> </p>
</blockquote>
<ul>
<li>解决方案：手动添加@ComponentScan注解，指定要扫描的包   （&#x3D;&#x3D;仅做了解，不推荐&#x3D;&#x3D;）</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204225437297-1715613343038-54.png" alt="image-20221204225437297"></p>
<p>推荐做法（如下图）：</p>
<ul>
<li>将我们定义的controller，service，dao这些包呢，都放在引导类所在包com.itheima的子包下，这样我们定义的bean就会被自动的扫描到</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204225815624-1715613343038-55.png" alt="image-20221204225815624"></p>
<h4 id="DI详解"><a href="#DI详解" class="headerlink" title="DI详解"></a>DI详解</h4><p>上一小节我们讲解了控制反转IOC的细节，接下来呢，我们学习依赖注解DI的细节。</p>
<p>依赖注入，是指IOC容器要为应用程序去提供运行时所依赖的资源，而资源指的就是对象。</p>
<p>在入门程序案例中，我们使用了@Autowired这个注解，完成了依赖注入的操作，而这个Autowired翻译过来叫：自动装配。</p>
<p>@Autowired注解，默认是按照<strong>类型</strong>进行自动装配的（去IOC容器中找某个类型的对象，然后完成注入操作）</p>
<blockquote>
<p>入门程序举例：在EmpController运行的时候，就要到IOC容器当中去查找EmpService这个类型的对象，而我们的IOC容器中刚好有一个EmpService这个类型的对象，所以就找到了这个类型的对象完成注入操作。</p>
</blockquote>
<p>那如果在IOC容器中，存在多个相同类型的bean对象，会出现什么情况呢？</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204232154445-1715613343038-56.png" alt="image-20221204232154445"></p>
<ul>
<li>程序运行会报错</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204231616724-1715613343038-57.png" alt="image-20221204231616724"></p>
<p>如何解决上述问题呢？Spring提供了以下几种解决方案：</p>
<ul>
<li><p>@Primary</p>
</li>
<li><p>@Qualifier</p>
</li>
<li><p>@Resource</p>
</li>
</ul>
<p>使用@Primary注解：当存在多个相同类型的Bean注入时，加上@Primary注解，来确定默认的实现。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204232501679-1715613343038-58.png" alt="image-20221204232501679"> </p>
<p>使用@Qualifier注解：指定当前要注入的bean对象。 在@Qualifier的value属性中，指定注入的bean的名称。</p>
<ul>
<li>@Qualifier注解不能单独使用，必须配合@Autowired使用</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204233333606-1715613343039-59.png" alt="image-20221204233333606"></p>
<p>使用@Resource注解：是按照bean的名称进行注入。通过name属性指定要注入的bean的名称。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221204233637735-1715613343039-60.png" alt="image-20221204233637735"></p>
<blockquote>
<p>面试题 ： @Autowird 与 @Resource的区别</p>
<ul>
<li>@Autowired 是spring框架提供的注解，而@Resource是JDK提供的注解</li>
<li>@Autowired 默认是按照类型注入，而@Resource是按照名称注入</li>
</ul>
</blockquote>
<h1 id="Mybatis入门"><a href="#Mybatis入门" class="headerlink" title="Mybatis入门"></a>Mybatis入门</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在前面我们学习MySQL数据库时，都是利用图形化客户端工具(如：idea、datagrip)，来操作数据库的。</p>
<blockquote>
<p>在客户端工具中，编写增删改查的SQL语句，发给MySQL数据库管理系统，由数据库管理系统执行SQL语句并返回执行结果。</p>
<p>增删改操作：返回受影响行数</p>
<p>查询操作：返回结果集(查询的结果)</p>
</blockquote>
<p>我们做为后端程序开发人员，通常会使用Java程序来完成对数据库的操作。Java程序操作数据库，现在主流的方式是：Mybatis。</p>
<p>什么是MyBatis?</p>
<ul>
<li><p>MyBatis是一款优秀的 <strong>持久层</strong> <strong>框架</strong>，用于简化JDBC的开发。</p>
</li>
<li><p>MyBatis本是 Apache的一个开源项目iBatis，2010年这个项目由apache迁移到了google code，并且改名为MyBatis 。2013年11月迁移到Github。</p>
</li>
<li><p>官网：<a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a></p>
</li>
</ul>
<p>在上面我们提到了两个词：一个是持久层，另一个是框架。</p>
<ul>
<li>持久层：指的是就是数据访问层(dao)，是用来操作数据库的。</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20220901114951631-1715613343040-207.png" alt="image-20220901114951631"> </p>
<ul>
<li>框架：是一个半成品软件，是一套可重用的、通用的、软件基础代码模型。在框架的基础上进行软件开发更加高效、规范、通用、可拓展。</li>
</ul>
<p>Mybatis课程安排：</p>
<ul>
<li><p>Mybatis入门</p>
</li>
<li><p>Mybatis基础增删改查</p>
</li>
<li><p>Mybatis动态SQL</p>
</li>
</ul>
<p>接下来，我们就通过一个入门程序，让大家快速感受一下通过Mybatis如何来操作数据库。</p>
<h2 id="1-快速入门"><a href="#1-快速入门" class="headerlink" title="1. 快速入门"></a>1. 快速入门</h2><p>需求：使用Mybatis查询所有用户数据。</p>
<h3 id="1-1-入门程序分析"><a href="#1-1-入门程序分析" class="headerlink" title="1.1 入门程序分析"></a>1.1 入门程序分析</h3><p>以前我们是在图形化客户端工具中编写SQL查询代码，发送给数据库执行，数据库执行后返回操作结果。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221209155704203-1715613343040-208.png" alt="image-20221209155704203"> </p>
<p>图形化工具会把数据库执行的查询结果，使用表格的形式展现出来</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20220901121116813-1715613343040-209.png" alt="image-20220901121116813"> </p>
<p>现在使用Mybatis操作数据库，就是在Mybatis中编写SQL查询代码，发送给数据库执行，数据库执行后返回结果。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221209155904370-1715613343040-210.png" alt="image-20221209155904370"></p>
<p> Mybatis会把数据库执行的查询结果，使用实体类封装起来（一行记录对应一个实体类对象）</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221209161623051-1715613343040-211.png" alt="image-20221209161623051"></p>
<p>Mybatis操作数据库的步骤：</p>
<ol>
<li><p>准备工作(创建springboot工程、数据库表user、实体类User)</p>
</li>
<li><p>引入Mybatis的相关依赖，配置Mybatis(数据库连接信息)</p>
</li>
<li><p>编写SQL语句(注解&#x2F;XML)</p>
</li>
</ol>
<h3 id="1-2-入门程序实现"><a href="#1-2-入门程序实现" class="headerlink" title="1.2 入门程序实现"></a>1.2 入门程序实现</h3><h4 id="1-2-1-准备工作"><a href="#1-2-1-准备工作" class="headerlink" title="1.2.1 准备工作"></a>1.2.1 准备工作</h4><h5 id="1-2-1-1-创建springboot工程"><a href="#1-2-1-1-创建springboot工程" class="headerlink" title="1.2.1.1 创建springboot工程"></a>1.2.1.1 创建springboot工程</h5><p>创建springboot工程，并导入 mybatis的起步依赖、mysql的驱动包。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221209162827242-1715613343040-212.png" alt="image-20221209162827242"></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221209163123443-1715613343040-213.png" alt="image-20221209163123443"></p>
<blockquote>
<p>项目工程创建完成后，自动在pom.xml文件中，导入Mybatis依赖和MySQL驱动依赖</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 仅供参考：只粘贴了pom.xml中部分内容 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- mybatis起步依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mysql驱动包依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- spring单元测试 (集成了junit) --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-2-配置Mybatis"><a href="#1-2-2-配置Mybatis" class="headerlink" title="1.2.2 配置Mybatis"></a>1.2.2 配置Mybatis</h4><blockquote>
<p>在之前使用图形化客户端工具，连接MySQL数据库时，需要配置：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221209172527630-1715613343040-214.png" alt="image-20221209172527630"></p>
<p>连接数据库的四大参数：</p>
<ul>
<li>MySQL驱动类 </li>
<li>登录名</li>
<li>密码</li>
<li>数据库连接字符串</li>
</ul>
</blockquote>
<p>基于上述分析，在Mybatis中要连接数据库，同样也需要以上4个参数配置。</p>
<p>在springboot项目中，可以编写application.properties文件，配置数据库连接信息。我们要连接数据库，就需要配置数据库连接的基本信息，包括：driver-class-name、url 、username，password。</p>
<blockquote>
<p>在入门程序中，大家可以直接这么配置，后面会介绍什么是驱动。</p>
</blockquote>
<p>application.properties:</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#驱动类名称</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment">#数据库连接的url</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="comment">#连接数据库的用户名</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="comment">#连接数据库的密码</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">1234</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>上述的配置，可以直接复制过去，不要敲错了。 全部都是 spring.datasource.xxxx 开头。</p>
</blockquote>
<h4 id="1-2-3-编写SQL语句"><a href="#1-2-3-编写SQL语句" class="headerlink" title="1.2.3 编写SQL语句"></a>1.2.3 编写SQL语句</h4><p>在创建出来的springboot工程中，在引导类所在包下，在创建一个包 mapper。在mapper包下创建一个接口 UserMapper ，这是一个持久层接口（Mybatis的持久层接口规范一般都叫 XxxMapper）。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221209175843651-1715613343040-215.png" alt="image-20221209175843651"></p>
<p>UserMapper：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.itheima.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Mapper;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Select;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//查询所有用户数据</span></span><br><span class="line">    <span class="meta">@Select(&quot;select id, name, age, gender, phone from user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>@Mapper注解：表示是mybatis中的Mapper接口</p>
<ul>
<li>程序运行时：框架会自动生成接口的实现类对象(代理对象)，并给交Spring的IOC容器管理</li>
</ul>
<p> @Select注解：代表的就是select查询，用于书写select查询语句</p>
</blockquote>
<h4 id="1-2-4-单元测试"><a href="#1-2-4-单元测试" class="headerlink" title="1.2.4 单元测试"></a>1.2.4 单元测试</h4><p>在创建出来的SpringBoot工程中，在src下的test目录下，已经自动帮我们创建好了测试类 ，并且在测试类上已经添加了注解 @SpringBootTest，代表该测试类已经与SpringBoot整合。 </p>
<p>该测试类在运行时，会自动通过引导类加载Spring的环境（IOC容器）。我们要测试那个bean对象，就可以直接通过@Autowired注解直接将其注入进行，然后就可以测试了。 </p>
<p>测试类代码如下： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisQuickstartApplicationTests</span> &#123;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">	</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span>&#123;</span><br><span class="line">        List&lt;User&gt; userList = userMapper.list();</span><br><span class="line">        <span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">User&#123;id=1, name=&#x27;白眉鹰王&#x27;, age=55, gender=1, phone=&#x27;18800000000&#x27;&#125;</span><br><span class="line">User&#123;id=2, name=&#x27;金毛狮王&#x27;, age=45, gender=1, phone=&#x27;18800000001&#x27;&#125;</span><br><span class="line">User&#123;id=3, name=&#x27;青翼蝠王&#x27;, age=38, gender=1, phone=&#x27;18800000002&#x27;&#125;</span><br><span class="line">User&#123;id=4, name=&#x27;紫衫龙王&#x27;, age=42, gender=2, phone=&#x27;18800000003&#x27;&#125;</span><br><span class="line">User&#123;id=5, name=&#x27;光明左使&#x27;, age=37, gender=1, phone=&#x27;18800000004&#x27;&#125;</span><br><span class="line">User&#123;id=6, name=&#x27;光明右使&#x27;, age=48, gender=1, phone=&#x27;18800000005&#x27;&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="1-3-解决SQL警告与提示"><a href="#1-3-解决SQL警告与提示" class="headerlink" title="1.3 解决SQL警告与提示"></a>1.3 解决SQL警告与提示</h3><p>默认我们在UserMapper接口上加的@Select注解中编写SQL语句是没有提示的。 如果想让idea给我们提示对应的SQL语句，我们需要在IDEA中配置与MySQL数据库的链接。 </p>
<p>默认我们在UserMapper接口上的@Select注解中编写SQL语句是没有提示的。如果想让idea给出提示，可以做如下配置：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210143348119.png" alt="image-20221210143348119"></p>
<p>配置完成之后，发现SQL语句中的关键字有提示了，但还存在不识别表名(列名)的情况：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210143934318-1715613343040-217.png" alt="image-20221210143934318"></p>
<blockquote>
<p>产生原因：Idea和数据库没有建立连接，不识别表信息</p>
<p>解决方案：在Idea中配置MySQL数据库连接</p>
</blockquote>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210144139792.png" alt="image-20221210144139792"> </p>
<blockquote>
<p>在配置的时候指定连接那个数据库，如上图所示连接的就是mybatis数据库。</p>
</blockquote>
<h2 id="2-JDBC介绍-了解"><a href="#2-JDBC介绍-了解" class="headerlink" title="2. JDBC介绍(了解)"></a>2. JDBC介绍(了解)</h2><h3 id="2-1-介绍"><a href="#2-1-介绍" class="headerlink" title="2.1 介绍"></a>2.1 介绍</h3><p>通过Mybatis的快速入门，我们明白了，通过Mybatis可以很方便的进行数据库的访问操作。但是大家要明白，其实java语言操作数据库呢，只能通过一种方式：使用sun公司提供的 JDBC 规范。</p>
<blockquote>
<p>Mybatis框架，就是对原始的JDBC程序的封装。 </p>
</blockquote>
<p>那到底什么是JDBC呢，接下来，我们就来介绍一下。</p>
<p>JDBC： ( Java DataBase Connectivity )，就是使用Java语言操作关系型数据库的一套API。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210144811961-1715613343040-219.png" alt="image-20221210144811961"> </p>
<blockquote>
<p>本质：</p>
<ul>
<li><p>sun公司官方定义的一套操作所有关系型数据库的规范，即接口。</p>
</li>
<li><p>各个数据库厂商去实现这套接口，提供数据库驱动jar包。</p>
</li>
<li><p>我们可以使用这套接口(JDBC)编程，真正执行的代码是驱动jar包中的实现类。</p>
</li>
</ul>
</blockquote>
<h3 id="2-2-代码"><a href="#2-2-代码" class="headerlink" title="2.2 代码"></a>2.2 代码</h3><p>下面我们看看原始的JDBC程序是如何操作数据库的。操作步骤如下：</p>
<ol>
<li>注册驱动</li>
<li>获取连接对象</li>
<li>执行SQL语句，返回执行结果</li>
<li>处理执行结果</li>
<li>释放资源</li>
</ol>
<blockquote>
<p>在pom.xml文件中已引入MySQL驱动依赖，我们直接编写JDBC代码即可</p>
</blockquote>
<p>JDBC具体代码实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.itheima.pojo.User;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcTest</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testJdbc</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1. 注册驱动</span></span><br><span class="line">        Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 获取数据库连接</span></span><br><span class="line">        String url=<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/mybatis&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> <span class="string">&quot;root&quot;</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> <span class="string">&quot;1234&quot;</span>;</span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(url, username, password);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 执行SQL</span></span><br><span class="line">        <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement(); <span class="comment">//操作SQL的对象</span></span><br><span class="line">        String sql=<span class="string">&quot;select id,name,age,gender,phone from user&quot;</span>;</span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> statement.executeQuery(sql);<span class="comment">//SQL查询结果会封装在ResultSet对象中</span></span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();<span class="comment">//集合对象（用于存储User对象）</span></span><br><span class="line">        <span class="comment">//4. 处理SQL执行结果</span></span><br><span class="line">        <span class="keyword">while</span> (rs.next())&#123;</span><br><span class="line">            <span class="comment">//取出一行记录中id、name、age、gender、phone下的数据</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">id</span> <span class="operator">=</span> rs.getInt(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">            <span class="type">short</span> <span class="variable">age</span> <span class="operator">=</span> rs.getShort(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">            <span class="type">short</span> <span class="variable">gender</span> <span class="operator">=</span> rs.getShort(<span class="string">&quot;gender&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;phone&quot;</span>);</span><br><span class="line">            <span class="comment">//把一行记录中的数据，封装到User对象中</span></span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(id,name,age,gender,phone);</span><br><span class="line">            userList.add(user);<span class="comment">//User对象添加到集合</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//5. 释放资源</span></span><br><span class="line">        statement.close();</span><br><span class="line">        connection.close();</span><br><span class="line">        rs.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历集合</span></span><br><span class="line">        <span class="keyword">for</span> (User user : userList) &#123;</span><br><span class="line">            System.out.println(user);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>DriverManager(类)：数据库驱动管理类。</p>
<ul>
<li><p>作用：</p>
<ol>
<li><p>注册驱动</p>
</li>
<li><p>创建java代码和数据库之间的连接，即获取Connection对象</p>
</li>
</ol>
</li>
</ul>
<p>Connection(接口)：建立数据库连接的对象</p>
<ul>
<li>作用：用于建立java程序和数据库之间的连接</li>
</ul>
<p>Statement(接口)： 数据库操作对象(执行SQL语句的对象)。</p>
<ul>
<li>作用：用于向数据库发送sql语句</li>
</ul>
<p>ResultSet(接口)：结果集对象（一张虚拟表）</p>
<ul>
<li>作用：sql查询语句的执行结果会封装在ResultSet中</li>
</ul>
</blockquote>
<p>通过上述代码，我们看到直接基于JDBC程序来操作数据库，代码实现非常繁琐，所以在项目开发中，我们很少使用。  在项目开发中，通常会使用Mybatis这类的高级技术来操作数据库，从而简化数据库操作、提高开发效率。</p>
<h3 id="2-3-问题分析"><a href="#2-3-问题分析" class="headerlink" title="2.3 问题分析"></a>2.3 问题分析</h3><p>原始的JDBC程序，存在以下几点问题：</p>
<ol>
<li>数据库链接的四要素(驱动、链接、用户名、密码)全部硬编码在java代码中</li>
<li>查询结果的解析及封装非常繁琐</li>
<li>每一次查询数据库都需要获取连接,操作完毕后释放连接, 资源浪费, 性能降低</li>
</ol>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210153407998.png" alt="image-20221210153407998"></p>
<h3 id="2-4-技术对比"><a href="#2-4-技术对比" class="headerlink" title="2.4 技术对比"></a>2.4 技术对比</h3><p>分析了JDBC的缺点之后，我们再来看一下在mybatis中，是如何解决这些问题的：</p>
<ol>
<li><p>数据库连接四要素(驱动、链接、用户名、密码)，都配置在springboot默认的配置文件 application.properties中</p>
</li>
<li><p>查询结果的解析及封装，由mybatis自动完成映射封装，我们无需关注</p>
</li>
<li><p>在mybatis中使用了数据库连接池技术，从而避免了频繁的创建连接、销毁连接而带来的资源浪费。</p>
</li>
</ol>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210154324151.png" alt="image-20221210154324151"></p>
<blockquote>
<p>使用SpringBoot+Mybatis的方式操作数据库，能够提升开发效率、降低资源浪费</p>
</blockquote>
<p>而对于Mybatis来说，我们在开发持久层程序操作数据库时，需要重点关注以下两个方面：</p>
<ol>
<li><p>application.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#驱动类名称</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment">#数据库连接的url</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="comment">#连接数据库的用户名</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="comment">#连接数据库的密码</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">1234</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Mapper接口（编写SQL语句）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select id, name, age, gender, phone from user&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">list</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="3-数据库连接池"><a href="#3-数据库连接池" class="headerlink" title="3. 数据库连接池"></a>3. 数据库连接池</h2><p>在前面我们所讲解的mybatis中，使用了数据库连接池技术，避免频繁的创建连接、销毁连接而带来的资源浪费。</p>
<p>下面我们就具体的了解下数据库连接池。</p>
<h3 id="3-1-介绍"><a href="#3-1-介绍" class="headerlink" title="3.1 介绍"></a>3.1 介绍</h3><p><img src="/img/loading.gif" data-original="/.com//image-20221210160341852-1715613343040-222.png" alt="image-20221210160341852"></p>
<blockquote>
<p>没有使用数据库连接池：</p>
<ul>
<li>客户端执行SQL语句：要先创建一个新的连接对象，然后执行SQL语句，SQL语句执行后又需要关闭连接对象从而释放资源，每次执行SQL时都需要创建连接、销毁链接，这种频繁的重复创建销毁的过程是比较耗费计算机的性能。</li>
</ul>
</blockquote>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210161016314-1715613343040-223.png" alt="image-20221210161016314"></p>
<p>数据库连接池是个容器，负责分配、管理数据库连接(Connection)</p>
<ul>
<li>程序在启动时，会在数据库连接池(容器)中，创建一定数量的Connection对象</li>
</ul>
<p>允许应用程序重复使用一个现有的数据库连接，而不是再重新建立一个</p>
<ul>
<li>客户端在执行SQL时，先从连接池中获取一个Connection对象，然后在执行SQL语句，SQL语句执行完之后，释放Connection时就会把Connection对象归还给连接池（Connection对象可以复用）</li>
</ul>
<p>释放空闲时间超过最大空闲时间的连接，来避免因为没有释放连接而引起的数据库连接遗漏</p>
<ul>
<li>客户端获取到Connection对象了，但是Connection对象并没有去访问数据库(处于空闲)，数据库连接池发现Connection对象的空闲时间 &gt; 连接池中预设的最大空闲时间，此时数据库连接池就会自动释放掉这个连接对象</li>
</ul>
<p>数据库连接池的好处：</p>
<ol>
<li>资源重用</li>
<li>提升系统响应速度</li>
<li>避免数据库连接遗漏</li>
</ol>
<h3 id="3-2-产品"><a href="#3-2-产品" class="headerlink" title="3.2 产品"></a>3.2 产品</h3><p>要怎么样实现数据库连接池呢？</p>
<ul>
<li><p>官方(sun)提供了数据库连接池标准（javax.sql.DataSource接口）</p>
<ul>
<li><p>功能：获取连接 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException;</span><br></pre></td></tr></table></figure>
</li>
<li><p>第三方组织必须按照DataSource接口实现</p>
</li>
</ul>
</li>
</ul>
<p>常见的数据库连接池：</p>
<ul>
<li>C3P0</li>
<li>DBCP</li>
<li>Druid</li>
<li>Hikari (springboot默认)</li>
</ul>
<p>现在使用更多的是：Hikari、Druid  （性能更优越）</p>
<ul>
<li>Hikari（追光者） [默认的连接池]</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20220901144923251-1715613343040-224.png" alt="image-20220901144923251"> </p>
<ul>
<li><p>Druid（德鲁伊）</p>
<ul>
<li><p>Druid连接池是阿里巴巴开源的数据库连接池项目 </p>
</li>
<li><p>功能强大，性能优秀，是Java语言最好的数据库连接池之一</p>
</li>
</ul>
</li>
</ul>
<p>​		</p>
<p>如果我们想把默认的数据库连接池切换为Druid数据库连接池，只需要完成以下两步操作即可：</p>
<blockquote>
<p>参考官方地址：<a target="_blank" rel="noopener" href="https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter">https://github.com/alibaba/druid/tree/master/druid-spring-boot-starter</a></p>
</blockquote>
<ol>
<li>在pom.xml文件中引入依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Druid连接池依赖 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在application.properties中引入数据库连接配置</li>
</ol>
<p>方式1：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.druid.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.druid.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="attr">spring.datasource.druid.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.druid.password</span>=<span class="string">1234</span></span><br></pre></td></tr></table></figure>

<p>方式2：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">1234</span></span><br></pre></td></tr></table></figure>









<h2 id="4-lombok"><a href="#4-lombok" class="headerlink" title="4. lombok"></a>4. lombok</h2><h3 id="4-1-介绍"><a href="#4-1-介绍" class="headerlink" title="4.1 介绍"></a>4.1 介绍</h3><p>Lombok是一个实用的Java类库，可以通过简单的注解来简化和消除一些必须有但显得很臃肿的Java代码。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210164641266.png" alt="image-20221210164641266"></p>
<blockquote>
<p>通过注解的形式自动生成构造器、getter&#x2F;setter、equals、hashcode、toString等方法，并可以自动化生成日志变量，简化java开发、提高效率。</p>
</blockquote>
<table>
<thead>
<tr>
<th><strong>注解</strong></th>
<th><strong>作用</strong></th>
</tr>
</thead>
<tbody><tr>
<td>@Getter&#x2F;@Setter</td>
<td>为所有的属性提供get&#x2F;set方法</td>
</tr>
<tr>
<td>@ToString</td>
<td>会给类自动生成易阅读的  toString 方法</td>
</tr>
<tr>
<td>@EqualsAndHashCode</td>
<td>根据类所拥有的非静态字段自动重写 equals 方法和  hashCode 方法</td>
</tr>
<tr>
<td>@Data</td>
<td>提供了更综合的生成代码功能（@Getter  + @Setter + @ToString + @EqualsAndHashCode）</td>
</tr>
<tr>
<td>@NoArgsConstructor</td>
<td>为实体类生成无参的构造器方法</td>
</tr>
<tr>
<td>@AllArgsConstructor</td>
<td>为实体类生成除了static修饰的字段之外带有各参数的构造器方法。</td>
</tr>
</tbody></table>
<h3 id="4-2-使用"><a href="#4-2-使用" class="headerlink" title="4.2 使用"></a>4.2 使用</h3><p>第1步：在pom.xml文件中引入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 在springboot的父工程中，已经集成了lombok并指定了版本号，故当前引入依赖时不需要指定version --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>第2步：在实体类上添加注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Short age;</span><br><span class="line">    <span class="keyword">private</span> Short gender;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在实体类上添加了@Data注解，那么这个类在编译时期，就会生成getter&#x2F;setter、equals、hashcode、toString等方法。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210170733921-1715613343040-226.png" alt="image-20221210170733921"></p>
</blockquote>
<p>说明：@Data注解中不包含全参构造方法，通常在实体类上，还会添加上：全参构造、无参构造</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span> <span class="comment">//getter方法、setter方法、toString方法、hashCode方法、equals方法</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span> <span class="comment">//无参构造</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span><span class="comment">//全参构造</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Short age;</span><br><span class="line">    <span class="keyword">private</span> Short gender;</span><br><span class="line">    <span class="keyword">private</span> String phone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Lombok的注意事项：</p>
<ul>
<li>Lombok会在编译时，会自动生成对应的java代码</li>
<li>在使用lombok时，还需要安装一个lombok的插件（新版本的IDEA中自带）</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210165506359-1715613343040-227.png" alt="image-20221210165506359"></p>
<h2 id="5-Mybatis基础操作"><a href="#5-Mybatis基础操作" class="headerlink" title="5. Mybatis基础操作"></a>5. Mybatis基础操作</h2><p>学习完mybatis入门后，我们继续学习mybatis基础操作。</p>
<h3 id="5-1-需求"><a href="#5-1-需求" class="headerlink" title="5.1 需求"></a>5.1 需求</h3><p>需求说明：</p>
<ul>
<li>根据资料中提供的《tlias智能学习辅助系统》页面原型及需求，完成员工管理的需求开发。</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210180155700-1715613343040-228.png" alt="image-20221210180155700"> </p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210180343288-1715613343040-229.png" alt="image-20221210180343288"></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210180515206-1715613343040-230.png" alt="image-20221210180515206"></p>
<p>通过分析以上的页面原型和需求，我们确定了功能列表：</p>
<ol>
<li><p>查询</p>
<ul>
<li>根据主键ID查询</li>
<li>条件查询</li>
</ul>
</li>
<li><p>新增</p>
</li>
<li><p>更新</p>
</li>
<li><p>删除</p>
<ul>
<li>根据主键ID删除</li>
<li>根据主键ID批量删除</li>
</ul>
</li>
</ol>
<h3 id="5-2-准备"><a href="#5-2-准备" class="headerlink" title="5.2 准备"></a>5.2 准备</h3><p>实施前的准备工作：</p>
<ol>
<li>准备数据库表</li>
<li>创建一个新的springboot工程，选择引入对应的起步依赖（mybatis、mysql驱动、lombok）</li>
<li>application.properties中引入数据库连接信息</li>
<li>创建对应的实体类 Emp（实体类属性采用驼峰命名）</li>
<li>准备Mapper接口 EmpMapper</li>
</ol>
<p><strong>准备数据库表</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">-- 部门管理</span><br><span class="line">create table dept</span><br><span class="line">(</span><br><span class="line">    id          int unsigned primary key auto_increment comment &#x27;主键ID&#x27;,</span><br><span class="line">    name        varchar(10) not null unique comment &#x27;部门名称&#x27;,</span><br><span class="line">    create_time datetime    not null comment &#x27;创建时间&#x27;,</span><br><span class="line">    update_time datetime    not null comment &#x27;修改时间&#x27;</span><br><span class="line">) comment &#x27;部门表&#x27;;</span><br><span class="line">-- 部门表测试数据</span><br><span class="line">insert into dept (id, name, create_time, update_time)</span><br><span class="line">values (1, &#x27;学工部&#x27;, now(), now()),</span><br><span class="line">       (2, &#x27;教研部&#x27;, now(), now()),</span><br><span class="line">       (3, &#x27;咨询部&#x27;, now(), now()),</span><br><span class="line">       (4, &#x27;就业部&#x27;, now(), now()),</span><br><span class="line">       (5, &#x27;人事部&#x27;, now(), now());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-- 员工管理</span><br><span class="line">create table emp</span><br><span class="line">(</span><br><span class="line">    id          int unsigned primary key auto_increment comment &#x27;ID&#x27;,</span><br><span class="line">    username    varchar(20)      not null unique comment &#x27;用户名&#x27;,</span><br><span class="line">    password    varchar(32) default &#x27;123456&#x27; comment &#x27;密码&#x27;,</span><br><span class="line">    name        varchar(10)      not null comment &#x27;姓名&#x27;,</span><br><span class="line">    gender      tinyint unsigned not null comment &#x27;性别, 说明: 1 男, 2 女&#x27;,</span><br><span class="line">    image       varchar(300) comment &#x27;图像&#x27;,</span><br><span class="line">    job         tinyint unsigned comment &#x27;职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师&#x27;,</span><br><span class="line">    entrydate   date comment &#x27;入职时间&#x27;,</span><br><span class="line">    dept_id     int unsigned comment &#x27;部门ID&#x27;,</span><br><span class="line">    create_time datetime         not null comment &#x27;创建时间&#x27;,</span><br><span class="line">    update_time datetime         not null comment &#x27;修改时间&#x27;</span><br><span class="line">) comment &#x27;员工表&#x27;;</span><br><span class="line">-- 员工表测试数据</span><br><span class="line">INSERT INTO emp (id, username, password, name, gender, image, job, entrydate, dept_id, create_time, update_time)</span><br><span class="line">VALUES </span><br><span class="line">(1, &#x27;jinyong&#x27;, &#x27;123456&#x27;, &#x27;金庸&#x27;, 1, &#x27;1.jpg&#x27;, 4, &#x27;2000-01-01&#x27;, 2, now(), now()),</span><br><span class="line">(2, &#x27;zhangwuji&#x27;, &#x27;123456&#x27;, &#x27;张无忌&#x27;, 1, &#x27;2.jpg&#x27;, 2, &#x27;2015-01-01&#x27;, 2, now(), now()),</span><br><span class="line">(3, &#x27;yangxiao&#x27;, &#x27;123456&#x27;, &#x27;杨逍&#x27;, 1, &#x27;3.jpg&#x27;, 2, &#x27;2008-05-01&#x27;, 2, now(), now()),</span><br><span class="line">(4, &#x27;weiyixiao&#x27;, &#x27;123456&#x27;, &#x27;韦一笑&#x27;, 1, &#x27;4.jpg&#x27;, 2, &#x27;2007-01-01&#x27;, 2, now(), now()),</span><br><span class="line">(5, &#x27;changyuchun&#x27;, &#x27;123456&#x27;, &#x27;常遇春&#x27;, 1, &#x27;5.jpg&#x27;, 2, &#x27;2012-12-05&#x27;, 2, now(), now()),</span><br><span class="line">(6, &#x27;xiaozhao&#x27;, &#x27;123456&#x27;, &#x27;小昭&#x27;, 2, &#x27;6.jpg&#x27;, 3, &#x27;2013-09-05&#x27;, 1, now(), now()),</span><br><span class="line">(7, &#x27;jixiaofu&#x27;, &#x27;123456&#x27;, &#x27;纪晓芙&#x27;, 2, &#x27;7.jpg&#x27;, 1, &#x27;2005-08-01&#x27;, 1, now(), now()),</span><br><span class="line">(8, &#x27;zhouzhiruo&#x27;, &#x27;123456&#x27;, &#x27;周芷若&#x27;, 2, &#x27;8.jpg&#x27;, 1, &#x27;2014-11-09&#x27;, 1, now(), now()),</span><br><span class="line">(9, &#x27;dingminjun&#x27;, &#x27;123456&#x27;, &#x27;丁敏君&#x27;, 2, &#x27;9.jpg&#x27;, 1, &#x27;2011-03-11&#x27;, 1, now(), now()),</span><br><span class="line">(10, &#x27;zhaomin&#x27;, &#x27;123456&#x27;, &#x27;赵敏&#x27;, 2, &#x27;10.jpg&#x27;, 1, &#x27;2013-09-05&#x27;, 1, now(), now()),</span><br><span class="line">(11, &#x27;luzhangke&#x27;, &#x27;123456&#x27;, &#x27;鹿杖客&#x27;, 1, &#x27;11.jpg&#x27;, 5, &#x27;2007-02-01&#x27;, 3, now(), now()),</span><br><span class="line">(12, &#x27;hebiweng&#x27;, &#x27;123456&#x27;, &#x27;鹤笔翁&#x27;, 1, &#x27;12.jpg&#x27;, 5, &#x27;2008-08-18&#x27;, 3, now(), now()),</span><br><span class="line">(13, &#x27;fangdongbai&#x27;, &#x27;123456&#x27;, &#x27;方东白&#x27;, 1, &#x27;13.jpg&#x27;, 5, &#x27;2012-11-01&#x27;, 3, now(), now()),</span><br><span class="line">(14, &#x27;zhangsanfeng&#x27;, &#x27;123456&#x27;, &#x27;张三丰&#x27;, 1, &#x27;14.jpg&#x27;, 2, &#x27;2002-08-01&#x27;, 2, now(), now()),</span><br><span class="line">(15, &#x27;yulianzhou&#x27;, &#x27;123456&#x27;, &#x27;俞莲舟&#x27;, 1, &#x27;15.jpg&#x27;, 2, &#x27;2011-05-01&#x27;, 2, now(), now()),</span><br><span class="line">(16, &#x27;songyuanqiao&#x27;, &#x27;123456&#x27;, &#x27;宋远桥&#x27;, 1, &#x27;16.jpg&#x27;, 2, &#x27;2010-01-01&#x27;, 2, now(), now()),</span><br><span class="line">(17, &#x27;chenyouliang&#x27;, &#x27;123456&#x27;, &#x27;陈友谅&#x27;, 1, &#x27;17.jpg&#x27;, NULL, &#x27;2015-03-21&#x27;, NULL, now(), now());</span><br></pre></td></tr></table></figure>



<p><strong>创建一个新的springboot工程，选择引入对应的起步依赖（mybatis、mysql驱动、lombok）</strong></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210182008131-1715613343040-231.png" alt="image-20221210182008131"></p>
<p><strong>application.properties中引入数据库连接信息</strong></p>
<blockquote>
<p>提示：可以把之前项目中已有的配置信息复制过来即可</p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#驱动类名称</span></span><br><span class="line"><span class="attr">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment">#数据库连接的url</span></span><br><span class="line"><span class="attr">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/mybatis</span></span><br><span class="line"><span class="comment">#连接数据库的用户名</span></span><br><span class="line"><span class="attr">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="comment">#连接数据库的密码</span></span><br><span class="line"><span class="attr">spring.datasource.password</span>=<span class="string">1234</span></span><br></pre></td></tr></table></figure>



<p><strong>创建对应的实体类Emp（实体类属性采用驼峰命名）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Emp</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Short gender;</span><br><span class="line">    <span class="keyword">private</span> String image;</span><br><span class="line">    <span class="keyword">private</span> Short job;</span><br><span class="line">    <span class="keyword">private</span> LocalDate entrydate;     <span class="comment">//LocalDate类型对应数据表中的date类型</span></span><br><span class="line">    <span class="keyword">private</span> Integer deptId;</span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;<span class="comment">//LocalDateTime类型对应数据表中的datetime类型</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime updateTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>准备Mapper接口：EmpMapper</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*@Mapper注解：表示当前接口为mybatis中的Mapper接口</span></span><br><span class="line"><span class="comment">  程序运行时会自动创建接口的实现类对象(代理对象)，并交给Spring的IOC容器管理</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完成以上操作后，项目工程结构目录如下：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210182500817-1715613343041-232.png" alt="image-20221210182500817"></p>
<h3 id="5-3-删除"><a href="#5-3-删除" class="headerlink" title="5.3 删除"></a>5.3 删除</h3><h4 id="5-3-1-功能实现"><a href="#5-3-1-功能实现" class="headerlink" title="5.3.1 功能实现"></a>5.3.1 功能实现</h4><p>页面原型：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210183336095-1715613343041-233.png" alt="image-20221210183336095"></p>
<blockquote>
<p>当我们点击后面的”删除”按钮时，前端页面会给服务端传递一个参数，也就是该行数据的ID。 我们接收到ID后，根据ID删除数据即可。</p>
</blockquote>
<p><strong>功能：根据主键删除数据</strong></p>
<ul>
<li>SQL语句</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-- 删除id=17的数据</span><br><span class="line">delete from emp where id = 17;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mybatis框架让程序员更关注于SQL语句</p>
</blockquote>
<ul>
<li>接口方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//@Delete(&quot;delete from emp where id = 17&quot;)</span></span><br><span class="line">    <span class="comment">//public void delete();</span></span><br><span class="line">    <span class="comment">//以上delete操作的SQL语句中的id值写成固定的17，就表示只能删除id=17的用户数据</span></span><br><span class="line">    <span class="comment">//SQL语句中的id值不能写成固定数值，需要变为动态的数值</span></span><br><span class="line">    <span class="comment">//解决方案：在delete方法中添加一个参数(用户id)，将方法中的参数，传给SQL语句</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id删除数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id    用户id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Delete(&quot;delete from emp where id = #&#123;id&#125;&quot;)</span><span class="comment">//使用#&#123;key&#125;方式获取方法中的参数值</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">(Integer id)</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>@Delete注解：用于编写delete操作的SQL语句</p>
</blockquote>
<blockquote>
<p>如果mapper接口方法形参只有一个普通类型的参数，#{…} 里面的属性名可以随便写，如：#{id}、#{value}。但是建议保持名字一致。</p>
</blockquote>
<ul>
<li>测试<ul>
<li>在单元测试类中通过@Autowired注解注入EmpMapper类型对象</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootMybatisCrudApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//从Spring的IOC容器中，获取类型是EmpMapper的对象并注入</span></span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testDel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//调用删除方法</span></span><br><span class="line">        empMapper.delete(<span class="number">16</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="5-3-2-日志输入"><a href="#5-3-2-日志输入" class="headerlink" title="5.3.2 日志输入"></a>5.3.2 日志输入</h4><p>在Mybatis当中我们可以借助日志，查看到sql语句的执行、执行传递的参数以及执行结果。具体操作如下：</p>
<ol>
<li><p>打开application.properties文件</p>
</li>
<li><p>开启mybatis的日志，并指定输出到控制台</p>
</li>
</ol>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#指定mybatis输出日志的位置, 输出控制台</span></span><br><span class="line"><span class="attr">mybatis.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br></pre></td></tr></table></figure>

<p>开启日志之后，我们再次运行单元测试，可以看到在控制台中，输出了以下的SQL语句信息：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20220901164225644.png" alt="image-20220901164225644"> </p>
<blockquote>
<p>但是我们发现输出的SQL语句：delete from emp where id &#x3D; ?，我们输入的参数16并没有在后面拼接，id的值是使用?进行占位。那这种SQL语句我们称为预编译SQL。</p>
</blockquote>
<h4 id="5-3-3-预编译SQL"><a href="#5-3-3-预编译SQL" class="headerlink" title="5.3.3 预编译SQL"></a>5.3.3 预编译SQL</h4><h5 id="5-3-3-1-介绍"><a href="#5-3-3-1-介绍" class="headerlink" title="5.3.3.1 介绍"></a>5.3.3.1 介绍</h5><p>预编译SQL有两个优势：</p>
<ol>
<li>性能更高</li>
<li>更安全(防止SQL注入)</li>
</ol>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210202222206-1715613343041-235.png" alt="image-20221210202222206"></p>
<blockquote>
<p>性能更高：预编译SQL，编译一次之后会将编译后的SQL语句缓存起来，后面再次执行这条语句时，不会再次编译。（只是输入的参数不同）</p>
<p>更安全(防止SQL注入)：将敏感字进行转义，保障SQL的安全性。</p>
</blockquote>
<h5 id="5-3-3-2-SQL注入"><a href="#5-3-3-2-SQL注入" class="headerlink" title="5.3.3.2 SQL注入"></a>5.3.3.2 SQL注入</h5><p>SQL注入：是通过操作输入的数据来修改事先定义好的SQL语句，以达到执行代码对服务器进行攻击的方法。</p>
<blockquote>
<p>由于没有对用户输入进行充分检查，而SQL又是拼接而成，在用户输入参数时，在参数中添加一些SQL关键字，达到改变SQL运行结果的目的，也可以完成恶意攻击。</p>
</blockquote>
<p><strong>测试1：使用资料中提供的程序，来验证SQL注入问题</strong></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210205419634-1715613343041-236.png" alt="image-20221210205419634"></p>
<p>第1步：进入到DOS</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221211124744203-1715613343041-237.png" alt="image-20221211124744203"></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221211124840720-1715613343041-238.png" alt="image-20221211124840720"></p>
<p>第2步：执行以下命令，启动程序</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动存在SQL注入的程序</span></span><br><span class="line">java <span class="literal">-jar</span> sql_Injection_demo<span class="literal">-0</span>.<span class="number">0.1</span><span class="literal">-SNAPSHOT</span>.jar </span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" data-original="/.com//image-20221210211605231-1715613343041-239.png" alt="image-20221210211605231"></p>
<p>第3步：打开浏览器输入<code>http://localhost:9090/login.html</code></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210212406527.png" alt="image-20221210212406527"></p>
<p>发现竟然能够登录成功：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210212511915-1715613343041-241.png" alt="image-20221210212511915"></p>
<p>以上操作为什么能够登录成功呢？</p>
<ul>
<li>由于没有对用户输入内容进行充分检查，而SQL又是字符串拼接方式而成，在用户输入参数时，在参数中添加一些SQL关键字，达到改变SQL运行结果的目的，从而完成恶意攻击。</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210213311518-1715613343041-242.png" alt="image-20221210213311518"></p>
<blockquote>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210214431228-1715613343041-243.png" alt="image-20221210214431228"></p>
<p>用户在页面提交数据的时候人为的添加一些特殊字符，使得sql语句的结构发生了变化，最终可以在没有用户名或者密码的情况下进行登录。</p>
</blockquote>
<p><strong>测试2：使用资料中提供的程序，来验证SQL注入问题</strong></p>
<p>第1步：进入到DOS</p>
<p>第2步：执行以下命令，启动程序：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#启动解决了SQL注入的程序</span></span><br><span class="line">java <span class="literal">-jar</span> sql_prepared_demo<span class="literal">-0</span>.<span class="number">0.1</span><span class="literal">-SNAPSHOT</span>.jar</span><br></pre></td></tr></table></figure>

<p>第3步：打开浏览器输入<code>http://localhost:9090/login.html</code></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221210212406527.png" alt="image-20221210212406527"></p>
<p>发现无法登录：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221211125751981.png" alt="image-20221211125751981"></p>
<p>以上操作SQL语句的执行：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221211130011973-1715613343041-245.png" alt="image-20221211130011973"></p>
<blockquote>
<p>把整个<code>&#39; or &#39;1&#39;=&#39;1</code>作为一个完整的参数，赋值给第2个问号（<code>&#39; or &#39;1&#39;=&#39;1</code>进行了转义，只当做字符串使用）</p>
</blockquote>
<h5 id="5-3-3-3-参数占位符"><a href="#5-3-3-3-参数占位符" class="headerlink" title="5.3.3.3 参数占位符"></a>5.3.3.3 参数占位符</h5><p>在Mybatis中提供的参数占位符有两种：${…} 、#{…}</p>
<ul>
<li><p>#{…}</p>
<ul>
<li>执行SQL时，会将#{…}替换为?，生成预编译SQL，会自动设置参数值</li>
<li>使用时机：参数传递，都使用#{…}</li>
</ul>
</li>
<li><p>${…}</p>
<ul>
<li>拼接SQL。直接将参数拼接在SQL语句中，存在SQL注入问题</li>
<li>使用时机：如果对表名、列表进行动态设置时使用</li>
</ul>
</li>
</ul>
<blockquote>
<p>注意事项：在项目开发中，建议使用#{…}，生成预编译SQL，防止SQL注入安全。</p>
</blockquote>
<h3 id="5-4-新增"><a href="#5-4-新增" class="headerlink" title="5.4 新增"></a>5.4 新增</h3><p>功能：新增员工信息</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221211134239610-1715613343041-246.png" alt="image-20221211134239610"></p>
<h4 id="5-4-1-基本新增"><a href="#5-4-1-基本新增" class="headerlink" title="5.4.1 基本新增"></a>5.4.1 基本新增</h4><p>员工表结构：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221211134746319-1715613343041-247.png" alt="image-20221211134746319"></p>
<p>SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> emp(username, name, gender, image, job, entrydate, dept_id, create_time, update_time) <span class="keyword">values</span> (<span class="string">&#x27;songyuanqiao&#x27;</span>,<span class="string">&#x27;宋远桥&#x27;</span>,<span class="number">1</span>,<span class="string">&#x27;1.jpg&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2012-10-09&#x27;</span>,<span class="number">2</span>,<span class="string">&#x27;2022-10-01 10:00:00&#x27;</span>,<span class="string">&#x27;2022-10-01 10:00:00&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into emp(username, name, gender, image, job, entrydate, dept_id, create_time, update_time) values (#&#123;username&#125;, #&#123;name&#125;, #&#123;gender&#125;, #&#123;image&#125;, #&#123;job&#125;, #&#123;entrydate&#125;, #&#123;deptId&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Emp emp)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：#{…} 里面写的名称是对象的属性名</p>
</blockquote>
<p>测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.itheima.mapper.EmpMapper;</span><br><span class="line"><span class="keyword">import</span> com.itheima.pojo.Emp;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDate;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootMybatisCrudApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//创建员工对象</span></span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();</span><br><span class="line">        emp.setUsername(<span class="string">&quot;tom&quot;</span>);</span><br><span class="line">        emp.setName(<span class="string">&quot;汤姆&quot;</span>);</span><br><span class="line">        emp.setImage(<span class="string">&quot;1.jpg&quot;</span>);</span><br><span class="line">        emp.setGender((<span class="type">short</span>)<span class="number">1</span>);</span><br><span class="line">        emp.setJob((<span class="type">short</span>)<span class="number">1</span>);</span><br><span class="line">        emp.setEntrydate(LocalDate.of(<span class="number">2000</span>,<span class="number">1</span>,<span class="number">1</span>));</span><br><span class="line">        emp.setCreateTime(LocalDateTime.now());</span><br><span class="line">        emp.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        emp.setDeptId(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//调用添加方法</span></span><br><span class="line">        empMapper.insert(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>日志输出：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221211140222240-1715613343041-248.png" alt="image-20221211140222240"></p>
</blockquote>
<h4 id="5-4-2-主键返回"><a href="#5-4-2-主键返回" class="headerlink" title="5.4.2 主键返回"></a>5.4.2 主键返回</h4><p>概念：在数据添加成功后，需要获取插入数据库数据的主键。</p>
<blockquote>
<p>如：添加套餐数据时，还需要维护套餐菜品关系表数据。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221211150353385-1715613343041-249.png" alt="image-20221211150353385"></p>
<p>业务场景：在前面讲解到的苍穹外卖菜品与套餐模块的表结构，菜品与套餐是多对多的关系，一个套餐对应多个菜品。既然是多对多的关系，是不是有一张套餐菜品中间表来维护它们之间的关系。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212093655389-1715613343041-250.png" alt="image-20221212093655389"></p>
<p>在添加套餐的时候，我们需要在界面当中来录入套餐的基本信息，还需要来录入套餐与菜品的关联信息。这些信息录入完毕之后，我们一点保存，就需要将套餐的信息以及套餐与菜品的关联信息都需要保存到数据库当中。其实具体的过程包括两步，首先第一步先需要将套餐的基本信息保存了，接下来第二步再来保存套餐与菜品的关联信息。套餐与菜品的关联信息就是往中间表当中来插入数据，来维护它们之间的关系。而中间表当中有两个外键字段，一个是菜品的ID，就是当前菜品的ID，还有一个就是套餐的ID，而这个套餐的 ID 指的就是此次我所添加的套餐的ID，所以我们在第一步保存完套餐的基本信息之后，就需要将套餐的主键值返回来供第二步进行使用。这个时候就需要用到主键返回功能。</p>
</blockquote>
<p>那要如何实现在插入数据之后返回所插入行的主键值呢？</p>
<ul>
<li>默认情况下，执行插入操作时，是不会主键值返回的。如果我们想要拿到主键值，需要在Mapper接口中的方法上添加一个Options注解，并在注解中指定属性useGeneratedKeys&#x3D;true和keyProperty&#x3D;”实体类属性名”</li>
</ul>
<p>主键返回代码实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//会自动将生成的主键值，赋值给emp对象的id属性</span></span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true,keyProperty = &quot;id&quot;)</span></span><br><span class="line">    <span class="meta">@Insert(&quot;insert into emp(username, name, gender, image, job, entrydate, dept_id, create_time, update_time) values (#&#123;username&#125;, #&#123;name&#125;, #&#123;gender&#125;, #&#123;image&#125;, #&#123;job&#125;, #&#123;entrydate&#125;, #&#123;deptId&#125;, #&#123;createTime&#125;, #&#123;updateTime&#125;)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(Emp emp)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootMybatisCrudApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testInsert</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//创建员工对象</span></span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();</span><br><span class="line">        emp.setUsername(<span class="string">&quot;jack&quot;</span>);</span><br><span class="line">        emp.setName(<span class="string">&quot;杰克&quot;</span>);</span><br><span class="line">        emp.setImage(<span class="string">&quot;1.jpg&quot;</span>);</span><br><span class="line">        emp.setGender((<span class="type">short</span>)<span class="number">1</span>);</span><br><span class="line">        emp.setJob((<span class="type">short</span>)<span class="number">1</span>);</span><br><span class="line">        emp.setEntrydate(LocalDate.of(<span class="number">2000</span>,<span class="number">1</span>,<span class="number">1</span>));</span><br><span class="line">        emp.setCreateTime(LocalDateTime.now());</span><br><span class="line">        emp.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        emp.setDeptId(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">//调用添加方法</span></span><br><span class="line">        empMapper.insert(emp);</span><br><span class="line"></span><br><span class="line">        System.out.println(emp.getDeptId());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h3 id="5-5-更新"><a href="#5-5-更新" class="headerlink" title="5.5 更新"></a>5.5 更新</h3><p>功能：修改员工信息</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212095605863.png" alt="image-20221212095605863"></p>
<blockquote>
<p>点击”编辑”按钮后，会查询所在行记录的员工信息，并把员工信息回显在修改员工的窗体上(下个知识点学习)</p>
<p>在修改员工的窗体上，可以修改的员工数据：用户名、员工姓名、性别、图像、职位、入职日期、归属部门</p>
<p>思考：在修改员工数据时，要以什么做为条件呢？</p>
<p>答案：员工id</p>
</blockquote>
<p>SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> emp <span class="keyword">set</span> username <span class="operator">=</span> <span class="string">&#x27;linghushaoxia&#x27;</span>, name <span class="operator">=</span> <span class="string">&#x27;令狐少侠&#x27;</span>, gender <span class="operator">=</span> <span class="number">1</span> , image <span class="operator">=</span> <span class="string">&#x27;1.jpg&#x27;</span> , job <span class="operator">=</span> <span class="number">2</span>, entrydate <span class="operator">=</span> <span class="string">&#x27;2012-01-01&#x27;</span>, dept_id <span class="operator">=</span> <span class="number">2</span>, update_time <span class="operator">=</span> <span class="string">&#x27;2022-10-01 12:12:12&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">18</span>;</span><br></pre></td></tr></table></figure>

<p>接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据id修改员工信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> emp</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Update(&quot;update emp set username=#&#123;username&#125;, name=#&#123;name&#125;, gender=#&#123;gender&#125;, image=#&#123;image&#125;, job=#&#123;job&#125;, entrydate=#&#123;entrydate&#125;, dept_id=#&#123;deptId&#125;, update_time=#&#123;updateTime&#125; where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Emp emp)</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootMybatisCrudApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//要修改的员工信息</span></span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();</span><br><span class="line">        emp.setId(<span class="number">23</span>);</span><br><span class="line">        emp.setUsername(<span class="string">&quot;songdaxia&quot;</span>);</span><br><span class="line">        emp.setPassword(<span class="literal">null</span>);</span><br><span class="line">        emp.setName(<span class="string">&quot;老宋&quot;</span>);</span><br><span class="line">        emp.setImage(<span class="string">&quot;2.jpg&quot;</span>);</span><br><span class="line">        emp.setGender((<span class="type">short</span>)<span class="number">1</span>);</span><br><span class="line">        emp.setJob((<span class="type">short</span>)<span class="number">2</span>);</span><br><span class="line">        emp.setEntrydate(LocalDate.of(<span class="number">2012</span>,<span class="number">1</span>,<span class="number">1</span>));</span><br><span class="line">        emp.setCreateTime(<span class="literal">null</span>);</span><br><span class="line">        emp.setUpdateTime(LocalDateTime.now());</span><br><span class="line">        emp.setDeptId(<span class="number">2</span>);</span><br><span class="line">        <span class="comment">//调用方法，修改员工数据</span></span><br><span class="line">        empMapper.update(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="5-6-查询"><a href="#5-6-查询" class="headerlink" title="5.6 查询"></a>5.6 查询</h3><h4 id="5-6-1-根据ID查询"><a href="#5-6-1-根据ID查询" class="headerlink" title="5.6.1 根据ID查询"></a>5.6.1 根据ID查询</h4><p>在员工管理的页面中，当我们进行更新数据时，会点击 “编辑” 按钮，然后此时会发送一个请求到服务端，会根据Id查询该员工信息，并将员工数据回显在页面上。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212101331292-1715613343041-252.png" alt="image-20221212101331292"> </p>
<p>SQL语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id, username, password, name, gender, image, job, entrydate, dept_id, create_time, update_time from emp;</span><br></pre></td></tr></table></figure>

<p>接口方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select id, username, password, name, gender, image, job, entrydate, dept_id, create_time, update_time from emp where id=#&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Emp <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SpringbootMybatisCrudApplicationTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EmpMapper empMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testGetById</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> empMapper.getById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行结果：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212103004961-1715613343041-253.png" alt="image-20221212103004961"></p>
<p>而在测试的过程中，我们会发现有几个字段(deptId、createTime、updateTime)是没有数据值的</p>
</blockquote>
<h4 id="5-6-2-数据封装"><a href="#5-6-2-数据封装" class="headerlink" title="5.6.2 数据封装"></a>5.6.2 数据封装</h4><p>我们看到查询返回的结果中大部分字段是有值的，但是deptId，createTime，updateTime这几个字段是没有值的，而数据库中是有对应的字段值的，这是为什么呢？</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212103124490.png" alt="image-20221212103124490"></p>
<p>原因如下： </p>
<ul>
<li>实体类属性名和数据库表查询返回的字段名一致，mybatis会自动封装。</li>
<li>如果实体类属性名和数据库表查询返回的字段名不一致，不能自动封装。</li>
</ul>
<p> 解决方案：</p>
<ol>
<li>起别名</li>
<li>结果映射</li>
<li>开启驼峰命名</li>
</ol>
<p><strong>起别名</strong>：在SQL语句中，对不一样的列名起别名，别名和实体类属性名一样</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select id, username, password, name, gender, image, job, entrydate, &quot; +</span></span><br><span class="line"><span class="meta">        &quot;dept_id AS deptId, create_time AS createTime, update_time AS updateTime &quot; +</span></span><br><span class="line"><span class="meta">        &quot;from emp &quot; +</span></span><br><span class="line"><span class="meta">        &quot;where id=#&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Emp <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>再次执行测试类：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212111027396-1715613343041-255.png" alt="image-20221212111027396"></p>
</blockquote>
<p><strong>手动结果映射</strong>：通过 @Results及@Result 进行手动结果映射</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Results(&#123;@Result(column = &quot;dept_id&quot;, property = &quot;deptId&quot;),</span></span><br><span class="line"><span class="meta">          @Result(column = &quot;create_time&quot;, property = &quot;createTime&quot;),</span></span><br><span class="line"><span class="meta">          @Result(column = &quot;update_time&quot;, property = &quot;updateTime&quot;)&#125;)</span></span><br><span class="line"><span class="meta">@Select(&quot;select id, username, password, name, gender, image, job, entrydate, dept_id, create_time, update_time from emp where id=#&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Emp <span class="title function_">getById</span><span class="params">(Integer id)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>@Results源代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Results &#123;</span><br><span class="line">String <span class="title function_">id</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">Result[] value() <span class="keyword">default</span> &#123;&#125;;  <span class="comment">//Result类型的数组</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@Result源代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Repeatable(Results.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Result &#123;</span><br><span class="line"><span class="type">boolean</span> <span class="title function_">id</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">false</span>;<span class="comment">//表示当前列是否为主键（true:是主键）</span></span><br><span class="line"></span><br><span class="line">String <span class="title function_">column</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;<span class="comment">//指定表中字段名</span></span><br><span class="line"></span><br><span class="line">String <span class="title function_">property</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;<span class="comment">//指定类中属性名</span></span><br><span class="line"></span><br><span class="line">Class&lt;?&gt; javaType() <span class="keyword">default</span> <span class="keyword">void</span>.class;</span><br><span class="line"></span><br><span class="line">JdbcType <span class="title function_">jdbcType</span><span class="params">()</span> <span class="keyword">default</span> JdbcType.UNDEFINED;</span><br><span class="line"></span><br><span class="line">Class&lt;? <span class="keyword">extends</span> <span class="title class_">TypeHandler</span>&gt; typeHandler() <span class="keyword">default</span> UnknownTypeHandler.class;</span><br><span class="line"></span><br><span class="line">One <span class="title function_">one</span><span class="params">()</span> <span class="keyword">default</span> <span class="meta">@One</span>;</span><br><span class="line"></span><br><span class="line">Many <span class="title function_">many</span><span class="params">()</span> <span class="keyword">default</span> <span class="meta">@Many</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>**开启驼峰命名(推荐)**：如果字段名与属性名符合驼峰命名规则，mybatis会自动通过驼峰命名规则映射</p>
<blockquote>
<p>驼峰命名规则：   abc_xyz    &#x3D;&gt;   abcXyz</p>
<ul>
<li>表中字段名：abc_xyz</li>
<li>类中属性名：abcXyz</li>
</ul>
</blockquote>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在application.properties中添加：</span></span><br><span class="line"><span class="attr">mybatis.configuration.map-underscore-to-camel-case</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>要使用驼峰命名前提是 实体类的属性 与 数据库表中的字段名严格遵守驼峰命名。</p>
</blockquote>
<h4 id="5-6-3-条件查询"><a href="#5-6-3-条件查询" class="headerlink" title="5.6.3 条件查询"></a>5.6.3 条件查询</h4><p>在员工管理的列表页面中，我们需要根据条件查询员工信息，查询条件包括：姓名、性别、入职时间。 </p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212113422924.png" alt="image-20221212113422924"></p>
<p>通过页面原型以及需求描述我们要实现的查询：</p>
<ul>
<li>姓名：要求支持模糊匹配</li>
<li>性别：要求精确匹配</li>
<li>入职时间：要求进行范围查询</li>
<li>根据最后修改时间进行降序排序</li>
</ul>
<p>SQL语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id, username, password, name, gender, image, job, entrydate, dept_id, create_time, update_time </span><br><span class="line"><span class="keyword">from</span> emp </span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%张%&#x27;</span> </span><br><span class="line">      <span class="keyword">and</span> gender <span class="operator">=</span> <span class="number">1</span> </span><br><span class="line">      <span class="keyword">and</span> entrydate <span class="keyword">between</span> <span class="string">&#x27;2010-01-01&#x27;</span> <span class="keyword">and</span> <span class="string">&#x27;2020-01-01 &#x27;</span> </span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> update_time <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>

<p>接口方法：</p>
<ul>
<li>方式一</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    <span class="meta">@Select(&quot;select * from emp &quot; +</span></span><br><span class="line"><span class="meta">            &quot;where name like &#x27;%$&#123;name&#125;%&#x27; &quot; +</span></span><br><span class="line"><span class="meta">            &quot;and gender = #&#123;gender&#125; &quot; +</span></span><br><span class="line"><span class="meta">            &quot;and entrydate between #&#123;begin&#125; and #&#123;end&#125; &quot; +</span></span><br><span class="line"><span class="meta">            &quot;order by update_time desc&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">list</span><span class="params">(String name, Short gender, LocalDate begin, LocalDate end)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212115149151-1715613343041-258.png" alt="image-20221212115149151"></p>
<p>以上方式注意事项：</p>
<ol>
<li><p>方法中的形参名和SQL语句中的参数占位符名保持一致</p>
</li>
<li><p>模糊查询使用${…}进行字符串拼接，这种方式呢，由于是字符串拼接，并不是预编译的形式，所以效率不高、且存在sql注入风险。</p>
</li>
</ol>
</blockquote>
<ul>
<li>方式二（解决SQL注入风险）<ul>
<li>使用MySQL提供的字符串拼接函数：concat(‘%’ , ‘关键字’ , ‘%’)</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select(&quot;select * from emp &quot; +</span></span><br><span class="line"><span class="meta">            &quot;where name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;) &quot; +</span></span><br><span class="line"><span class="meta">            &quot;and gender = #&#123;gender&#125; &quot; +</span></span><br><span class="line"><span class="meta">            &quot;and entrydate between #&#123;begin&#125; and #&#123;end&#125; &quot; +</span></span><br><span class="line"><span class="meta">            &quot;order by update_time desc&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Emp&gt; <span class="title function_">list</span><span class="params">(String name, Short gender, LocalDate begin, LocalDate end)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行结果：生成的SQL都是预编译的SQL语句（性能高、安全）</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212120006242-1715613343041-257.png" alt="image-20221212120006242"></p>
</blockquote>
<h4 id="5-6-4-参数名说明"><a href="#5-6-4-参数名说明" class="headerlink" title="5.6.4 参数名说明"></a>5.6.4 参数名说明</h4><p>在上面我们所编写的条件查询功能中，我们需要保证接口中方法的形参名和SQL语句中的参数占位符名相同。</p>
<blockquote>
<p>当方法中的形参名和SQL语句中的占位符参数名不相同时，就会出现以下问题：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212150611796.png" alt="image-20221212150611796"></p>
</blockquote>
<p>参数名在不同的SpringBoot版本中，处理方案还不同：</p>
<ul>
<li>在springBoot的2.x版本（保证参数名一致）</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212151156273-1715613343041-260.png" alt="image-20221212151156273"></p>
<blockquote>
<p>springBoot的父工程对compiler编译插件进行了默认的参数parameters配置，使得在编译时，会在生成的字节码文件中保留原方法形参的名称，所以#{…}里面可以直接通过形参名获取对应的值</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212151411154-1715613343041-261.png" alt="image-20221212151411154"></p>
</blockquote>
<ul>
<li>在springBoot的1.x版本&#x2F;单独使用mybatis（使用@Param注解来指定SQL语句中的参数名）</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212151628715-1715613343041-262.png" alt="image-20221212151628715"></p>
<blockquote>
<p>在编译时，生成的字节码文件当中，不会保留Mapper接口中方法的形参名称，而是使用var1、var2、…这样的形参名字，此时要获取参数值时，就要通过@Param注解来指定SQL语句中的参数名</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212151736274-1715613343041-263.png" alt="image-20221212151736274"></p>
</blockquote>
<ol start="2">
<li>Mybatis的XML配置文件</li>
</ol>
<p>Mybatis的开发有两种方式：</p>
<ol>
<li>注解</li>
<li>XML</li>
</ol>
<h2 id="6-XML"><a href="#6-XML" class="headerlink" title="6.XML"></a>6.XML</h2><h3 id="6-1-XML配置文件规范"><a href="#6-1-XML配置文件规范" class="headerlink" title="6.1 XML配置文件规范"></a>6.1 XML配置文件规范</h3><p>使用Mybatis的注解方式，主要是来完成一些简单的增删改查功能。如果需要实现复杂的SQL功能，建议使用XML来配置映射语句，也就是将SQL语句写在XML配置文件中。</p>
<p>在Mybatis中使用XML映射文件方式开发，需要符合一定的规范：</p>
<ul>
<li><p><strong>XML映射文件的名称与Mapper接口名称一致，并且将XML映射文件和Mapper接口放置在相同包下（同包同名）</strong></p>
</li>
<li><p><strong>XML映射文件的namespace属性为Mapper接口全限定名一致</strong></p>
</li>
<li><p><strong>XML映射文件中sql语句的id与Mapper接口中的方法名一致，并保持返回类型一致。</strong></p>
</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212153529732.png" alt="image-20221212153529732"></p>
<blockquote>
<p>&lt;select&gt;标签：就是用于编写select查询语句的。</p>
<ul>
<li>resultType属性，指的是查询返回的单条记录所封装的类型。</li>
</ul>
</blockquote>
<p><img src="/img/loading.gif" data-original="/.com//image-20240309163347721-1715613343041-265.png" alt="image-20240309163347721"></p>
<p>由于XML映射文件中的id绑定的list方法 而list方法封装的是Emp  所以 resultType为Emp的全类名</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240309163504652-1715613343041-266.png" alt="image-20240309163504652"></p>
<h3 id="6-2-XML配置文件实现"><a href="#6-2-XML配置文件实现" class="headerlink" title="6.2 XML配置文件实现"></a>6.2 XML配置文件实现</h3><p>第1步：创建XML映射文件</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212154908306-1715613343041-267.png" alt="image-20221212154908306"></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212155304635-1715613343041-268.png" alt="image-20221212155304635"></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212155544404-1715613343041-269.png" alt="image-20221212155544404"></p>
<p>第2步：编写XML映射文件</p>
<blockquote>
<p>xml映射文件中的dtd约束，直接从mybatis官网复制即可</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">  <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">  <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>配置：XML映射文件的namespace属性为Mapper接口全限定名</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212160316644-1715613343041-270.png" alt="image-20221212160316644"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.EmpMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>配置：XML映射文件中sql语句的id与Mapper接口中的方法名一致，并保持返回类型一致</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212163528787.png" alt="image-20221212163528787"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.EmpMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--查询操作--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Emp&quot;</span>&gt;</span></span><br><span class="line">        select * from emp</span><br><span class="line">        where name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">              and gender = #&#123;gender&#125;</span><br><span class="line">              and entrydate between #&#123;begin&#125; and #&#123;end&#125;</span><br><span class="line">        order by update_time desc</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>运行测试类，执行结果：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221212163719534-1715613343041-272.png" alt="image-20221212163719534"></p>
</blockquote>
<h3 id="6-3-MybatisX的使用"><a href="#6-3-MybatisX的使用" class="headerlink" title="6.3 MybatisX的使用"></a>6.3 MybatisX的使用</h3><p>MybatisX是一款基于IDEA的快速开发Mybatis的插件，为效率而生。</p>
<p>MybatisX的安装：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213120923252-1715613343041-273.png" alt="image-20221213120923252"></p>
<p>可以通过MybatisX快速定位：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213121521406.png" alt="image-20221213121521406"></p>
<blockquote>
<p>MybatisX的使用在后续学习中会继续分享</p>
</blockquote>
<p>学习了Mybatis中XML配置文件的开发方式了，大家可能会存在一个疑问：到底是使用注解方式开发还是使用XML方式开发？</p>
<blockquote>
<p>官方说明：<a target="_blank" rel="noopener" href="https://mybatis.net.cn/getting-started.html">https://mybatis.net.cn/getting-started.html</a></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20220901173948645.png" alt="image-20220901173948645"> </p>
</blockquote>
<p><strong>结论：</strong>*<em><strong>使用Mybatis的注解，主要是来完成一些简单的增删改查功能。如果需要实现复杂的SQL功能，建议使用XML来配置映射语句</strong>。</em>*</p>
<h2 id="7-Mybatis动态SQL"><a href="#7-Mybatis动态SQL" class="headerlink" title="7. Mybatis动态SQL"></a>7. Mybatis动态SQL</h2><h3 id="7-1-什么是动态SQL"><a href="#7-1-什么是动态SQL" class="headerlink" title="7.1 什么是动态SQL"></a>7.1 什么是动态SQL</h3><p>在页面原型中，列表上方的条件是动态的，是可以不传递的，也可以只传递其中的1个或者2个或者全部。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20220901172933012.png"></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20220901173203491-1715613343041-277.png" alt="image-20220901173203491"></p>
<p>而在我们刚才编写的SQL语句中，我们会看到，我们将三个条件直接写死了。 如果页面只传递了参数姓名name 字段，其他两个字段 性别 和 入职时间没有传递，那么这两个参数的值就是null。</p>
<p>此时，执行的SQL语句为：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20220901173431554-1715613343041-278.png" alt="image-20220901173431554"> </p>
<p>这个查询结果是不正确的。正确的做法应该是：传递了参数，再组装这个查询条件；如果没有传递参数，就不应该组装这个查询条件。</p>
<p>比如：如果姓名输入了”张”, 对应的SQL为:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> emp <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%张%&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> update_time <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>



<p>如果姓名输入了”张”,，性别选择了”男”，则对应的SQL为:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span>  <span class="keyword">from</span> emp <span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%张%&#x27;</span> <span class="keyword">and</span> gender <span class="operator">=</span> <span class="number">1</span> <span class="keyword">order</span> <span class="keyword">by</span> update_time <span class="keyword">desc</span>;</span><br></pre></td></tr></table></figure>



<p>SQL语句会随着用户的输入或外部条件的变化而变化，我们称为：<strong>动态SQL</strong>。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213122623278-1715613343041-279.png" alt="image-20221213122623278"></p>
<p>在Mybatis中提供了很多实现动态SQL的标签，我们学习Mybatis中的动态SQL就是掌握这些动态SQL标签。</p>
<h3 id="7-2-动态SQL-if"><a href="#7-2-动态SQL-if" class="headerlink" title="7.2 动态SQL-if"></a>7.2 动态SQL-if</h3><p><code>&lt;if&gt;</code>：用于判断条件是否成立。使用test属性进行条件判断，如果条件为true，则拼接SQL。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;条件表达式&quot;</span>&gt;</span></span><br><span class="line">   要拼接的sql语句</span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来，我们就通过<code>&lt;if&gt;</code>标签来改造之前条件查询的案例。</p>
<h4 id="7-2-1-条件查询"><a href="#7-2-1-条件查询" class="headerlink" title="7.2.1 条件查询"></a>7.2.1 条件查询</h4><p>示例：把SQL语句改造为动态SQL方式</p>
<ul>
<li>原有的SQL语句</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Emp&quot;</span>&gt;</span></span><br><span class="line">        select * from emp</span><br><span class="line">        where name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">              and gender = #&#123;gender&#125;</span><br><span class="line">              and entrydate between #&#123;begin&#125; and #&#123;end&#125;</span><br><span class="line">        order by update_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>动态SQL语句</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Emp&quot;</span>&gt;</span></span><br><span class="line">        select * from emp</span><br><span class="line">        where</span><br><span class="line">    </span><br><span class="line">             <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">                 name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">             <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span></span><br><span class="line">                 and gender = #&#123;gender&#125;</span><br><span class="line">             <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;begin != null and end != null&quot;</span>&gt;</span></span><br><span class="line">                 and entrydate between #&#123;begin&#125; and #&#123;end&#125;</span><br><span class="line">             <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">        order by update_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//性别数据为null、开始时间和结束时间也为null</span></span><br><span class="line">    List&lt;Emp&gt; list = empMapper.list(<span class="string">&quot;张&quot;</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">for</span>(Emp emp : list)&#123;</span><br><span class="line">        System.out.println(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行的SQL语句： </p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213140353285-1715613343041-280.png" alt="image-20221213140353285"></p>
</blockquote>
<p>下面呢，我们修改测试方法中的代码，再次进行测试，观察执行情况：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//姓名为null</span></span><br><span class="line">    List&lt;Emp&gt; list = empMapper.list(<span class="literal">null</span>, (<span class="type">short</span>)<span class="number">1</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">for</span>(Emp emp : list)&#123;</span><br><span class="line">        System.out.println(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>执行结果：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213141139015-1715613343041-281.png" alt="image-20221213141139015"> </p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213141253355-1715613343041-282.png" alt="image-20221213141253355"> </p>
<p>再次修改测试方法中的代码，再次进行测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//传递的数据全部为null</span></span><br><span class="line">    List&lt;Emp&gt; list = empMapper.list(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">for</span>(Emp emp : list)&#123;</span><br><span class="line">        System.out.println(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行的SQL语句：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213143854434-1715613343041-283.png" alt="image-20221213143854434"></p>
<p>以上问题的解决方案：使用<code>&lt;where&gt;</code>标签代替SQL语句中的where关键字</p>
<ul>
<li><code>&lt;where&gt;</code>只会在子元素有内容的情况下才插入where子句，而且会自动去除子句的开头的AND或OR</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Emp&quot;</span>&gt;</span></span><br><span class="line">        select * from emp</span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!-- if做为where标签的子元素 --&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">                 and name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">             <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span></span><br><span class="line">                 and gender = #&#123;gender&#125;</span><br><span class="line">             <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;begin != null and end != null&quot;</span>&gt;</span></span><br><span class="line">                 and entrydate between #&#123;begin&#125; and #&#123;end&#125;</span><br><span class="line">             <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">        order by update_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testList</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">//只有性别</span></span><br><span class="line">    List&lt;Emp&gt; list = empMapper.list(<span class="literal">null</span>, (<span class="type">short</span>)<span class="number">1</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">for</span>(Emp emp : list)&#123;</span><br><span class="line">        System.out.println(emp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行的SQL语句：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213141909455-1715613343041-284.png" alt="image-20221213141909455"></p>
</blockquote>
<h4 id="7-2-2-更新员工"><a href="#7-2-2-更新员工" class="headerlink" title="7.2.2 更新员工"></a>7.2.2 更新员工</h4><p>案例：完善更新员工功能，修改为动态更新员工数据信息</p>
<ul>
<li>动态更新员工信息，如果更新时传递有值，则更新；如果更新时没有传递值，则不更新</li>
<li>解决方案：动态SQL</li>
</ul>
<p>修改Mapper接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    <span class="comment">//删除@Update注解编写的SQL语句</span></span><br><span class="line">    <span class="comment">//update操作的SQL语句编写在Mapper映射文件中</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Emp emp)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改Mapper映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.EmpMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--更新操作--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update emp</span><br><span class="line">        set</span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">                username=#&#123;username&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">                name=#&#123;name&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span></span><br><span class="line">                gender=#&#123;gender&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;image != null&quot;</span>&gt;</span></span><br><span class="line">                image=#&#123;image&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;job != null&quot;</span>&gt;</span></span><br><span class="line">                job=#&#123;job&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;entrydate != null&quot;</span>&gt;</span></span><br><span class="line">                entrydate=#&#123;entrydate&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;deptId != null&quot;</span>&gt;</span></span><br><span class="line">                dept_id=#&#123;deptId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span></span><br><span class="line">                update_time=#&#123;updateTime&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//要修改的员工信息</span></span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();</span><br><span class="line">        emp.setId(<span class="number">20</span>);</span><br><span class="line">        emp.setUsername(<span class="string">&quot;Tom111&quot;</span>);</span><br><span class="line">        emp.setName(<span class="string">&quot;汤姆111&quot;</span>);</span><br><span class="line"></span><br><span class="line">        emp.setUpdateTime(LocalDateTime.now());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//调用方法，修改员工数据</span></span><br><span class="line">        empMapper.update(emp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行的SQL语句：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213152533851-1715613343041-285.png" alt="image-20221213152533851"></p>
</blockquote>
<p>再次修改测试方法，观察SQL语句执行情况：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUpdate2</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//要修改的员工信息</span></span><br><span class="line">        <span class="type">Emp</span> <span class="variable">emp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Emp</span>();</span><br><span class="line">        emp.setId(<span class="number">20</span>);</span><br><span class="line">        emp.setUsername(<span class="string">&quot;Tom222&quot;</span>);</span><br><span class="line">      </span><br><span class="line">        <span class="comment">//调用方法，修改员工数据</span></span><br><span class="line">        empMapper.update(emp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>执行的SQL语句：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213152850322-1715613343041-286.png" alt="image-20221213152850322"></p>
</blockquote>
<p>以上问题的解决方案：使用<code>&lt;set&gt;</code>标签代替SQL语句中的set关键字</p>
<ul>
<li><code>&lt;set&gt;</code>：动态的在SQL语句中插入set关键字，并会删掉额外的逗号。（用于update语句中）</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.EmpMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--更新操作--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">        update emp</span><br><span class="line">        <span class="comment">&lt;!-- 使用set标签，代替update语句中的set关键字 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span></span><br><span class="line">                username=#&#123;username&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">                name=#&#123;name&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span></span><br><span class="line">                gender=#&#123;gender&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;image != null&quot;</span>&gt;</span></span><br><span class="line">                image=#&#123;image&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;job != null&quot;</span>&gt;</span></span><br><span class="line">                job=#&#123;job&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;entrydate != null&quot;</span>&gt;</span></span><br><span class="line">                entrydate=#&#123;entrydate&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;deptId != null&quot;</span>&gt;</span></span><br><span class="line">                dept_id=#&#123;deptId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;updateTime != null&quot;</span>&gt;</span></span><br><span class="line">                update_time=#&#123;updateTime&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where id=#&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>再次执行测试方法，执行的SQL语句：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213153329553-1715613343041-287.png" alt="image-20221213153329553"></p>
</blockquote>
<p><strong>小结</strong></p>
<ul>
<li><p><code>&lt;if&gt;</code></p>
<ul>
<li><p>用于判断条件是否成立，如果条件为true，则拼接SQL</p>
</li>
<li><p>形式：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span> … <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><code>&lt;where&gt;</code></p>
<ul>
<li>where元素只会在子元素有内容的情况下才插入where子句，而且会自动去除子句的开头的AND或OR</li>
</ul>
</li>
<li><p><code>&lt;set&gt;</code></p>
<ul>
<li>动态地在行首插入 SET 关键字，并会删掉额外的逗号。（用在update语句中）</li>
</ul>
</li>
</ul>
<h4 id="7-3-动态SQL-foreach"><a href="#7-3-动态SQL-foreach" class="headerlink" title="7.3 动态SQL-foreach"></a>7.3 动态SQL-foreach</h4><p>案例：员工删除功能（既支持删除单条记录，又支持批量删除）</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20220901181751004-1715613343041-288.png" alt="image-20220901181751004"> </p>
<p>SQL语句：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete from emp where id in (1,2,3);</span><br></pre></td></tr></table></figure>

<p>Mapper接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">EmpMapper</span> &#123;</span><br><span class="line">    <span class="comment">//批量删除</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteByIds</span><span class="params">(List&lt;Integer&gt; ids)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>XML映射文件：</p>
<ul>
<li>使用<code>&lt;foreach&gt;</code>遍历deleteByIds方法中传递的参数ids集合</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;集合名称&quot;</span> <span class="attr">item</span>=<span class="string">&quot;集合遍历出来的元素/项&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;每一次遍历使用的分隔符&quot;</span> </span></span><br><span class="line"><span class="tag">         <span class="attr">open</span>=<span class="string">&quot;遍历开始前拼接的片段&quot;</span> <span class="attr">close</span>=<span class="string">&quot;遍历结束后拼接的片段&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.itheima.mapper.EmpMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--删除操作--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByIds&quot;</span>&gt;</span></span><br><span class="line">        delete from emp where id in</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;ids&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">            #&#123;id&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<blockquote>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213165710141-1715613343041-289.png" alt="image-20221213165710141"></p>
</blockquote>
<blockquote>
<p>执行的SQL语句：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213164957636-1715613343041-290.png" alt="image-20221213164957636"></p>
</blockquote>
<h4 id="7-4-动态SQL-sql-include"><a href="#7-4-动态SQL-sql-include" class="headerlink" title="7.4 动态SQL-sql&amp;include"></a>7.4 动态SQL-sql&amp;include</h4><p>问题分析：</p>
<ul>
<li>在xml映射文件中配置的SQL，有时可能会存在很多重复的片段，此时就会存在很多冗余的代码</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20220901182204358-1715613343041-291.png"></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20220901182249421-1715613343041-292.png"></p>
<p>我们可以对重复的代码片段进行抽取，将其通过<code>&lt;sql&gt;</code>标签封装到一个SQL片段，然后再通过<code>&lt;include&gt;</code>标签进行引用。</p>
<ul>
<li><p><code>&lt;sql&gt;</code>：定义可重用的SQL片段</p>
</li>
<li><p><code>&lt;include&gt;</code>：通过属性refid，指定包含的SQL片段</p>
</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20221213171244796-1715613343041-293.png" alt="image-20221213171244796"></p>
<p>SQL片段： 抽取重复的代码</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;commonSelect&quot;</span>&gt;</span></span><br><span class="line"> 	select id, username, password, name, gender, image, job, entrydate, dept_id, create_time, update_time from emp</span><br><span class="line"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后通过<code>&lt;include&gt;</code> 标签在原来抽取的地方进行引用。操作如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">![image-20220826161735076](./JavaWeb/image-20220826161735076.png)<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.itheima.pojo.Emp&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;commonSelect&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span></span><br><span class="line">            name like concat(&#x27;%&#x27;,#&#123;name&#125;,&#x27;%&#x27;)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span></span><br><span class="line">            and gender = #&#123;gender&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;begin != null and end != null&quot;</span>&gt;</span></span><br><span class="line">            and entrydate between #&#123;begin&#125; and #&#123;end&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    order by update_time desc</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h1 id="登录校验"><a href="#登录校验" class="headerlink" title="登录校验"></a>登录校验</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通常当我们访问某一个网页时 登陆后才能访问后端操作数据 但我们目前实现的这个 不管登不登陆都可以访问后端操作数据</span><br></pre></td></tr></table></figure>

<p>为什么会出现这个问题 是因为我们缺少了最重要的一步：<strong>登录校验</strong></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230105180811717-1715613343041-294.png"></p>
<p>什么是登录校验？</p>
<ul>
<li><p>所谓登录校验，指的是我们在服务器端接收到浏览器发送过来的请求之后，首先我们要对请求进行校验。先要校验一下用户登录了没有，如果用户已经登录了，就直接执行对应的业务操作就可以了；如果用户没有登录，此时就不允许他执行相关的业务操作，直接给前端响应一个错误的结果，最终跳转到登录页面，要求他登录成功之后，再来访问对应的数据。</p>
</li>
<li><p><img src="/img/loading.gif" data-original="/.com//image-20230105194710533-1715613343041-295.png"></p>
<p>那应该怎么来实现登录校验的操作呢？具体的实现思路可以分为两部分：</p>
<ol>
<li>在员工登录成功后，需要将用户登录成功的信息存起来，记录用户已经登录成功的标记。</li>
<li>在浏览器发起请求时，需要在服务端进行统一拦截，拦截后进行登录校验。</li>
</ol>
</li>
</ul>
<p>我们要完成以上操作，会涉及到web开发中的两个技术：</p>
<ol>
<li>会话技术</li>
<li>统一拦截技术</li>
</ol>
<h2 id="会话技术"><a href="#会话技术" class="headerlink" title="会话技术"></a>会话技术</h2><p>什么是会话？</p>
<ul>
<li><p>在我们日常生活当中，会话指的就是谈话、交谈。</p>
</li>
<li><p>在web开发当中，会话指的就是浏览器与服务器之间的一次连接，我们就称为一次会话。</p>
</li>
</ul>
<blockquote>
<p>在用户打开浏览器第一次访问服务器的时候，这个会话就建立了，直到有任何一方断开连接，此时会话就结束了。在一次会话当中，是可以包含多次请求和响应的。</p>
<p>比如：打开了浏览器来访问web服务器上的资源（浏览器不能关闭、服务器不能断开）</p>
<ul>
<li>第1次：访问的是登录的接口，完成登录操作</li>
<li>第2次：访问的是部门管理接口，查询所有部门数据</li>
<li>第3次：访问的是员工管理接口，查询员工数据</li>
</ul>
<p>只要浏览器和服务器都没有关闭，以上3次请求都属于一次会话当中完成的。</p>
</blockquote>
<p><img src="/img/loading.gif" data-original="/.com//image-20230105203827355-1715613343041-296.png" alt="image-20230105203827355"></p>
<p>会话跟踪技术有两种：</p>
<ol>
<li>Cookie（客户端会话跟踪技术）<ul>
<li>数据存储在客户端浏览器当中</li>
</ul>
</li>
<li>Session（服务端会话跟踪技术）<ul>
<li>数据存储在储在服务端</li>
</ul>
</li>
<li>令牌技术</li>
</ol>
<h3 id="方案一-Cookie"><a href="#方案一-Cookie" class="headerlink" title="方案一 - Cookie"></a>方案一 - Cookie</h3><p>cookie 是客户端会话跟踪技术，它是存储在客户端浏览器的，我们使用 cookie 来跟踪会话，我们就可以在浏览器第一次发起请求来请求服务器的时候，我们在服务器端来设置一个cookie。</p>
<p>比如第一次请求了登录接口，登录接口执行完成之后，我们就可以设置一个cookie，在 cookie 当中我们就可以来存储用户相关的一些数据信息。比如我可以在 cookie 当中来存储当前登录用户的用户名，用户的ID。</p>
<p>服务器端在给客户端在响应数据的时候，会<strong>自动</strong>的将 cookie 响应给浏览器，浏览器接收到响应回来的 cookie 之后，会<strong>自动</strong>的将 cookie 的值存储在浏览器本地。接下来在后续的每一次请求当中，都会将浏览器本地所存储的 cookie <strong>自动</strong>地携带到服务端。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112101901417-1715613343041-297.png" alt="image-20230112101901417"> </p>
<p>接下来在服务端我们就可以获取到 cookie 的值。我们可以去判断一下这个 cookie 的值是否存在，如果不存在这个cookie，就说明客户端之前是没有访问登录接口的；如果存在 cookie 的值，就说明客户端之前已经登录完成了。这样我们就可以基于 cookie 在同一次会话的不同请求之间来共享数据。</p>
<p>我刚才在介绍流程的时候，用了 3 个自动：</p>
<ul>
<li><p>服务器会 <strong>自动</strong> 的将 cookie 响应给浏览器。</p>
</li>
<li><p>浏览器接收到响应回来的数据之后，会 <strong>自动</strong> 的将 cookie 存储在浏览器本地。</p>
</li>
<li><p>在后续的请求当中，浏览器会 <strong>自动</strong> 的将 cookie 携带到服务器端。</p>
</li>
</ul>
<p><strong>为什么这一切都是自动化进行的？</strong></p>
<p>是因为 cookie 它是 HTP 协议当中所支持的技术，而各大浏览器厂商都支持了这一标准。在 HTTP 协议官方给我们提供了一个响应头和请求头：</p>
<ul>
<li><p>响应头 Set-Cookie ：设置Cookie数据的</p>
</li>
<li><p>请求头 Cookie：携带Cookie数据的</p>
</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112101804878-1715613343041-298.png" alt="image-20230112101804878"> </p>
<p><strong>代码测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置Cookie</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/c1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">cookie1</span><span class="params">(HttpServletResponse response)</span>&#123;</span><br><span class="line">        response.addCookie(<span class="keyword">new</span> <span class="title class_">Cookie</span>(<span class="string">&quot;login_username&quot;</span>,<span class="string">&quot;itheima&quot;</span>)); <span class="comment">//设置Cookie/响应Cookie</span></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">	</span><br><span class="line">    <span class="comment">//获取Cookie</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/c2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">cookie2</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        Cookie[] cookies = request.getCookies();</span><br><span class="line">        <span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">            <span class="keyword">if</span>(cookie.getName().equals(<span class="string">&quot;login_username&quot;</span>))&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;login_username: &quot;</span>+cookie.getValue()); <span class="comment">//输出name为login_username的cookie</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;    </span><br></pre></td></tr></table></figure>



<p>A. 访问c1接口，设置Cookie，<a target="_blank" rel="noopener" href="http://localhost:8080/c1">http://localhost:8080/c1</a></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112105410076.png" alt="image-20230112105410076"> </p>
<p>我们可以看到，设置的cookie，通过<strong>响应头Set-Cookie</strong>响应给浏览器，并且浏览器会将Cookie，存储在浏览器端。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112105538131-1715613343041-300.png" alt="image-20230112105538131"> </p>
<p>B. 访问c2接口 <a target="_blank" rel="noopener" href="http://localhost:8080/c2%EF%BC%8C%E6%AD%A4%E6%97%B6%E6%B5%8F%E8%A7%88%E5%99%A8%E4%BC%9A%E8%87%AA%E5%8A%A8%E7%9A%84%E5%B0%86Cookie%E6%90%BA%E5%B8%A6%E5%88%B0%E6%9C%8D%E5%8A%A1%E7%AB%AF%EF%BC%8C%E6%98%AF%E9%80%9A%E8%BF%87**%E8%AF%B7%E6%B1%82%E5%A4%B4Cookie**%EF%BC%8C%E6%90%BA%E5%B8%A6%E7%9A%84%E3%80%82">http://localhost:8080/c2，此时浏览器会自动的将Cookie携带到服务端，是通过**请求头Cookie**，携带的。</a></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112105658486.png" alt="image-20230112105658486"> </p>
<h4 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a><strong>优缺点</strong></h4><ul>
<li>优点：HTTP协议中支持的技术（像Set-Cookie 响应头的解析以及 Cookie 请求头数据的携带，都是浏览器自动进行的，是无需我们手动操作的）</li>
<li>缺点：<ul>
<li>移动端APP(Android、IOS)中无法使用Cookie</li>
<li>不安全，用户可以自己禁用Cookie</li>
<li>Cookie不能跨域</li>
</ul>
</li>
</ul>
<blockquote>
<p>跨域介绍：</p>
<p>​	 <img src="/img/loading.gif" data-original="/.com//image-20230112103840467-1715613343041-302.png" alt="image-20230112103840467" style="zoom:80%;"> </p>
<ul>
<li>现在的项目，大部分都是前后端分离的，前后端最终也会分开部署，前端部署在服务器 192.168.150.200 上，端口 80，后端部署在 192.168.150.100上，端口 8080</li>
<li>我们打开浏览器直接访问前端工程，访问url：<a target="_blank" rel="noopener" href="http://192.168.150.200/login.html">http://192.168.150.200/login.html</a></li>
<li>然后在该页面发起请求到服务端，而服务端所在地址不再是localhost，而是服务器的IP地址192.168.150.100，假设访问接口地址为：<a target="_blank" rel="noopener" href="http://192.168.150.100:8080/login">http://192.168.150.100:8080/login</a></li>
<li>那此时就存在跨域操作了，因为我们是在 <a target="_blank" rel="noopener" href="http://192.168.150.200/login.html">http://192.168.150.200/login.html</a> 这个页面上访问了<a target="_blank" rel="noopener" href="http://192.168.150.100:8080/login">http://192.168.150.100:8080/login</a> 接口</li>
<li>此时如果服务器设置了一个Cookie，这个Cookie是不能使用的，因为Cookie无法跨域</li>
</ul>
<p>区分跨域的维度：</p>
<ul>
<li>协议</li>
<li>IP&#x2F;协议</li>
<li>端口</li>
</ul>
<p>只要上述的三个维度有任何一个维度不同，那就是跨域操作</p>
<p>举例：</p>
<p>​	<a target="_blank" rel="noopener" href="http://192.168.150.200/login.html">http://192.168.150.200/login.html</a> ———-&gt; <a target="_blank" rel="noopener" href="https://192.168.150.200/login">https://192.168.150.200/login</a>   		[协议不同，跨域]</p>
<p>​	<a target="_blank" rel="noopener" href="http://192.168.150.200/login.html">http://192.168.150.200/login.html</a> ———-&gt; <a target="_blank" rel="noopener" href="http://192.168.150.100/login">http://192.168.150.100/login</a>     		[IP不同，跨域]</p>
<p>​	<a target="_blank" rel="noopener" href="http://192.168.150.200/login.html">http://192.168.150.200/login.html</a> ———-&gt; <a target="_blank" rel="noopener" href="http://192.168.150.200:8080/login">http://192.168.150.200:8080/login</a>   [端口不同，跨域]</p>
<p>​    <a target="_blank" rel="noopener" href="http://192.168.150.200/login.html">http://192.168.150.200/login.html</a> ———-&gt; <a target="_blank" rel="noopener" href="http://192.168.150.200/login">http://192.168.150.200/login</a>    		 [不跨域]   </p>
</blockquote>
<h3 id="方案二-Session"><a href="#方案二-Session" class="headerlink" title="方案二 - Session"></a>方案二 - Session</h3><p>前面介绍的时候，我们提到Session，它是服务器端会话跟踪技术，所以它是存储在服务器端的。而 Session 的底层其实就是基于我们刚才所介绍的 Cookie 来实现的。</p>
<ul>
<li><p>获取Session</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112105938545-1715613343041-303.png" alt="image-20230112105938545"> </p>
<p>如果我们现在要基于 Session 来进行会话跟踪，浏览器在第一次请求服务器的时候，我们就可以直接在服务器当中来获取到会话对象Session。如果是第一次请求Session ，会话对象是不存在的，这个时候服务器会自动的创建一个会话对象Session 。而每一个会话对象Session ，它都有一个ID（示意图中Session后面括号中的1，就表示ID），我们称之为 Session 的ID。</p>
</li>
<li><p>响应Cookie (JSESSIONID)</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112110441075-1715613343041-304.png" alt="image-20230112110441075"> </p>
<p>接下来，服务器端在给浏览器响应数据的时候，它会将 Session 的 ID 通过 Cookie 响应给浏览器。其实在响应头当中增加了一个 Set-Cookie 响应头。这个  Set-Cookie  响应头对应的值是不是cookie？ cookie 的名字是固定的 JSESSIONID 代表的服务器端会话对象 Session 的 ID。浏览器会自动识别这个响应头，然后自动将Cookie存储在浏览器本地。</p>
</li>
<li><p>查找Session</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112101943835-1715613343041-305.png" alt="image-20230112101943835"> </p>
<p>接下来，在后续的每一次请求当中，都会将 Cookie 的数据获取出来，并且携带到服务端。接下来服务器拿到JSESSIONID这个 Cookie 的值，也就是 Session 的ID。拿到 ID 之后，就会从众多的 Session 当中来找到当前请求对应的会话对象Session。</p>
<p>这样我们是不是就可以通过 Session 会话对象在同一次会话的多次请求之间来共享数据了？好，这就是基于 Session 进行会话跟踪的流程。</p>
</li>
</ul>
<p><strong>代码测试</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SessionController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/s1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">session1</span><span class="params">(HttpSession session)</span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;HttpSession-s1: &#123;&#125;&quot;</span>, session.hashCode());</span><br><span class="line"></span><br><span class="line">        session.setAttribute(<span class="string">&quot;loginUser&quot;</span>, <span class="string">&quot;tom&quot;</span>); <span class="comment">//往session中存储数据</span></span><br><span class="line">        <span class="keyword">return</span> Result.success();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/s2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">session2</span><span class="params">(HttpServletRequest request)</span>&#123;</span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        log.info(<span class="string">&quot;HttpSession-s2: &#123;&#125;&quot;</span>, session.hashCode());</span><br><span class="line"></span><br><span class="line">        <span class="type">Object</span> <span class="variable">loginUser</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;loginUser&quot;</span>); <span class="comment">//从session中获取数据</span></span><br><span class="line">        log.info(<span class="string">&quot;loginUser: &#123;&#125;&quot;</span>, loginUser);</span><br><span class="line">        <span class="keyword">return</span> Result.success(loginUser);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>A. 访问 s1 接口，<a target="_blank" rel="noopener" href="http://localhost:8080/s1">http://localhost:8080/s1</a></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112111004447.png" alt="image-20230112111004447"> </p>
<p>请求完成之后，在响应头中，就会看到有一个Set-Cookie的响应头，里面响应回来了一个Cookie，就是JSESSIONID，这个就是服务端会话对象 Session 的ID。</p>
<p>B. 访问 s2 接口，<a target="_blank" rel="noopener" href="http://localhost:8080/s2">http://localhost:8080/s2</a></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112111137207.png" alt="image-20230112111137207"> </p>
<p>接下来，在后续的每次请求时，都会将Cookie的值，携带到服务端，那服务端呢，接收到Cookie之后，会自动的根据JSESSIONID的值，找到对应的会话对象Session。</p>
<p>那经过这两步测试，大家也会看到，在控制台中输出如下日志：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112111328117-1715613343041-308.png" alt="image-20230112111328117"> </p>
<p>两次请求，获取到的Session会话对象的hashcode是一样的，就说明是同一个会话对象。而且，第一次请求时，往Session会话对象中存储的值，第二次请求时，也获取到了。 那这样，我们就可以通过Session会话对象，在同一个会话的多次请求之间来进行数据共享了。</p>
<h4 id="优缺点-1"><a href="#优缺点-1" class="headerlink" title="优缺点"></a><strong>优缺点</strong></h4><ul>
<li>优点：Session是存储在服务端的，安全</li>
<li>缺点：<ul>
<li>服务器集群环境下无法直接使用Session</li>
<li>移动端APP(Android、IOS)中无法使用Cookie</li>
<li>用户可以自己禁用Cookie</li>
<li>Cookie不能跨域</li>
</ul>
</li>
</ul>
<blockquote>
<p>PS：Session 底层是基于Cookie实现的会话跟踪，如果Cookie不可用，则该方案，也就失效了。</p>
</blockquote>
<blockquote>
<p>服务器集群环境为何无法使用Session？</p>
<p>​	<img src="/img/loading.gif" data-original="/.com//image-20230112112557480-1715613343042-309.png" alt="image-20230112112557480" style="zoom:67%;"> </p>
<ul>
<li>首先第一点，我们现在所开发的项目，一般都不会只部署在一台服务器上，因为一台服务器会存在一个很大的问题，就是单点故障。所谓单点故障，指的就是一旦这台服务器挂了，整个应用都没法访问了。</li>
</ul>
<p>​    <img src="/img/loading.gif" data-original="/.com//image-20230112112740131-1715613343042-310.png" alt="image-20230112112740131"> </p>
<ul>
<li><p>所以在现在的企业项目开发当中，最终部署的时候都是以集群的形式来进行部署，也就是同一个项目它会部署多份。比如这个项目我们现在就部署了 3 份。</p>
</li>
<li><p>而用户在访问的时候，到底访问这三台其中的哪一台？其实用户在访问的时候，他会访问一台前置的服务器，我们叫负载均衡服务器，我们在后面项目当中会详细讲解。目前大家先有一个印象负载均衡服务器，它的作用就是将前端发起的请求均匀的分发给后面的这三台服务器。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112113558810-1715613343042-311.png" alt="image-20230112113558810"> </p>
</li>
<li><p>此时假如我们通过 session 来进行会话跟踪，可能就会存在这样一个问题。用户打开浏览器要进行登录操作，此时会发起登录请求。登录请求到达负载均衡服务器，将这个请求转给了第一台 Tomcat 服务器。</p>
<p>Tomcat 服务器接收到请求之后，要获取到会话对象session。获取到会话对象 session 之后，要给浏览器响应数据，最终在给浏览器响应数据的时候，就会携带这么一个 cookie 的名字，就是 JSESSIONID ，下一次再请求的时候，是不是又会将 Cookie 携带到服务端？</p>
<p>好。此时假如又执行了一次查询操作，要查询部门的数据。这次请求到达负载均衡服务器之后，负载均衡服务器将这次请求转给了第二台 Tomcat 服务器，此时他就要到第二台 Tomcat 服务器当中。根据JSESSIONID 也就是对应的 session 的 ID 值，要找对应的 session 会话对象。</p>
<p>我想请问在第二台服务器当中有没有这个ID的会话对象 Session， 是没有的。此时是不是就出现问题了？我同一个浏览器发起了 2 次请求，结果获取到的不是同一个会话对象，这就是Session这种会话跟踪方案它的缺点，在服务器集群环境下无法直接使用Session。</p>
</li>
</ul>
</blockquote>
<p>大家会看到上面这两种传统的会话技术，在现在的企业开发当中是不是会存在很多的问题。 为了解决这些问题，在现在的企业开发当中，基本上都会采用第三种方案，通过令牌技术来进行会话跟踪。接下来我们就来介绍一下令牌技术，来看一下令牌技术又是如何跟踪会话的。</p>
<h3 id="方案三-令牌技术"><a href="#方案三-令牌技术" class="headerlink" title="方案三 - 令牌技术"></a>方案三 - 令牌技术</h3><p>这里我们所提到的令牌，其实它就是一个用户身份的标识，看似很高大上，很神秘，其实本质就是一个字符串。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112102022634-1715613343042-312.png" alt="image-20230112102022634"> </p>
<p>如果通过令牌技术来跟踪会话，我们就可以在浏览器发起请求。在请求登录接口的时候，如果登录成功，我就可以生成一个令牌，令牌就是用户的合法身份凭证。接下来我在响应数据的时候，我就可以直接将令牌响应给前端。</p>
<p>接下来我们在前端程序当中接收到令牌之后，就需要将这个令牌存储起来。这个存储可以存储在 cookie 当中，也可以存储在其他的存储空间(比如：localStorage)当中。</p>
<p>接下来，在后续的每一次请求当中，都需要将令牌携带到服务端。携带到服务端之后，接下来我们就需要来校验令牌的有效性。如果令牌是有效的，就说明用户已经执行了登录操作，如果令牌是无效的，就说明用户之前并未执行登录操作。</p>
<p>此时，如果是在同一次会话的多次请求之间，我们想共享数据，我们就可以将共享的数据存储在令牌当中就可以了。</p>
<p><strong>优缺点</strong></p>
<ul>
<li>优点：<ul>
<li>支持PC端、移动端</li>
<li>解决集群环境下的认证问题</li>
<li>减轻服务器的存储压力（无需在服务器端存储）</li>
</ul>
</li>
<li>缺点：需要自己实现（包括令牌的生成、令牌的传递、令牌的校验）</li>
</ul>
<p>针对于这三种方案，现在企业开发当中使用的最多的就是第三种令牌技术进行会话跟踪。而前面的这两种传统的方案，现在企业项目开发当中已经很少使用了。所以在我们的课程当中，我们也将会采用令牌技术来解决案例项目当中的会话跟踪问题。</p>
<h2 id="JWT令牌技术"><a href="#JWT令牌技术" class="headerlink" title="JWT令牌技术"></a>JWT令牌技术</h2><ul>
<li><p><strong>全称</strong>：<code>Json Web Token</code></p>
</li>
<li><p>定义了一种简洁的、自包含的格式，用于在通信双方以json数据格式安全的传输信息，用于数字签名的存在，这些信息是可靠的</p>
</li>
<li><p><strong>组成</strong>：</p>
<ul>
<li><p>第一部分：Header(头)，记录令牌类型、签名算法等，例如：{“alg”:”HS256”,”type”:”JWT”}</p>
</li>
<li><p>第二部分：Payload(有效载荷)，携带一些自定义信息，默认信息等，例如：{“id”:”1”,”username”:”tom”}</p>
</li>
<li><p>第三部分：Signature(签名)，防止Token被篡改，确保安全性，将Header、Payload，并加入指定密钥，通过指定签名算法计算而来</p>
</li>
</ul>
</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20240325110500548.png" alt="image-20240325110500548"></p>
<ul>
<li><strong>场景</strong>：登录认证<ol>
<li>登录成功后，生成令牌</li>
<li>后续每个请求，都需要携带jwt令牌，系统在每次请求处理之前，先校验令牌，通过后，在处理</li>
</ol>
</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20240325110921704.png" alt="image-20240325110921704"></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240325114101996-1715613343042-315.png" alt="image-20240325114101996"></p>
<h3 id="JWT令牌-生成"><a href="#JWT令牌-生成" class="headerlink" title="JWT令牌-生成"></a><strong>JWT令牌-生成</strong></h3><ul>
<li>要在pom文件中引入相关的依赖</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20240325113642999-1715613343042-316.png" alt="image-20240325113642999"></p>
<ul>
<li><p>编写测试类</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240325113707625.png" alt="image-20240325113707625"></p>
</li>
</ul>
<h3 id="JWT令牌-解析"><a href="#JWT令牌-解析" class="headerlink" title="JWT令牌-解析"></a>JWT令牌-解析</h3><p><img src="/img/loading.gif" data-original="/.com//image-20240325113912663-1715613343042-318.png" alt="image-20240325113912663"></p>
<h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><ul>
<li>JWT校验时使用的签名密钥，必须和生成JWT令牌时使用的密钥时配套的</li>
<li>如果JWT令牌解析校验时报错，则说明JWT令牌被篡改或失效了，令牌非法</li>
</ul>
<h2 id="Filter过滤器"><a href="#Filter过滤器" class="headerlink" title="Filter过滤器"></a>Filter过滤器</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- 概念：Filter过滤器，是JavaWeb三大组件（Servlet、Listener、Filter）之一</span><br><span class="line">-- 过滤器可以把对资源的请求拦截下来，从而实现一些特殊的功能</span><br><span class="line">-- 过滤器一般完成一些通用的操作，比如：登录校验、统一编码处理、敏感字符处理等</span><br></pre></td></tr></table></figure>



<h3 id="Filter快速入门"><a href="#Filter快速入门" class="headerlink" title="Filter快速入门"></a>Filter快速入门</h3><ul>
<li>定义Filter：定义一个类，实现Filter（javax.servlet）接口，并重写其所有方法</li>
<li>配置Filter：Filter类上加<code>@WebFilter</code>注解，配置拦截资源的路径，引导类上加<code>@ServletComponentScan</code>开启Sevlet组件支持</li>
</ul>
<p>Filter类</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240325152707043-1715613343042-319.png" alt="image-20240325152707043"></p>
<p>引导类</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240325152730300-1715613343042-320.png" alt="image-20240325152730300">	</p>
<h3 id="详解（执行流程、拦截路径、过滤器链）"><a href="#详解（执行流程、拦截路径、过滤器链）" class="headerlink" title="详解（执行流程、拦截路径、过滤器链）"></a>详解（执行流程、拦截路径、过滤器链）</h3><p>1.执行流程</p>
<ul>
<li>请求&#x3D;&#x3D;&gt;放行前的逻辑&#x3D;&#x3D;&gt;放行&#x3D;&#x3D;&gt;访问Web资源&#x3D;&#x3D;&gt;放行后的逻辑</li>
</ul>
<p>2.拦截路径</p>
<ul>
<li>&#x2F;login</li>
<li>&#x2F;depts&#x2F;*</li>
<li>&#x2F;*</li>
</ul>
<p>3.过滤器链</p>
<ul>
<li>一个web应用中，配置了多个过滤器，就形成了一个过滤器链</li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240325154952548-1715613343042-321.png" alt="image-20240325154952548"></li>
</ul>
<h3 id="登录校验-Filter"><a href="#登录校验-Filter" class="headerlink" title="登录校验-Filter"></a>登录校验-Filter</h3><ul>
<li>所有的请求，拦截到了之后，都需要校验令牌吗？<ul>
<li>不是 有一个例外 登录请求 因为没登陆的时候是没有jwt令牌的</li>
</ul>
</li>
<li>拦截到请求后，什么情况下可以放行，执行业务操作？<ul>
<li>有令牌，且令牌校验通过（合法），否则都返回登录错误的结果</li>
</ul>
</li>
</ul>
<p>步骤：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpServletRequest</span> <span class="variable">req</span> <span class="operator">=</span> (HttpServletRequest) Request;</span><br><span class="line">      <span class="type">HttpServletResponse</span> <span class="variable">resp</span> <span class="operator">=</span> (HttpServletResponse) Response;		</span><br><span class="line"><span class="comment">//1.获取请求url</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> req.getRequestURL().toString();</span><br><span class="line">      log.info(<span class="string">&quot;请求的url:&#123;&#125;&quot;</span>,url);</span><br><span class="line">      <span class="comment">//2.判断请求url中是否含有login，如果包含，则说明是登录请求，放行</span></span><br><span class="line">      <span class="keyword">if</span> (url.contains(<span class="string">&quot;login&quot;</span>)) &#123;</span><br><span class="line">          log.inf	<span class="title function_">o</span><span class="params">(<span class="string">&quot;登陆操作，放行&quot;</span>)</span>;</span><br><span class="line">          Chain.doFilter(Request,Response);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//3.获取请求头中的令牌</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> req.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">      <span class="comment">//4.判断令牌是否存在，如果不存在，返回错误结果（未登录）</span></span><br><span class="line">      <span class="keyword">if</span> (!StringUtils.hasLength(jwt)) &#123;  <span class="comment">//判断jwt令牌是否为null或空字符串</span></span><br><span class="line">          log.info(<span class="string">&quot;请求头token为空，返回未登录的信息&quot;</span>);</span><br><span class="line">          <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);</span><br><span class="line">          <span class="comment">//手动转换为json格式---&gt;阿里巴巴提供的fastJSON工具类</span></span><br><span class="line">          <span class="type">String</span> <span class="variable">notLogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);</span><br><span class="line">          resp.getWriter().write(notLogin);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//5.解析token，如果解析失败，返回错误结果（未登录）</span></span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">          JwtUtils.parseJWT(jwt);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123; <span class="comment">//jwt解析失败</span></span><br><span class="line">          log.info(<span class="string">&quot;令牌解析失败，返回未登录的信息&quot;</span>);</span><br><span class="line">          <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);</span><br><span class="line">          <span class="comment">//手动转换为json格式---&gt;阿里巴巴提供的fastJSON工具类</span></span><br><span class="line">          <span class="type">String</span> <span class="variable">notLogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);</span><br><span class="line">          resp.getWriter().write(notLogin);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//6.放行</span></span><br><span class="line">      log.info(<span class="string">&quot;令牌合法，放行通过&quot;</span>);</span><br><span class="line">      Chain.doFilter(Request,Response);</span><br></pre></td></tr></table></figure>



<h2 id="Interceptor拦截器"><a href="#Interceptor拦截器" class="headerlink" title="Interceptor拦截器"></a>Interceptor拦截器</h2><ul>
<li>概念：是一种动态拦截方法调用的机制，类似于过滤器，Spring框架中提供，用来动态拦截控制器方法的执行</li>
<li>作用：拦截请求，在指定的方法调用前后，根据业务需求执行预先设定的代码</li>
</ul>
<h3 id="简介-快速入门"><a href="#简介-快速入门" class="headerlink" title="简介&amp;快速入门"></a>简介&amp;快速入门</h3><ol>
<li><p>定义拦截器，实现HandlerInterceptor接口，并重写其所有方法</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240325215327083.png" alt="image-20240325215327083"></p>
</li>
<li><p>注册拦截器</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240325215313458-1715613343042-323.png" alt="image-20240325215313458"></p>
</li>
</ol>
<h3 id="详解"><a href="#详解" class="headerlink" title="详解"></a>详解</h3><ol>
<li><strong>拦截器-拦截器路径</strong><ul>
<li>拦截器可以根据需求，配置不同的拦截路径</li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240325215510710.png"></li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240325215526255.png"></li>
</ul>
</li>
<li><strong>拦截器-执行流程</strong><ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240326085139308.png" alt="image-20240326085139308"></li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Filter 和 Interceptor</span><br><span class="line">接口规范不同：过滤器需要实现Filter接口，而拦截器需要实现HandlerInterceptor接口</span><br><span class="line">拦截范围不同：过滤器Filter会拦截所有资源，而Interceptor只会拦截SpringMVC环境中的资源</span><br></pre></td></tr></table></figure>



<h3 id="登录校验-interceptor"><a href="#登录校验-interceptor" class="headerlink" title="登录校验-interceptor"></a>登录校验-interceptor</h3><p>步骤：</p>
<p>​	在Filter的基础上进行更改</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.获取请求url</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> req.getRequestURL().toString();</span><br><span class="line">        log.info(<span class="string">&quot;请求的url:&#123;&#125;&quot;</span>,url);</span><br><span class="line">        <span class="comment">//2.判断请求url中是否含有login，如果包含，则说明是登录请求，放行</span></span><br><span class="line">        <span class="keyword">if</span> (url.contains(<span class="string">&quot;login&quot;</span>)) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;登陆操作，放行&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//3.获取请求头中的令牌</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jwt</span> <span class="operator">=</span> req.getHeader(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="comment">//4.判断令牌是否存在，如果不存在，返回错误结果（未登录）</span></span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasLength(jwt)) &#123;  <span class="comment">//判断jwt令牌是否为null或空字符串</span></span><br><span class="line">            log.info(<span class="string">&quot;请求头token为空，返回未登录的信息&quot;</span>);</span><br><span class="line">            <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);</span><br><span class="line">            <span class="comment">//手动转换为json格式---&gt;阿里巴巴提供的fastJSON工具类</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">notLogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);</span><br><span class="line">            resp.getWriter().write(notLogin);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//5.解析token，如果解析失败，返回错误结果（未登录）</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            JwtUtils.parseJWT(jwt);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123; <span class="comment">//jwt解析失败</span></span><br><span class="line">            log.info(<span class="string">&quot;令牌解析失败，返回未登录的信息&quot;</span>);</span><br><span class="line">            <span class="type">Result</span> <span class="variable">error</span> <span class="operator">=</span> Result.error(<span class="string">&quot;NOT_LOGIN&quot;</span>);</span><br><span class="line">            <span class="comment">//手动转换为json格式---&gt;阿里巴巴提供的fastJSON工具类</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">notLogin</span> <span class="operator">=</span> JSONObject.toJSONString(error);</span><br><span class="line">            resp.getWriter().write(notLogin);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//6.放行</span></span><br><span class="line">        log.info(<span class="string">&quot;令牌合法，放行通过&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br></pre></td></tr></table></figure>

<h2 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h2><p><img src="/img/loading.gif" data-original="/.com//image-20240327183856718.png" alt="image-20240327183856718"></p>
<h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><h2 id="当前问题"><a href="#当前问题" class="headerlink" title="当前问题"></a>当前问题</h2><p>登录功能和登录校验功能我们都实现了，下面我们学习下今天最后一块技术点：异常处理。首先我们先来看一下系统出现异常之后会发生什么现象，再来介绍异常处理的方案。</p>
<p>我们打开浏览器，访问系统中的新增部门操作，系统中已经有了 “就业部” 这个部门，我们再来增加一个就业部，看看会发生什么现象。</p>
<img src="/img/loading.gif" data-original="/.com//image-20230112125651073.png" alt="image-20230112125651073" style="zoom: 80%;">   

<p>点击确定之后，窗口关闭了，页面没有任何反应，就业部也没有添加上。 而此时，大家会发现，网络请求报错了。</p>
<img src="/img/loading.gif" data-original="/.com//image-20230112125737863.png" alt="image-20230112125737863" style="zoom:80%;"> 

<p>状态码为500，表示服务器端异常，我们打开idea，来看一下，服务器端出了什么问题。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112125826602.png" alt="image-20230112125826602"> </p>
<p>上述错误信息的含义是，dept部门表的name字段的值 就业部 重复了，因为在数据库表dept中已经有了就业部，我们之前设计这张表时，为name字段建议了唯一约束，所以该字段的值是不能重复的。</p>
<p>而当我们再添加就业部，这个部门时，就违反了唯一约束，此时就会报错。</p>
<p>我们来看一下出现异常之后，最终服务端给前端响应回来的数据长什么样。</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112130253486.png" alt="image-20230112130253486"> </p>
<p>响应回来的数据是一个JSON格式的数据。但这种JSON格式的数据还是我们开发规范当中所提到的统一响应结果Result吗？显然并不是。由于返回的数据不符合开发规范，所以前端并不能解析出响应的JSON数据。</p>
<p>接下来我们需要思考的是出现异常之后，当前案例项目的异常是怎么处理的？</p>
<ul>
<li>答案：没有做任何的异常处理</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20230107121909087.png" alt="image-20230107121909087"></p>
<p>当我们没有做任何的异常处理时，我们三层架构处理异常的方案：</p>
<ul>
<li>Mapper接口在操作数据库的时候出错了，此时异常会往上抛(谁调用Mapper就抛给谁)，会抛给service。 </li>
<li>service 中也存在异常了，会抛给controller。</li>
<li>而在controller当中，我们也没有做任何的异常处理，所以最终异常会再往上抛。最终抛给框架之后，框架就会返回一个JSON格式的数据，里面封装的就是错误的信息，但是框架返回的JSON格式的数据并不符合我们的开发规范。</li>
</ul>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h2><p>那么在三层构架项目中，出现了异常，该如何处理?</p>
<ul>
<li>方案一：在所有Controller的所有方法中进行try…catch处理<ul>
<li>缺点：代码臃肿（不推荐）</li>
</ul>
</li>
<li>方案二：全局异常处理器<ul>
<li>好处：简单、优雅（推荐）</li>
</ul>
</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20230107122904214.png" alt="image-20230107122904214"></p>
<h2 id="全局异常处理器"><a href="#全局异常处理器" class="headerlink" title="全局异常处理器"></a>全局异常处理器</h2><p>我们该怎么样定义全局异常处理器？</p>
<ul>
<li>定义全局异常处理器非常简单，就是定义一个类，在类上加上一个注解@RestControllerAdvice，加上这个注解就代表我们定义了一个全局异常处理器。</li>
<li>在全局异常处理器当中，需要定义一个方法来捕获异常，在这个方法上需要加上注解@ExceptionHandler。通过@ExceptionHandler注解当中的value属性来指定我们要捕获的是哪一类型的异常。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//处理异常</span></span><br><span class="line">    <span class="meta">@ExceptionHandler(Exception.class)</span> <span class="comment">//指定能够处理的异常类型</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">ex</span><span class="params">(Exception e)</span>&#123;</span><br><span class="line">        e.printStackTrace();<span class="comment">//打印堆栈中的异常信息</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//捕获到异常之后，响应一个标准的Result</span></span><br><span class="line">        <span class="keyword">return</span> Result.error(<span class="string">&quot;对不起,操作失败,请联系管理员&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>@RestControllerAdvice &#x3D; @ControllerAdvice + @ResponseBody</p>
<p>处理异常的方法返回值会转换为json后再响应给前端</p>
</blockquote>
<p>重新启动SpringBoot服务，打开浏览器，再来测试一下添加部门这个操作，我们依然添加已存在的 “就业部” 这个部门：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112131232032.png" alt="image-20230112131232032"> </p>
<p><img src="/img/loading.gif" data-original="/.com//image-20230112131135272.png" alt="image-20230112131135272"> </p>
<p>此时，我们可以看到，出现异常之后，异常已经被全局异常处理器捕获了。然后返回的错误信息，被前端程序正常解析，然后提示出了对应的错误提示信息。</p>
<p>以上就是全局异常处理器的使用，主要涉及到两个注解：</p>
<ul>
<li>@RestControllerAdvice  &#x2F;&#x2F;表示当前类为全局异常处理器</li>
<li>@ExceptionHandler  &#x2F;&#x2F;指定可以捕获哪种类型的异常进行处理</li>
</ul>
<h1 id="Spring事务管理"><a href="#Spring事务管理" class="headerlink" title="Spring事务管理"></a>Spring事务管理</h1><ul>
<li>注解：<code>@Transactional</code></li>
<li>位置：业务层(service)的方法上、类上、接口上</li>
<li>作用：将当前方法交给spring进行事务管理，方法执行前，开启事务；成功执行完毕，提交事务；回滚事务</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326091451610.png" alt="image-20240326091451610"></p>
<h2 id="事务属性"><a href="#事务属性" class="headerlink" title="事务属性"></a>事务属性</h2><h3 id="回滚rollback"><a href="#回滚rollback" class="headerlink" title="回滚rollback"></a>回滚rollback</h3><ul>
<li><code>@rollbackFor</code></li>
<li>默认情况下，只有出现@RuntimeException才会回滚，rollbackFor属性用于控制出现何种异常类型，回滚事务</li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240326093053231.png" alt="image-20240326093053231"></li>
</ul>
<h3 id="传播行为propagation"><a href="#传播行为propagation" class="headerlink" title="传播行为propagation"></a>传播行为propagation</h3><p>事务传播行为：指的就是当一个事务方法被另一事务方法调用时，这个事务方法该如何进行事务控制</p>
<ul>
<li>REQUIRED：大部分情况下都是用该传播行为即可</li>
<li>REQUIRES_NEW：当我们不希望事务之间相互影响，可以使用该传播行为，比如：下订单前需要记录日志，不论订单保存成功与否，都需要保证日志记录能够记录成功</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326095623453.png" alt="image-20240326095623453"></p>
<p>例如：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240328104531917-1715613343042-331.png" alt="image-20240328104531917"></p>
<p>在上述完成删除部门操作时，不管失败与否 都要记录日志 那么deptLogService中的insert语句就要添加事务</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326100618155-1715613343042-332.png" alt="image-20240326100618155"></p>
<p>当Transaction的值为默认值时，加入delete中的语句报错 会发生回滚 到时会连带insert一起回滚</p>
<p>如果设置REQUIRES_NEW则不会  因为propagation的默认值会自动加入已存在的事务  REQUIRES_NEW则会创建新的事务</p>
<h1 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h1><h2 id="AOP基础"><a href="#AOP基础" class="headerlink" title="AOP基础"></a>AOP基础</h2><h3 id="AOP概述"><a href="#AOP概述" class="headerlink" title="AOP概述"></a>AOP概述</h3><ul>
<li><code>AOP</code>：Aspect Oriented Progtamming(面向切面编程、面向方面编程)，其实就是棉线特定方法编程</li>
</ul>
<p> <strong>场景：</strong></p>
<ul>
<li>案例部分佛南功能运行较慢，定位执行耗时较长的业务方法，此时需要统计每一个业务方法的执行耗时</li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240326110621621.png" alt="image-20240326110621621"></li>
</ul>
<p><strong>实现：</strong></p>
<ul>
<li>动态代理时面向切面编程最主流的实现，而SpringAOP时Spring框架的高级技术，旨在管理bean对象的过程中，主要通过底层的动态代理机制，对特定的方法进行编程</li>
</ul>
<p><strong>底层原理：</strong></p>
<ul>
<li>动态代理机制</li>
</ul>
<p><strong>Spring的AOP的底层用到了两种代理机制：</strong></p>
<ul>
<li>JDK的动态代理：针对实现接口的类产生代理 </li>
<li>Cglib的动态代理：针对没有实现接口的类产生代理</li>
</ul>
<h3 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h3><ul>
<li><p>导入依赖</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326111320941-1715613343042-334.png" alt="image-20240326111320941"></p>
</li>
<li><p>编写aop程序：针对于特定方法根据业务需要进行编程</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326112306354-1715613343042-335.png" alt="image-20240326112306354"></p>
</li>
</ul>
<h3 id="AOP核心概念"><a href="#AOP核心概念" class="headerlink" title="AOP核心概念"></a>AOP核心概念</h3><ul>
<li>连接点：<code>JoinPoint</code>，可以被AOP控制的方法（暗含方法执行的相关信息）</li>
<li>通知：<code>Advice</code>， 指哪些重复的逻辑，也就是共性功能（最终体现为一个方法）</li>
<li>切入点：<code>PointCut</code>，匹配链接点的条件，通知仅会在切入点方法执行时被应用</li>
<li>切面：<code>Aspect</code>，描述通知与切入点，的对应关系（通知+切入点）</li>
<li>目标对象：<code>Target</code>，通知所应用的对象</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326125641380.png" alt="image-20240326125641380"></p>
<h3 id="AOP执行流程"><a href="#AOP执行流程" class="headerlink" title="AOP执行流程"></a>AOP执行流程</h3><p><img src="/img/loading.gif" data-original="/.com//image-20240326130435084.png" alt="image-20240326130435084"></p>
<h2 id="AOP进阶"><a href="#AOP进阶" class="headerlink" title="AOP进阶"></a>AOP进阶</h2><h3 id="通知类型"><a href="#通知类型" class="headerlink" title="通知类型"></a>通知类型</h3><ul>
<li><code>@Around</code> ：环绕通知，此注解标注的通知方法在目标方法前、后都被执行<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240326144648642-1715613343042-338.png" alt="image-20240326144648642"></li>
</ul>
</li>
<li><code>@Before</code> ：前置通知，此注解标注的通知方法在目标方法前被执行<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240326144638119-1715613343042-339.png" alt="image-20240326144638119"></li>
</ul>
</li>
<li><code>@After</code> （<strong>重点</strong>）：后置通知，此注解标注的通知方式在目标方法后被执行<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240326144656721-1715613343042-340.png" alt="image-20240326144656721"></li>
</ul>
</li>
<li><code>@AfterRuning</code> ：返回后通知，此注解标注的通知方法在目标方法后被执行，有异常不会执行<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240326144703033-1715613343042-341.png" alt="image-20240326144703033"></li>
</ul>
</li>
<li><code>@AfterThrowing</code> ：异常后通知，此注解标注的通知方法发生异常后通知<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240326144709491-1715613343042-342.png" alt="image-20240326144709491"></li>
</ul>
</li>
</ul>
<p><strong>注意事项</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around</span>环绕通知需要自己调用 ProceedingJoinPoint.proceed() 来让原始方法执行，其他通知不需要考虑目标方法执行</span><br><span class="line"><span class="meta">@Around</span>环绕通知方法的返回值，必须指定为Object，来接受原始方法的返回值</span><br></pre></td></tr></table></figure>

<p><strong>抽取：</strong></p>
<p><code>@PointCut</code>注解</p>
<ul>
<li>该注解的作用是将公共的切点表达式抽取出来，需要使用的时引用该切点表达式即可</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326144849843-1715613343042-343.png" alt="image-20240326144849843"></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326144931497-1715613343042-344.png" alt="image-20240326144931497"></p>
<p>直接调用 别的类中的也可直接调用 这里取决于px的修饰符</p>
<ul>
<li>private：仅能在当前切面类中引用该表达式</li>
<li>public：其他外部的切面类中也可以引用该表达式</li>
</ul>
<h3 id="通知顺序"><a href="#通知顺序" class="headerlink" title="通知顺序"></a>通知顺序</h3><p><strong>当有多个切面的切入点都匹配到了目标方法，目标方法运行时，多个通方法都会被执行</strong></p>
<p>执行顺序：</p>
<ul>
<li><p>1.不同切面类中，默认按照切面类的类名字母排序</p>
<ul>
<li><p>目标方法前的通知方法：字母排名靠前的先执行</p>
</li>
<li><p>目标方法后的通知方法：字母排名靠前的后执行</p>
</li>
</ul>
</li>
<li><p>2.用<code>@Order(数字)</code> 加在切面类上来控制顺序</p>
<ul>
<li>目标方法前的通知方法：数字小的先执行</li>
<li>目标方法后的通知方法：数字小的后执行</li>
</ul>
</li>
</ul>
<h3 id="切入点表达式"><a href="#切入点表达式" class="headerlink" title="切入点表达式"></a>切入点表达式</h3><ul>
<li>切入点表达式：描述切入点方法的一种表达式</li>
<li>作用：主要用来决定项目中的那些方法需要加入通知</li>
<li>常见形式<ul>
<li><code>execution(...)</code> ：根据方法的签名来匹配</li>
<li><code>@annotation(...)</code> ：根据注解匹配</li>
</ul>
</li>
</ul>
<h4 id="executation"><a href="#executation" class="headerlink" title="executation"></a>executation</h4><p>execution主要根据方法的返回值、包名、类名、方法名、方法参数等信息来匹，语法为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">executation(访问修饰符？ 返回值 包名.类名？ 方法名(方法参数) <span class="keyword">throws</span> 异常？ )</span><br></pre></td></tr></table></figure>

<ul>
<li>其中带<code>?</code>的表示可省略的部分<ul>
<li>访问修饰符：可省略(比如：public、protected)</li>
<li>包名.类名：可省略</li>
<li>throw 异常：可省略 (注意是方法向上声明抛出的异常，不是实际抛出的异常)</li>
</ul>
</li>
<li>可以使用通配符描述切入点<ul>
<li><code>*</code> ： 单个独立的任意符号，可以统配任意返回值、包名、类名、方法名、任意类型的一个参数、也可以统配包、类、方法名的一部分<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240326161142261-1715613343042-345.png" alt="image-20240326161142261"></li>
</ul>
</li>
<li><code>..</code> ： 多个连续的任意符号，可以通配任意层级的包，或任意类型，任意个数的参数<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240326161240834-1715613343042-346.png" alt="image-20240326161240834"></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326161917056-1715613343042-347.png" alt="image-20240326161917056"></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326161540654-1715613343042-348.png" alt="image-20240326161540654"></p>
<h4 id="annotation"><a href="#annotation" class="headerlink" title="@annotation"></a>@annotation</h4><p>@annotation 切入点表达式，用于匹配表示有特定注解的方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@annotation(com.raehp.anno.Log)</span><br></pre></td></tr></table></figure>

<p>实现步骤：</p>
<ul>
<li><p>创建Annoation注解</p>
</li>
<li><p><img src="/img/loading.gif" data-original="/.com//image-20240326162858318-1715613343042-349.png" alt="image-20240326162858318"></p>
</li>
<li><p>注解中添加@Retention注解、@Target注解</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326162938421-1715613343042-350.png" alt="image-20240326162938421"></p>
</li>
<li><p>在需要通知的方法上添加注解</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326163003775-1715613343042-351.png" alt="image-20240326163003775"></p>
</li>
<li><p>通过Pointcut修改切入点表达式 声明注解</p>
</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326163051297-1715613343042-352.png" alt="image-20240326163051297"></p>
<h3 id="连接点"><a href="#连接点" class="headerlink" title="连接点"></a>连接点</h3><ul>
<li>在Spring中用<code>JoinPoint</code>抽象了连接点，用它可以获得方法执行时的信息，如目标类名，方法名，方法参数等。<ul>
<li>对于<code>@Around</code> 通知，获取连接点信息只能使用，<code>ProceedingJoinPoint</code></li>
<li>对于其他四种通知，获取连接点信息只能使用 <code>JoinPoint</code> ，他是 <code>ProceedingJoinPoint</code> 的父类型</li>
</ul>
</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20240326190904328.png" alt="image-20240326190904328"></p>
<h1 id="SpringBoot"><a href="#SpringBoot" class="headerlink" title="SpringBoot"></a>SpringBoot</h1><h2 id="配置优先级"><a href="#配置优先级" class="headerlink" title="配置优先级"></a>配置优先级</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ul>
<li><p>springboot中支持三种格式的配置文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server.port=<span class="number">8081</span>  												--properties</span><br><span class="line">server:</span><br><span class="line">	port: <span class="number">8082</span>													--yml</span><br><span class="line">server:</span><br><span class="line">	port: <span class="number">8083</span>													--yaml</span><br></pre></td></tr></table></figure>

<p>其中 ：优先级<code>properties &gt; yml &gt; yaml</code></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">虽然springboot支持多种格式配置文件，但是在项目开发过程中，推荐统一使用一种格式的配置 （yml是主流）</span><br></pre></td></tr></table></figure>

<ul>
<li><p>Springboot除了支持配置文件属性配置，还支持 <code>Java系统属性 </code>和 <code>命令行参数</code> 的方式进行属性配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Java系统属性</span><br><span class="line">-Dserver.port=9000</span><br><span class="line"># 命令行参数</span><br><span class="line">--server.port=10010</span><br></pre></td></tr></table></figure>

<p>其中：优先级<code>命令行参数</code> &gt; <code>Java系统属性</code></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401095305704-1715613343042-354.png" alt="image-20240401095305704"></p>
</li>
</ul>
<p>​		<img src="/img/loading.gif" data-original="/.com//image-20240401095654133-1715613343042-355.png" alt="image-20240401095654133"></p>
<p><strong>那么，当我们打包成jar包之后 那我们 该如何设置Java系统属性 和命令行参数</strong></p>
<ul>
<li><p>先打开jar包所在位置</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401095729789-1715613343042-356.png" alt="image-20240401095729789"></p>
</li>
<li><p>在当前文件地址打开cmd  输入</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401095818059-1715613343042-357.png" alt="image-20240401095818059"></p>
</li>
</ul>
<p>那么这5种配置方式的优先级大小呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">命令行参数 &gt; Java系统属性 &gt; properties &gt; yml &gt; yaml</span><br></pre></td></tr></table></figure>

<h2 id="Bean管理"><a href="#Bean管理" class="headerlink" title="Bean管理"></a>Bean管理</h2><h3 id="获取bean"><a href="#获取bean" class="headerlink" title="获取bean"></a>获取bean</h3><ul>
<li><p>默认情况下，Spring项目启动时，会把bean都创建好放在IOC容器，如果想主动获取这些bean，可以通过如下方式</p>
<ul>
<li><p>注入ApplicaionContext</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401102748733-1715613343042-358.png"></p>
</li>
<li><p>根据name获取bean</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401102528247-1715613343042-359.png" alt="image-20240401102528247"></p>
</li>
<li><p>根据类型获取</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401102536962-1715613343042-360.png" alt="image-20240401102536962"></p>
</li>
<li><p>根据name获取bean（带转换类型）</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401102617263-1715613343042-361.png"></p>
</li>
</ul>
</li>
</ul>
<p>运行结果：</p>
<p>​	<img src="/img/loading.gif" data-original="/.com//image-20240401102653230-1715613343042-362.png" alt="image-20240401102653230"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">上述所说的 【Spring 项目启动时，会把其中的bean都创建好】 还会受到作用域及延迟初始化影响，这里主要针对于 默认的单例非延迟加载的bean而言</span><br></pre></td></tr></table></figure>

<h3 id="bean的作用域"><a href="#bean的作用域" class="headerlink" title="bean的作用域"></a>bean的作用域</h3><ul>
<li><p>Spring支持五种作用域 后三者在web环境才生效</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401104035633.png" alt="image-20240401104035633"></p>
</li>
<li><p>可以通过<code>@Scope</code> 注解来进行配置作用域</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401104123066-1715613343042-364.png" alt="image-20240401104123066"></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">默认singleton 的bean  在容器启动时被创建，可以使用@Lazy注解来延迟初始化（延迟到第一次使用时）</span><br><span class="line">prototype的bean，第一次使用该bean的时候 都会创建一个新的实例</span><br><span class="line">实际开发中，绝大部分的bean是单例的，也就是说绝大部分的bean不需要设置prototype</span><br></pre></td></tr></table></figure>

<p>标注prototype的运行结果：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401104420321-1715613343042-365.png" alt="image-20240401104420321"></p>
<p>默认值的运行结果</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401104458244-1715613343042-367.png" alt="image-20240401104458244"></p>
<p>添加@Lazy注解后的运行结果（scope为默认值的情况下）：在调用的时候 初始化</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401104748294-1715613343042-366.png" alt="image-20240401104748294"></p>
<p>不加@Lazy注解：在调用前 初始化</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401104833746-1715613343042-368.png" alt="image-20240401104833746"></p>
<h3 id="第三方bean"><a href="#第三方bean" class="headerlink" title="第三方bean"></a>第三方bean</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果要管理的bean对象 来自第三方（不是自己定义的） 是无法使用@Component及衍生注解来声明bean的，就需要用到@Bean注解</span><br><span class="line"></span><br><span class="line">若要管理第三方的bean对象，建议对这些bean集中管理分类配置，可以通过@Configuration注解来声明一个配置类</span><br></pre></td></tr></table></figure>

<ul>
<li>在启动类中 使用@Bean 注解 来 声明第三方类<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401111143619-1715613343042-370.png" alt="image-20240401111143619"></li>
</ul>
</li>
<li>在通过@Autowired 注解来注入 测试<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401111242081-1715613343042-369.png" alt="image-20240401111242081"></li>
</ul>
</li>
</ul>
<p>但这个时候 我们会发现 声明第三方类的过程 是在启动类中实现的（不建议）</p>
<p>声明配置类的方法：</p>
<ul>
<li><p>先创建一个类 标注 <code>@Configuration</code> 注解 声明配置类</p>
<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401111541227-1715613343042-371.png" alt="image-20240401111541227"></li>
</ul>
</li>
<li><p>如果想要依赖注入  则直接以形参的方式 写到方法中即可</p>
</li>
</ul>
<h2 id="SpringBoot原理"><a href="#SpringBoot原理" class="headerlink" title="SpringBoot原理"></a>SpringBoot原理</h2><h3 id="起步依赖原理"><a href="#起步依赖原理" class="headerlink" title="起步依赖原理"></a>起步依赖原理</h3><p>起步依赖原理：Maven的依赖传递</p>
<h3 id="自动配置原理"><a href="#自动配置原理" class="headerlink" title="自动配置原理"></a>自动配置原理</h3><h4 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h4><ul>
<li>方案一：<code>@ComponentScan</code> 组件扫描</li>
</ul>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401122207578-1715613343042-372.png" alt="image-20240401122207578"></p>
<ul>
<li><p>方案二：<code>@Import</code> 导入。使用@Import 导入的类会被Spring 加载到IOC容器中，导入形式主要有以下几种</p>
<ul>
<li><h2 id="导入普通类"><a href="#导入普通类" class="headerlink" title="导入普通类"></a>导入普通类</h2><ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401122947934-1715613343042-373.png" alt="image-20240401122947934"></li>
</ul>
</li>
<li><p>导入配置类</p>
<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401123312638-1715613343042-374.png" alt="image-20240401123312638"></li>
</ul>
</li>
<li><p>导入ImportSelector 接口实现类</p>
<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401123344957-1715613343042-375.png" alt="image-20240401123344957"></li>
</ul>
</li>
<li><p><code>@EnableXxxx</code> 注解，封装 <code>@Import</code></p>
<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401123509258-1715613343042-376.png" alt="image-20240401123509258"></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="源码跟踪"><a href="#源码跟踪" class="headerlink" title="源码跟踪"></a>源码跟踪</h4><h5 id="SpringbootApplication"><a href="#SpringbootApplication" class="headerlink" title="@SpringbootApplication"></a>@SpringbootApplication</h5><p>Springboot的启动类上有个 <code>@SpringBootApplication</code> 注解 这个注解内还 有着 以下三个注解：</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401151513118.png" alt="image-20240401151513118"></p>
<p>自动配置的核心：<code>@EnableAutoConfiguration</code></p>
<p><code>@SpringbootApplication</code>  该注解标注在Springboot的工程引导类上，是Springboot中<strong>最最最</strong>重要的注解。该注解由三个部分组成：</p>
<ul>
<li><code>@SpringbootConfiguration</code> ：该注解与 <code>@Configruration</code> 注解作用相同，用来声明当前也是一个配置类</li>
<li><code>@ComponentScan</code> ： 组件扫描，默认扫描当前引导类所在的包及其子包</li>
<li><code>@EnaleAutoConfiguration</code> ：SpringBoot 实现自动化配置的核心</li>
</ul>
<h5 id="ConditionalMissingBean"><a href="#ConditionalMissingBean" class="headerlink" title="@ConditionalMissingBean"></a>@ConditionalMissingBean</h5><ul>
<li>作用：按照一定条件进行判断，在满足给定条件后才会注册对应的bean对象到springboot的IOC容器中</li>
<li>位置：方法、类</li>
<li><code>@Conditional</code> 本身是一个父注解，派生出大量的子注解：<ul>
<li><code>@ConditionalOnClass</code> ：判断环境中 是否有对应的字节码文件，才会注册bean到IOC容器中<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401160505935-1715613343042-378.png" alt="image-20240401160505935"></li>
</ul>
</li>
<li><code>@ConditionalOnMissingBean</code> ：判断环境中没有对应的bean(类型 或 名称) 才注册bean到IOC容器<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401160522629-1715613343042-379.png" alt="image-20240401160522629"></li>
</ul>
</li>
<li><code>@ConditionalOnProperty</code> ：判断配置文件中有对应属性和值，才注册bean到IOC容器<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401160537920-1715613343042-380.png" alt="image-20240401160537920"></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>	</p>
<h3 id="start"><a href="#start" class="headerlink" title="start"></a>start</h3><ul>
<li>场景：在实际开发中，经常会定义一些公共组件，提供给各个团队使用，而在Springboot的项目中，一般会将这些公共组件封装为SpringBoot的starter。</li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401163617636-1715613343042-381.png" alt="image-20240401163617636"></li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401163634021.png" alt="image-20240401163634021"></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">注意：springboot官方提供的起步依赖中 spring-boot 在前   </span><br><span class="line">其他技术提供： 功能在前</span><br></pre></td></tr></table></figure>

<p><img src="/img/loading.gif" data-original="/.com//image-20240401163744139.png" alt="image-20240401163744139"></p>
<p>图中，黄色背景中 有粉色背景的依赖  所以 当我加载黄色依赖的时候 它会自动加载里面引入的粉色依赖</p>
<h4 id="自定义start"><a href="#自定义start" class="headerlink" title="自定义start"></a>自定义start</h4><p><img src="/img/loading.gif" data-original="/.com//image-20240401163913668-1715613343042-384.png" alt="image-20240401163913668"></p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240401163920815.png" alt="image-20240401163920815"></p>
<p>步骤： </p>
<ul>
<li>将之前工程中的 AliOSSProperties.java   AliOSSUtils.java 复制到aliyun-oss-boot-autocongifure工程中 这个时候会发现报错了 <ul>
<li>AliOSSUtils.java 方法报错：MultipartFile 原因是没有导入spring-boot-starter-web 依赖</li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401195856740.png" alt="image-20240401195856740"></li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401200005244-1715613343042-387.png" alt="image-20240401200005244"></li>
<li>get set方法找不到 是因为AliyunOSSProperties中的 lombok依赖没有导入 这时候只需要重写以下get set方法就行了</li>
</ul>
</li>
<li>这个时候 发现 AliOSSProperties.java   AliOSSUtils.java   上面的<code>@compenent</code> 注解都用没用了：因为 将来如过有用户使用 我们也不想让他们扫描到  所以 要把从<code>@compenent</code> 注解删掉   但是删掉后 又有错误<ul>
<li>因为不是IOC容器 所以不能使用<code>@Autowired</code>  注入   但是要求中 说我们要进行注入AliOSSUtils  所以就要用到 <code>@Bean</code> 注解<ul>
<li>声明一个 配置类 <code>@Confirguration</code> 来进行 配置 将其交给IOC容器 <ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401201658838-1715613343042-388.png" alt="image-20240401201658838"></li>
</ul>
</li>
</ul>
</li>
<li>AliOSSProperties.java  也会报错  <ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401200727060-1715613343042-389.png" alt="image-20240401200727060"></li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401200742532-1715613343042-390.png" alt="image-20240401200742532"></li>
<li>这时我们发现 缺少了 <code>@EnableConfirgurationProperties</code> 注解 所以我们要 在AliyunOSSConfirgue中添加 此注解<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401201802085-1715613343042-392.png" alt="image-20240401201802085"></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>此外 还会发现  AliOSSUtils 中的 aliOSSProperties 我们并没有声明值 所以我们要给他写上get set方法 <ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401201017568-1715613343042-391.png" alt="image-20240401201017568"></li>
<li>并且 在配置类的  <code>@EnableConfirgurationProperties</code>  注解内添加  并将AliOSSProperties.class类导入 <ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401201108735-1715613343042-393.png" alt="image-20240401201108735"></li>
<li>进行注入   并将方法 中的值进行返回  注入 直接在方法形参内声明<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401201146741-1715613343042-396.png" alt="image-20240401201146741"></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>最后 进行测试<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401201326172-1715613343042-394.png" alt="image-20240401201326172"></li>
<li>引入测试类  并 在pom文件中 引入aliyun-oss-spring-boot-starter 的依赖  注意 不需要引入 aliyun-oss-spring-boot-autoconfigure 的 依赖 因为 aliyun-oss-spring-boot-starter  已经引入 又因为 依赖的传递性 所以 不用在引入了</li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240401201513561-1715613343042-395.png" alt="image-20240401201513561"></li>
<li>uploadController 中  注入aliOSSUtils    并调用upload方法 此时 就获得了 图像的url</li>
</ul>
</li>
</ul>
<h1 id="Maven高级"><a href="#Maven高级" class="headerlink" title="Maven高级"></a>Maven高级</h1><h2 id="分模块设计与开发"><a href="#分模块设计与开发" class="headerlink" title="分模块设计与开发"></a>分模块设计与开发</h2><p>当我们很多人 共同开发一个项目的时候 如何做到数据共享呢？  这个时候就要将 我们要共i想的数据  封装到一个新模块中  当我们需要使用的 时候 直接导入对应的依赖即可</p>
<p>将之前完成的tlias包 进行分模块    </p>
<ul>
<li>先分别创建存放pojo和utils的模块<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402092430991-1715613343043-397.png" alt="image-20240402092430991"></li>
</ul>
</li>
<li>将pojo包下的类 一同copy 到 tlias-pojo模块中 utils同理<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402092640342-1715613343043-398.png" alt="image-20240402092640342"></li>
<li>再将 pojo类所需要的依赖 导入到pom文件中去</li>
</ul>
</li>
<li>最后 在这个项目中  导入 tlais-pojo 和tlais-utils 的依赖<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402092833445-1715613343043-399.png" alt="image-20240402092833445"></li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.什么是分模块设计？</span><br><span class="line">	·将项目按照功能拆分成若干个子模块</span><br><span class="line">2.为什么要分模块设计？</span><br><span class="line">	·方便项目的管理和维护、扩展，也方便模块间的相互调用，资源共享</span><br><span class="line">3.注意事项：</span><br><span class="line">	·分模块设计需要先针对模块功能进行设计，在进行编码。不会先将工程开发完毕，然后进行拆分</span><br></pre></td></tr></table></figure>



<h2 id="继承与聚合"><a href="#继承与聚合" class="headerlink" title="继承与聚合"></a>继承与聚合</h2><h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><ul>
<li>概念：继承描述的是两个工程间的关系，与Java中的继承相似，子工程可以继承父工程中的配置信息，常见于依赖关系的继承</li>
<li>作用：简化依赖配置、统一管理依赖</li>
<li>实现：<parent></parent></li>
</ul>
<h4 id="继承关系"><a href="#继承关系" class="headerlink" title="继承关系"></a>继承关系</h4><ol>
<li>创建maven模块，tlias-parent，该工程为父工程，设置打包方式<code>pom</code> （默认jar）<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402100153810-1715613343043-400.png" alt="image-20240402100153810"></li>
</ul>
</li>
<li>在子工程的pom.xml文件中，配置继承关系<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402100221947.png" alt="image-20240402100221947"></li>
<li><strong>relativePath 父工程的相对路径</strong></li>
</ul>
</li>
<li>在父工程中配置各个工程共有的依赖（子工程会自动继承父工程的依赖）<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402100324022-1715613343043-402.png" alt="image-20240402100324022"></li>
</ul>
</li>
</ol>
<p><img src="/img/loading.gif" data-original="/.com//image-20240402100116088-1715613343043-403.png" alt="image-20240402100116088"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">注意：</span><br><span class="line">	在子工程中，配置了继承关系之后，坐标中的groupId是可以省略的，因为会自动创建父工程的</span><br><span class="line">	relativePath指定父工程的pom文件的相对位置（如果不指定，将从本地仓库/远程仓库查找该工程）</span><br></pre></td></tr></table></figure>

<p><strong>打包方式：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jar:普通模块打包，springboot项目基本都是jar包（内嵌tomcat运行）</span><br><span class="line">war：普通web程序打包，需要部署在外部的tomcat服务器中运行</span><br><span class="line">pom：父工程或聚合工程，该模块不写代码，仅进行依赖管理</span><br></pre></td></tr></table></figure>

<h4 id="版本锁定"><a href="#版本锁定" class="headerlink" title="版本锁定"></a>版本锁定</h4><ul>
<li>在maven中，可以在父工程的pom文件中通过，<denpendencyManager> 来统一管理版本<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402103059965.png" alt="image-20240402103059965"></li>
<li><strong>子工程引入依赖时，无需指定<version> 版本号，父工程统一管理，变更依赖版本，只需要在父工程中变更</version></strong></li>
</ul>
</denpendencyManager></li>
<li>自定义属性&#x2F;引用属性<ul>
<li>如果 以后引入的依赖太多 一个个版本找起来也很麻烦 这个时候 就需要定义属性了<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402104254199-1715613343043-405.png" alt="image-20240402104254199"></li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402104303201-1715613343043-406.png" alt="image-20240402104303201"></li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402104307962-1715613343043-407.png" alt="image-20240402104307962"></li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402104434598.png" alt="image-20240402104434598"></li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">面试题：</span><br><span class="line">	&lt;dependencyManager&gt; 与 &lt;dependencies&gt; 的区别是什么？</span><br><span class="line">		&lt;dependencies&gt; 是直接依赖，在父工程中配置了依赖，子工程会直接继承下来</span><br><span class="line">		&lt;dependencyManager&gt; 是统一管理依赖版本，不会直接依赖，还需要在子工程中引入所需要的依赖（无需指定版本）</span><br></pre></td></tr></table></figure>

<h3 id="聚合"><a href="#聚合" class="headerlink" title="聚合"></a>聚合</h3><p>当我们要打包项目的时候 要一个个install然后再pakage  这个时候 会很繁琐 我们就要用到耦合</p>
<p><img src="/img/loading.gif" data-original="/.com//image-20240402112815627.png" alt="image-20240402112815627"></p>
<ul>
<li>maven 中可以通过 <models> 设置当前聚合工程所包含的子模块名称<ul>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402112947489-1715613343043-410.png" alt="image-20240402112947489"></li>
</ul>
</models></li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402113005262-1715613343043-411.png" alt="image-20240402113005262"><ul>
<li>这个时候 直接运行 父工程中的package 就可实现 打包操作</li>
</ul>
</li>
</ul>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a><strong>总结：</strong></h3><ul>
<li>作用：<ul>
<li>聚合用于快速构建项目</li>
<li>继承用于简化依配置、统一依赖管理</li>
</ul>
</li>
<li>相同点：<ul>
<li>聚合与继承的pom.xml 文件打包方式均为pom 额可以将两种关系制作到同一个pom文件中</li>
<li>聚合与继承 均属于 设计性模块 并无实际的模块内容</li>
</ul>
</li>
<li>不同点：<ul>
<li>聚合实在聚合工程中配置，聚合可以感知到参与聚合的模块有那些</li>
<li>继承是在子模块中配置关系，父模块无法感知那些子模块 继承了自己</li>
</ul>
</li>
</ul>
<p>​	 </p>
<h2 id="私服"><a href="#私服" class="headerlink" title="私服"></a>私服</h2><ul>
<li>私服是一种特殊的远程仓库，他是架设在局域网内的仓库服务，用来代替位于外部的中央仓库，用于解决团队内部的资源共享与资源同步问题</li>
<li><img src="/img/loading.gif" data-original="/.com//image-20240402115910067.png" alt="image-20240402115910067"></li>
</ul>
<p>创建私服 的方法较为固定 参考 [私服配置说明.md](E:\BaiduNetdiskDownload\最新版JavaWeb开发教程\资料\day15-maven高级\资料\01. maven高级\02. 私服配置案例\私服配置说明.md) </p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">翎晗</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/04/25/JavaWeb/">http://example.com/2024/04/25/JavaWeb/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">L1n</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/JW_C.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-original="/img/wechat.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/loading.gif" data-original="/img/alipay.jpg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/04/25/git/" title="git"><img class="cover" src="/img/loading.gif" data-original="/img/G_C.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">git</div></div></a></div><div class="next-post pull-right"><a href="/2022/09/10/MySQL/" title="MySQL"><img class="cover" src="/img/loading.gif" data-original="/img/sql_C.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/loading.gif" data-original="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">翎晗</div><div class="author-info__description">心有所向, 无问东西</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">29</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Raehp"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/Raehp" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:zhanghaolin406@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://blog.csdn.net/ChengXuYuanQ?type=blog" target="_blank" title="CSDN"><i class="fa fa-book-open"></i></a><a class="social-icon" href="https://www.youtube.com/channel/UC_YN18th7UBb0fJwRg4XpsQ" target="_blank" title="YouTube"><i class="fab fa-youtube"></i></a><a class="social-icon" href="https://www.google.com/" target="_blank" title="Google"><i class="fab fa-google"></i></a><a class="social-icon" href="https://stackoverflow.com/?newreg=6006dea233a64469a2962d9d8a8e7ea9" target="_blank" title="StackOverflow"><i class="fab fa-stack-overflow"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">平安喜樂，得偿所愿，祝你，也祝我</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Maven"><span class="toc-text">Maven</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-text">简介</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Maven%E7%9A%84%E4%BD%9C%E7%94%A8%EF%BC%9F"><span class="toc-text">Maven的作用？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Maven%E5%9D%90%E6%A0%87"><span class="toc-text">Maven坐标</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E7%AE%A1%E7%90%86"><span class="toc-text">依赖管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E9%85%8D%E7%BD%AE"><span class="toc-text">依赖配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E4%BC%A0%E9%80%92"><span class="toc-text">依赖传递</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E5%85%B7%E6%9C%89%E4%BC%A0%E9%80%92%E6%80%A7"><span class="toc-text">依赖具有传递性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8E%92%E9%99%A4%E4%BE%9D%E8%B5%96"><span class="toc-text">排除依赖</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E8%8C%83%E5%9B%B4"><span class="toc-text">依赖范围</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C"><span class="toc-text">执行</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#HTTP%E5%8D%8F%E8%AE%AE"><span class="toc-text">HTTP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP-%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"><span class="toc-text">HTTP-请求数据格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E4%BB%8B%E7%BB%8D-HTTP%E5%93%8D%E5%BA%94%E6%A0%BC%E5%BC%8F"><span class="toc-text">请求响应介绍-HTTP响应格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E7%A0%81%E5%A4%A7%E7%B1%BB"><span class="toc-text">状态码大类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%93%8D%E5%BA%94%E7%8A%B6%E6%80%81%E7%A0%81"><span class="toc-text">常见的响应状态码</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Web%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">Web服务器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Tomcat"><span class="toc-text">Tomcat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">基本使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Springboot%E5%86%85%E5%B5%8CTomcat"><span class="toc-text">Springboot内嵌Tomcat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%B5%B7%E6%AD%A5%E4%BE%9D%E8%B5%96"><span class="toc-text">1.起步依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%86%85%E5%B5%8CTomcat%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-text">2.内嵌Tomcat服务器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94"><span class="toc-text">请求响应</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94-1"><span class="toc-text">请求响应</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Postman"><span class="toc-text">Postman</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82"><span class="toc-text">请求</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%8F%82%E6%95%B0"><span class="toc-text">简单参数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E5%8E%9F%E5%A7%8B%E6%96%B9%E5%BC%8F%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-text">1.原始方式获取请求参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-SpringBoot%E4%B8%AD%E6%8E%A5%E6%94%B6%E7%AE%80%E5%8D%95%E5%8F%82%E6%95%B0"><span class="toc-text">2.SpringBoot中接收简单参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3-RequestParam%E6%B3%A8%E8%A7%A3"><span class="toc-text">3.@RequestParam注解</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BD%93%E5%8F%82%E6%95%B0"><span class="toc-text">实体参数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E7%AE%80%E5%8D%95%E5%AE%9E%E4%BD%93%E5%8F%82%E6%95%B0"><span class="toc-text">1.简单实体参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E5%A4%8D%E6%9D%82%E5%AE%9E%E4%BD%93%E5%8F%82%E6%95%B0"><span class="toc-text">2.复杂实体参数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E9%9B%86%E5%90%88%E5%8F%82%E6%95%B0"><span class="toc-text">数组集合参数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-%E6%95%B0%E7%BB%84%E5%8F%82%E6%95%B0"><span class="toc-text">1.数组参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-%E9%9B%86%E5%90%88%E5%8F%82%E6%95%B0"><span class="toc-text">2.集合参数</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A5%E6%9C%9F%E5%8F%82%E6%95%B0"><span class="toc-text">日期参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Json%E6%A0%BC%E5%BC%8F%E5%8F%82%E6%95%B0"><span class="toc-text">Json格式参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0"><span class="toc-text">路径参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%93%8D%E5%BA%94"><span class="toc-text">响应</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ResponseBody"><span class="toc-text">@ResponseBody</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E5%93%8D%E5%BA%94%E7%BB%93%E6%9E%9C"><span class="toc-text">统一响应结果</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B%EF%BC%9A%E8%8E%B7%E5%8F%96%E5%91%98%E5%B7%A5%E6%95%B0%E6%8D%AE%EF%BC%8C%E5%B9%B6%E7%BB%9F%E4%B8%80%E5%93%8D%E5%BA%94%E7%BB%93%E6%9E%9C%EF%BC%8C%E5%9C%A8%E9%A1%B5%E9%9D%A2%E6%B8%B2%E6%9F%93"><span class="toc-text">案例：获取员工数据，并统一响应结果，在页面渲染</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E8%A7%A3%E8%80%A6"><span class="toc-text">分层解耦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E5%B1%82%E6%9E%B6%E6%9E%84"><span class="toc-text">三层架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%8B%86%E5%88%86"><span class="toc-text">代码拆分</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E8%A7%A3%E8%80%A6-1"><span class="toc-text">分层解耦</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%80%A6%E5%90%88%E9%97%AE%E9%A2%98"><span class="toc-text">耦合问题</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E8%80%A6%E6%80%9D%E8%B7%AF"><span class="toc-text">解耦思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IOC-DI"><span class="toc-text">IOC&amp;DI</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IOC-DI%E5%85%A5%E9%97%A8"><span class="toc-text">IOC&amp;DI入门</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IOC%E8%AF%A6%E8%A7%A3"><span class="toc-text">IOC详解</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#bean%E7%9A%84%E5%A3%B0%E6%98%8E"><span class="toc-text">bean的声明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E6%89%AB%E6%8F%8F"><span class="toc-text">组件扫描</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DI%E8%AF%A6%E8%A7%A3"><span class="toc-text">DI详解</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mybatis%E5%85%A5%E9%97%A8"><span class="toc-text">Mybatis入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">1. 快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%85%A5%E9%97%A8%E7%A8%8B%E5%BA%8F%E5%88%86%E6%9E%90"><span class="toc-text">1.1 入门程序分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%85%A5%E9%97%A8%E7%A8%8B%E5%BA%8F%E5%AE%9E%E7%8E%B0"><span class="toc-text">1.2 入门程序实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-text">1.2.1 准备工作</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1-2-1-1-%E5%88%9B%E5%BB%BAspringboot%E5%B7%A5%E7%A8%8B"><span class="toc-text">1.2.1.1 创建springboot工程</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E9%85%8D%E7%BD%AEMybatis"><span class="toc-text">1.2.2 配置Mybatis</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-%E7%BC%96%E5%86%99SQL%E8%AF%AD%E5%8F%A5"><span class="toc-text">1.2.3 编写SQL语句</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-4-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"><span class="toc-text">1.2.4 单元测试</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E8%A7%A3%E5%86%B3SQL%E8%AD%A6%E5%91%8A%E4%B8%8E%E6%8F%90%E7%A4%BA"><span class="toc-text">1.3 解决SQL警告与提示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-JDBC%E4%BB%8B%E7%BB%8D-%E4%BA%86%E8%A7%A3"><span class="toc-text">2. JDBC介绍(了解)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E4%BB%8B%E7%BB%8D"><span class="toc-text">2.1 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E4%BB%A3%E7%A0%81"><span class="toc-text">2.2 代码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90"><span class="toc-text">2.3 问题分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E6%8A%80%E6%9C%AF%E5%AF%B9%E6%AF%94"><span class="toc-text">2.4 技术对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-text">3. 数据库连接池</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E4%BB%8B%E7%BB%8D"><span class="toc-text">3.1 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E4%BA%A7%E5%93%81"><span class="toc-text">3.2 产品</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-lombok"><span class="toc-text">4. lombok</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E4%BB%8B%E7%BB%8D"><span class="toc-text">4.1 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%BD%BF%E7%94%A8"><span class="toc-text">4.2 使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Mybatis%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C"><span class="toc-text">5. Mybatis基础操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E9%9C%80%E6%B1%82"><span class="toc-text">5.1 需求</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E5%87%86%E5%A4%87"><span class="toc-text">5.2 准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E5%88%A0%E9%99%A4"><span class="toc-text">5.3 删除</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1-%E5%8A%9F%E8%83%BD%E5%AE%9E%E7%8E%B0"><span class="toc-text">5.3.1 功能实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-2-%E6%97%A5%E5%BF%97%E8%BE%93%E5%85%A5"><span class="toc-text">5.3.2 日志输入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-3-%E9%A2%84%E7%BC%96%E8%AF%91SQL"><span class="toc-text">5.3.3 预编译SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-3-1-%E4%BB%8B%E7%BB%8D"><span class="toc-text">5.3.3.1 介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-3-2-SQL%E6%B3%A8%E5%85%A5"><span class="toc-text">5.3.3.2 SQL注入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-3-3-3-%E5%8F%82%E6%95%B0%E5%8D%A0%E4%BD%8D%E7%AC%A6"><span class="toc-text">5.3.3.3 参数占位符</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-4-%E6%96%B0%E5%A2%9E"><span class="toc-text">5.4 新增</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-1-%E5%9F%BA%E6%9C%AC%E6%96%B0%E5%A2%9E"><span class="toc-text">5.4.1 基本新增</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-2-%E4%B8%BB%E9%94%AE%E8%BF%94%E5%9B%9E"><span class="toc-text">5.4.2 主键返回</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-5-%E6%9B%B4%E6%96%B0"><span class="toc-text">5.5 更新</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-6-%E6%9F%A5%E8%AF%A2"><span class="toc-text">5.6 查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-1-%E6%A0%B9%E6%8D%AEID%E6%9F%A5%E8%AF%A2"><span class="toc-text">5.6.1 根据ID查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-2-%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85"><span class="toc-text">5.6.2 数据封装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-3-%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-text">5.6.3 条件查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-4-%E5%8F%82%E6%95%B0%E5%90%8D%E8%AF%B4%E6%98%8E"><span class="toc-text">5.6.4 参数名说明</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-XML"><span class="toc-text">6.XML</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-XML%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%84%E8%8C%83"><span class="toc-text">6.1 XML配置文件规范</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-XML%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E5%AE%9E%E7%8E%B0"><span class="toc-text">6.2 XML配置文件实现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-MybatisX%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">6.3 MybatisX的使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-Mybatis%E5%8A%A8%E6%80%81SQL"><span class="toc-text">7. Mybatis动态SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E4%BB%80%E4%B9%88%E6%98%AF%E5%8A%A8%E6%80%81SQL"><span class="toc-text">7.1 什么是动态SQL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E5%8A%A8%E6%80%81SQL-if"><span class="toc-text">7.2 动态SQL-if</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-text">7.2.1 条件查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-%E6%9B%B4%E6%96%B0%E5%91%98%E5%B7%A5"><span class="toc-text">7.2.2 更新员工</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-%E5%8A%A8%E6%80%81SQL-foreach"><span class="toc-text">7.3 动态SQL-foreach</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-%E5%8A%A8%E6%80%81SQL-sql-include"><span class="toc-text">7.4 动态SQL-sql&amp;include</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%A0%A1%E9%AA%8C"><span class="toc-text">登录校验</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E6%8A%80%E6%9C%AF"><span class="toc-text">会话技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80-Cookie"><span class="toc-text">方案一 - Cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9"><span class="toc-text">优缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C-Session"><span class="toc-text">方案二 - Session</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9-1"><span class="toc-text">优缺点</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%89-%E4%BB%A4%E7%89%8C%E6%8A%80%E6%9C%AF"><span class="toc-text">方案三 - 令牌技术</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JWT%E4%BB%A4%E7%89%8C%E6%8A%80%E6%9C%AF"><span class="toc-text">JWT令牌技术</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT%E4%BB%A4%E7%89%8C-%E7%94%9F%E6%88%90"><span class="toc-text">JWT令牌-生成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JWT%E4%BB%A4%E7%89%8C-%E8%A7%A3%E6%9E%90"><span class="toc-text">JWT令牌-解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E6%84%8F%EF%BC%9A"><span class="toc-text">注意：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Filter%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-text">Filter过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Filter%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">Filter快速入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%A6%E8%A7%A3%EF%BC%88%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E3%80%81%E6%8B%A6%E6%88%AA%E8%B7%AF%E5%BE%84%E3%80%81%E8%BF%87%E6%BB%A4%E5%99%A8%E9%93%BE%EF%BC%89"><span class="toc-text">详解（执行流程、拦截路径、过滤器链）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%A0%A1%E9%AA%8C-Filter"><span class="toc-text">登录校验-Filter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Interceptor%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-text">Interceptor拦截器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">简介&amp;快速入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%A6%E8%A7%A3"><span class="toc-text">详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E6%A0%A1%E9%AA%8C-interceptor"><span class="toc-text">登录校验-interceptor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-text">异常处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BD%93%E5%89%8D%E9%97%AE%E9%A2%98"><span class="toc-text">当前问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-text">全局异常处理器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-text">Spring事务管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%B1%9E%E6%80%A7"><span class="toc-text">事务属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E6%BB%9Arollback"><span class="toc-text">回滚rollback</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%A0%E6%92%AD%E8%A1%8C%E4%B8%BApropagation"><span class="toc-text">传播行为propagation</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AOP"><span class="toc-text">AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP%E5%9F%BA%E7%A1%80"><span class="toc-text">AOP基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP%E6%A6%82%E8%BF%B0"><span class="toc-text">AOP概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">快速入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">AOP核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-text">AOP执行流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP%E8%BF%9B%E9%98%B6"><span class="toc-text">AOP进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5%E7%B1%BB%E5%9E%8B"><span class="toc-text">通知类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E7%9F%A5%E9%A1%BA%E5%BA%8F"><span class="toc-text">通知顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%87%E5%85%A5%E7%82%B9%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-text">切入点表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#executation"><span class="toc-text">executation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#annotation"><span class="toc-text">@annotation</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9E%E6%8E%A5%E7%82%B9"><span class="toc-text">连接点</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#SpringBoot"><span class="toc-text">SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-text">配置优先级</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-text">配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bean%E7%AE%A1%E7%90%86"><span class="toc-text">Bean管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96bean"><span class="toc-text">获取bean</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-text">bean的作用域</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9bean"><span class="toc-text">第三方bean</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBoot%E5%8E%9F%E7%90%86"><span class="toc-text">SpringBoot原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%B7%E6%AD%A5%E4%BE%9D%E8%B5%96%E5%8E%9F%E7%90%86"><span class="toc-text">起步依赖原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86"><span class="toc-text">自动配置原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-text">实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BC%E5%85%A5%E6%99%AE%E9%80%9A%E7%B1%BB"><span class="toc-text">导入普通类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E8%B7%9F%E8%B8%AA"><span class="toc-text">源码跟踪</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#SpringbootApplication"><span class="toc-text">@SpringbootApplication</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#ConditionalMissingBean"><span class="toc-text">@ConditionalMissingBean</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#start"><span class="toc-text">start</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89start"><span class="toc-text">自定义start</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Maven%E9%AB%98%E7%BA%A7"><span class="toc-text">Maven高级</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%BC%80%E5%8F%91"><span class="toc-text">分模块设计与开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E4%B8%8E%E8%81%9A%E5%90%88"><span class="toc-text">继承与聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-text">继承</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB"><span class="toc-text">继承关系</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%88%E6%9C%AC%E9%94%81%E5%AE%9A"><span class="toc-text">版本锁定</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88"><span class="toc-text">聚合</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-text">总结：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A7%81%E6%9C%8D"><span class="toc-text">私服</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/10/13/kafkaConfig/" title="kafkaConfig"><img src="/img/loading.gif" data-original="/img/K_C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="kafkaConfig"/></a><div class="content"><a class="title" href="/2024/10/13/kafkaConfig/" title="kafkaConfig">kafkaConfig</a><time datetime="2024-10-13T07:15:45.000Z" title="发表于 2024-10-13 15:15:45">2024-10-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/27/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%9D%A2%E8%AF%95%E9%A2%98/" title="微服务面试题"><img src="/img/loading.gif" data-original="/img/W_C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="微服务面试题"/></a><div class="content"><a class="title" href="/2024/09/27/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%9D%A2%E8%AF%95%E9%A2%98/" title="微服务面试题">微服务面试题</a><time datetime="2024-09-27T02:32:38.000Z" title="发表于 2024-09-27 10:32:38">2024-09-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/19/es%E9%9B%86%E7%BE%A4/" title="es集群"><img src="/img/loading.gif" data-original="/img/ES_C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="es集群"/></a><div class="content"><a class="title" href="/2024/09/19/es%E9%9B%86%E7%BE%A4/" title="es集群">es集群</a><time datetime="2024-09-19T08:01:14.000Z" title="发表于 2024-09-19 16:01:14">2024-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/09/19/Redis%E9%9B%86%E7%BE%A4/" title="Redis集群"><img src="/img/loading.gif" data-original="/img/RJ_C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Redis集群"/></a><div class="content"><a class="title" href="/2024/09/19/Redis%E9%9B%86%E7%BE%A4/" title="Redis集群">Redis集群</a><time datetime="2024-09-19T08:00:14.000Z" title="发表于 2024-09-19 16:00:14">2024-09-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/14/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式"><img src="/img/loading.gif" data-original="/img/DD_C.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="设计模式"/></a><div class="content"><a class="title" href="/2024/07/14/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" title="设计模式">设计模式</a><time datetime="2024-07-14T10:45:42.000Z" title="发表于 2024-07-14 18:45:42">2024-07-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/JW_T.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By 翎晗</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.12.0"></script><script src="/js/main.js?v=4.12.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.32/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="/%5Bobject%20Object%5D"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="true" data-text="L1n,L1n,L1n" data-fontsize="15px" data-random="true" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.12.0"></script></div></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body></html>